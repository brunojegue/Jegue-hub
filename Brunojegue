-- Khalexis Hub - Script Hub para Roblox com sistema de key, barra de pesquisa e configura√ß√µes de tema
-- Vers√£o Polida: V1.2 - Corre√ß√µes de scroll, otimiza√ß√µes de performance e limpeza de c√≥digo
-- Chaves v√°lidas: "khalexispremium100", "khalexisgeneroso"
-- Mensagem de erro: "Key incorreta"
-- Toggle "K" branco em quadrado preto arredondado
-- Toggle aparece s√≥ ao fechar o hub, some ao abrir
-- Toggle posicionado no canto superior esquerdo, clic√°vel e arrast√°vel (mouse/touch)
-- Melhorias: CanvasSize din√¢mico para scrolls, padding extra para evitar cortes, formata√ß√£o consistente, coment√°rios aprimorados

local function applyRoundedCorners(guiObject, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 8)
    corner.Parent = guiObject
end

local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KhalexisHub"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game.CoreGui

-- Paletas de Cores para os Temas (otimizado para f√°cil expans√£o)
local themes = {
    normal = {
        main_bg = Color3.fromRGB(30, 30, 30),
        category_bg = Color3.fromRGB(50, 50, 50),
        title_bar = Color3.fromRGB(45, 45, 45),
        script_frame_bg = Color3.fromRGB(30, 30, 30),
        transparency = 0
    },
    preto = {
        main_bg = Color3.fromRGB(10, 10, 10),
        category_bg = Color3.fromRGB(25, 25, 25),
        title_bar = Color3.fromRGB(20, 20, 20),
        script_frame_bg = Color3.fromRGB(10, 10, 10),
        transparency = 0
    },
    laranja = {
        main_bg = Color3.fromRGB(255, 140, 0),
        category_bg = Color3.fromRGB(40, 40, 40),
        title_bar = Color3.fromRGB(30, 30, 30),
        script_frame_bg = Color3.fromRGB(50, 50, 50),
        transparency = 0
    },
    roxo = {
        main_bg = Color3.fromRGB(138, 43, 226),
        category_bg = Color3.fromRGB(40, 40, 40),
        title_bar = Color3.fromRGB(30, 30, 30),
        script_frame_bg = Color3.fromRGB(50, 50, 50),
        transparency = 0
    },
    transparente = {
        main_bg = Color3.fromRGB(30, 30, 30),
        category_bg = Color3.fromRGB(50, 50, 50),
        title_bar = Color3.fromRGB(45, 45, 45),
        script_frame_bg = Color3.fromRGB(30, 30, 30),
        transparency = 0.4
    }
}

-- Cores Padr√£o (usando tema normal como base)
local COLOR_BLACK = themes.normal.main_bg
local COLOR_CATEGORY_BG = themes.normal.category_bg
local COLOR_CATEGORY_BTN = Color3.fromRGB(90, 90, 90)
local COLOR_SCRIPT_BTN = Color3.fromRGB(70, 70, 70)
local COLOR_TITLEBAR = themes.normal.title_bar
local COLOR_TEXT = Color3.fromRGB(220, 220, 220)
local COLOR_ERROR = Color3.fromRGB(255, 85, 85)
local COLOR_FOOTER_TEXT = Color3.fromRGB(170, 170, 170)

local userId = player.UserId
local userName = player.Name
local KeyFrame, MainFrameContainer
local LoadingScreen, StopLoadingAnim
local HubOpen = false
local ToggleButton
local ErrorLabel
local HasShownWelcome = false

local StorageKeyFileName = "KhalexisHubKey.txt"
local validKeys = {
    khalexispremium100 = true,
    khalexisgeneroso = true,
}

-- Fun√ß√µes de Armazenamento Local (otimizadas com pcall para robustez)
local function saveKeyLocally(key)
    pcall(function()
        if writefile then
            writefile(StorageKeyFileName, key)
        elseif write_file then
            write_file(StorageKeyFileName, key)
        end
    end)
end

local function loadKeyLocally()
    local success, content = pcall(function()
        if readfile then
            return readfile(StorageKeyFileName)
        elseif read_file then
            return read_file(StorageKeyFileName)
        end
    end)
    if success and content then
        return content:lower()
    end
    return nil
end

local function removeLocalKey()
    pcall(function()
        if delfile then
            delfile(StorageKeyFileName)
        elseif deletefile then
            deletefile(StorageKeyFileName)
        end
    end)
end

-- Fun√ß√µes de UI Auxiliares (otimizadas para reutiliza√ß√£o)
local function showAutoMessage(msg)
    local messageFrame = Instance.new("Frame")
    messageFrame.Name = "AutoMessageFrame"
    messageFrame.Size = UDim2.new(0, 320, 0, 45)
    messageFrame.Position = UDim2.new(1, -330, 1, -55)
    messageFrame.BackgroundColor3 = COLOR_BLACK
    messageFrame.BorderSizePixel = 0
    messageFrame.Parent = ScreenGui
    applyRoundedCorners(messageFrame, 10)

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -20, 1, -10)
    label.Position = UDim2.new(0, 10, 0, 5)
    label.BackgroundTransparency = 1
    label.TextColor3 = COLOR_TEXT
    label.Font = Enum.Font.GothamBold
    label.TextSize = 16
    label.Text = msg
    label.TextWrapped = true
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextYAlignment = Enum.TextYAlignment.Center
    label.Parent = messageFrame

    spawn(function()
        wait(4)
        if messageFrame and messageFrame.Parent then
            messageFrame:Destroy()
        end
    end)
end

local function showError(msg)
    if ErrorLabel then
        ErrorLabel.Text = msg
        spawn(function()
            wait(2)
            if ErrorLabel and ErrorLabel.Parent then
                ErrorLabel.Text = ""
            end
        end)
    end
end

local function copyToClipboard(text)
    return pcall(function()
        if setclipboard then
            setclipboard(text)
        elseif toclipboard then
            toclipboard(text)
        else
            error("Clipboard function not supported.")
        end
    end)
end

-- Anima√ß√£o de Fechamento do Hub (otimizada para performance)
local function closeHubWithAnimation(container)
    if not (container and container.Parent) then
        return
    end

    local uiScaler = container:FindFirstChildOfClass("UIScale")
    if not uiScaler then
        container:Destroy()
        return
    end

    local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
    local goal = {Scale = 0}
    local tween = TweenService:Create(uiScaler, tweenInfo, goal)
    tween:Play()
    tween.Completed:Wait()

    if container and container.Parent then
        container:Destroy()
    end
    MainFrameContainer = nil
    HubOpen = false
    ToggleButton.Visible = true
end

-- Tela de Carregamento com Anima√ß√£o Melhorada
local function showLoadingScreen()
    local frame = Instance.new("Frame")
    frame.Name = "LoadingFrame"
    frame.Size = UDim2.new(0, 300, 0, 120)
    frame.Position = UDim2.new(0.5, -150, 0.5, -60)
    frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    frame.BorderSizePixel = 0
    frame.Parent = ScreenGui
    applyRoundedCorners(frame, 16)

    local border = Instance.new("UIStroke")
    border.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    border.Color = Color3.fromRGB(0, 0, 0)
    border.Thickness = 2
    border.Parent = frame

    local label = Instance.new("TextLabel")
    label.Name = "LoadingLabel"
    label.Size = UDim2.new(1, 0, 0, 30)
    label.Position = UDim2.new(0, 0, 0.3, -15)
    label.BackgroundTransparency = 1
    label.Text = "Carregando..."
    label.TextColor3 = COLOR_TEXT
    label.Font = Enum.Font.GothamBold
    label.TextSize = 20
    label.Parent = frame

    local spinner = Instance.new("Frame")
    spinner.Size = UDim2.new(0, 50, 0, 50)
    spinner.Position = UDim2.new(0.5, -25, 0, 60)
    spinner.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    spinner.BorderSizePixel = 0
    applyRoundedCorners(spinner, 25)
    spinner.Parent = frame

    local orangeBall = Instance.new("Frame")
    orangeBall.Size = UDim2.new(0, 50, 0, 50)
    orangeBall.Position = UDim2.new(0, 0, 0, 0)
    orangeBall.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
    applyRoundedCorners(orangeBall, 25)
    orangeBall.Parent = spinner

    local whiteBall = Instance.new("Frame")
    whiteBall.Size = UDim2.new(0, 20, 0, 20)
    whiteBall.Position = UDim2.new(0.5, -10, 0.5, -10)
    whiteBall.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    applyRoundedCorners(whiteBall, 10)
    whiteBall.Parent = orangeBall

    local angle = 0
    local connection
    connection = RunService.RenderStepped:Connect(function()
        angle = (angle + 6) % 360
        orangeBall.Rotation = angle
        whiteBall.Rotation = -angle * 2
    end)

    return frame, function()
        if connection then
            connection:Disconnect()
        end
    end
end

-- Aplica√ß√£o de Tema (otimizada para evitar nil checks desnecess√°rios)
local function applyTheme(themeName)
    local palette = themes[themeName]
    if not palette or not MainFrameContainer then
        return
    end
    local MainFrame = MainFrameContainer:FindFirstChild("MainFrame")
    if not MainFrame then
        return
    end

    local titleBar = MainFrame:FindFirstChild("TitleBar")
    local categoryFrame = MainFrame:FindFirstChild("CategoryFrame")
    local scriptFrame = MainFrame:FindFirstChild("ScriptFrame")
    local footerBackground = MainFrame:FindFirstChild("FooterBackground")

    MainFrame.BackgroundColor3 = palette.main_bg
    MainFrame.BackgroundTransparency = palette.transparency
    if titleBar then
        titleBar.BackgroundColor3 = palette.title_bar
    end
    if categoryFrame then
        categoryFrame.BackgroundColor3 = palette.category_bg
    end
    if scriptFrame then
        scriptFrame.BackgroundColor3 = palette.script_frame_bg
    end
    if footerBackground and (themeName == "normal" or themeName == "preto" or themeName == "transparente") then
        footerBackground.BackgroundColor3 = palette.title_bar
    end
end

-- Cria√ß√£o do Hub Principal (com scrolls corrigidos e otimiza√ß√µes)
local function createHub()
    local animationContainer = Instance.new("Frame")
    animationContainer.Name = "AnimationContainer"
    animationContainer.Size = UDim2.new(0, 350, 0, 280)
    animationContainer.AnchorPoint = Vector2.new(0.5, 0.5)
    animationContainer.Position = UDim2.new(0.5, 0, 0.5, 0)
    animationContainer.BackgroundTransparency = 1
    animationContainer.Parent = ScreenGui

    local uiScaler = Instance.new("UIScale")
    uiScaler.Parent = animationContainer

    local frame = Instance.new("Frame")
    frame.Name = "MainFrame"
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.Position = UDim2.new(0, 0, 0, 0)
    frame.BackgroundColor3 = COLOR_BLACK
    frame.BorderSizePixel = 0
    frame.Parent = animationContainer
    frame.Visible = true
    applyRoundedCorners(frame, 12)

    local hubBorder = Instance.new("UIStroke")
    hubBorder.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    hubBorder.Thickness = 2
    hubBorder.LineJoinMode = Enum.LineJoinMode.Round
    hubBorder.Parent = frame
    local hubGradient = Instance.new("UIGradient")
    hubGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 140, 0)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(220, 100, 0))
    })
    hubGradient.Rotation = 45
    hubGradient.Parent = hubBorder

    local titleBar = Instance.new("Frame")
    titleBar.Name = "TitleBar"
    titleBar.Size = UDim2.new(1, -10, 0, 30)
    titleBar.Position = UDim2.new(0, 5, 0, 5)  -- CORRIGIDO: Removido typo "Flo"
    titleBar.BackgroundColor3 = COLOR_TITLEBAR
    titleBar.BorderSizePixel = 0
    titleBar.Parent = frame
    applyRoundedCorners(titleBar, 10)

    local titleBarBorder = Instance.new("UIStroke")
    titleBarBorder.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    titleBarBorder.Thickness = 1.5
    titleBarBorder.LineJoinMode = Enum.LineJoinMode.Round
    titleBarBorder.Parent = titleBar
    local titleBarGradient = Instance.new("UIGradient")
    titleBarGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 140, 0)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(220, 100, 0))
    })
    titleBarGradient.Rotation = 90
    titleBarGradient.Parent = titleBarBorder

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "Title"
    titleLabel.Size = UDim2.new(1, 0, 1, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "Khalexis Hub"
    titleLabel.TextColor3 = COLOR_TEXT
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 18
    titleLabel.TextXAlignment = Enum.TextXAlignment.Center
    titleLabel.TextYAlignment = Enum.TextYAlignment.Center
    titleLabel.Parent = titleBar

    -- Bot√£o de Fechar (com hover otimizado)
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.Size = UDim2.new(0, 24, 0, 24)
    closeButton.Position = UDim2.new(1, -28, 0.5, -12)
    closeButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
    closeButton.BackgroundTransparency = 1
    closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeButton.Font = Enum.Font.GothamBold
    closeButton.TextSize = 18
    closeButton.Text = "X"
    closeButton.Parent = titleBar
    applyRoundedCorners(closeButton, 12)

    local closeTweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad)
    closeButton.MouseEnter:Connect(function()
        TweenService:Create(closeButton, closeTweenInfo, {BackgroundTransparency = 0.5}):Play()
    end)
    closeButton.MouseLeave:Connect(function()
        TweenService:Create(closeButton, closeTweenInfo, {BackgroundTransparency = 1}):Play()
    end)
    closeButton.MouseButton1Click:Connect(function()
        closeHubWithAnimation(animationContainer)
    end)

    -- Barra de Pesquisa (otimizada para mobile)
    local searchBox = Instance.new("TextBox")
    searchBox.Name = "CategorySearchBox"
    searchBox.Size = UDim2.new(0, 120, 0, 22)
    searchBox.Position = UDim2.new(0, 5, 0, 40)
    searchBox.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    searchBox.TextColor3 = COLOR_TEXT
    searchBox.PlaceholderText = "üîç Pesquisar..."
    searchBox.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
    searchBox.Text = ""
    searchBox.Font = Enum.Font.Gotham
    searchBox.TextSize = 11
    searchBox.ClearTextOnFocus = false
    searchBox.Parent = frame
    applyRoundedCorners(searchBox, 8)

    local searchBoxBorder = Instance.new("UIStroke")
    searchBoxBorder.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    searchBoxBorder.Thickness = 1.5
    searchBoxBorder.LineJoinMode = Enum.LineJoinMode.Round
    searchBoxBorder.Parent = searchBox
    local searchBoxGradient = Instance.new("UIGradient")
    searchBoxGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 140, 0)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(220, 100, 0))
    })
    searchBoxGradient.Rotation = 90
    searchBoxGradient.Parent = searchBoxBorder

    -- CategoryFrame com Scroll Corrigido
    local categoryFrame = Instance.new("ScrollingFrame")
    categoryFrame.Name = "CategoryFrame"
    categoryFrame.Size = UDim2.new(0, 120, 1, -95)
    categoryFrame.Position = UDim2.new(0, 5, 0, 67)
    categoryFrame.BackgroundColor3 = COLOR_CATEGORY_BG
    categoryFrame.BorderSizePixel = 0
    categoryFrame.ScrollBarThickness = 8  -- AUMENTADO para melhor usabilidade
    categoryFrame.Parent = frame
    applyRoundedCorners(categoryFrame, 12)

    local categoryFrameBorder = Instance.new("UIStroke")
    categoryFrameBorder.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    categoryFrameBorder.Thickness = 1.5
    categoryFrameBorder.LineJoinMode = Enum.LineJoinMode.Round
    categoryFrameBorder.Parent = categoryFrame
    local categoryFrameGradient = Instance.new("UIGradient")
    categoryFrameGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 140, 0)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(220, 100, 0))
    })
    categoryFrameGradient.Rotation = 90
    categoryFrameGradient.Parent = categoryFrameBorder

    local categoryContainer = Instance.new("Frame")
    categoryContainer.Name = "CategoryContainer"
    categoryContainer.Size = UDim2.new(1, -10, 0, 0)
    categoryContainer.Position = UDim2.new(0, 5, 0, 5)
    categoryContainer.BackgroundTransparency = 1
    categoryContainer.Parent = categoryFrame
    categoryContainer.ClipsDescendants = true

    local layoutCategory = Instance.new("UIListLayout")
    layoutCategory.Padding = UDim.new(0, 6)
    layoutCategory.SortOrder = Enum.SortOrder.LayoutOrder
    layoutCategory.FillDirection = Enum.FillDirection.Vertical
    layoutCategory.HorizontalAlignment = Enum.HorizontalAlignment.Center
    layoutCategory.Parent = categoryContainer

    -- Atualiza√ß√£o Din√¢mica de Tamanho e CanvasSize (corrigido e otimizado)
    layoutCategory:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        local contentHeight = layoutCategory.AbsoluteContentSize.Y + 10  -- Padding extra para evitar corte
        categoryContainer.Size = UDim2.new(1, -10, 0, contentHeight)
        categoryFrame.CanvasSize = UDim2.new(0, 0, 0, contentHeight)
    end)

    -- Filtro de Pesquisa (otimizado com lower case consistente)
    searchBox:GetPropertyChangedSignal("Text"):Connect(function()
        local searchText = searchBox.Text:lower()
        for _, button in ipairs(categoryContainer:GetChildren()) do
            if button:IsA("TextButton") then
                local buttonText = button.Text:lower()
                button.Visible = string.find(buttonText, searchText, 1, true) ~= nil
            end
        end
    end)

    -- ScriptFrame com Scroll Corrigido
    local scriptFrame = Instance.new("ScrollingFrame")
    scriptFrame.Name = "ScriptFrame"
    scriptFrame.Size = UDim2.new(1, -135, 1, -60)
    scriptFrame.Position = UDim2.new(0, 130, 0, 40)
    scriptFrame.BackgroundColor3 = COLOR_BLACK
    scriptFrame.BorderSizePixel = 0
    scriptFrame.ScrollBarThickness = 8  -- AUMENTADO para melhor usabilidade
    scriptFrame.Parent = frame
    applyRoundedCorners(scriptFrame, 16)

    local scriptFrameBorder = Instance.new("UIStroke")
    scriptFrameBorder.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    scriptFrameBorder.Thickness = 1.5
    scriptFrameBorder.LineJoinMode = Enum.LineJoinMode.Round
    scriptFrameBorder.Parent = scriptFrame
    local scriptFrameGradient = Instance.new("UIGradient")
    scriptFrameGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 140, 0)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(220, 100, 0))
    })
    scriptFrameGradient.Rotation = 90
    scriptFrameGradient.Parent = scriptFrameBorder

    local scriptContainer = Instance.new("Frame")
    scriptContainer.Name = "ScriptContainer"
    scriptContainer.Size = UDim2.new(1, -20, 0, 0)
    scriptContainer.Position = UDim2.new(0, 10, 0, 10)
    scriptContainer.BackgroundTransparency = 1
    scriptContainer.Parent = scriptFrame
    scriptContainer.ClipsDescendants = true

    local layoutScript = Instance.new("UIListLayout")
    layoutScript.Padding = UDim.new(0, 6)
    layoutScript.SortOrder = Enum.SortOrder.LayoutOrder
    layoutScript.FillDirection = Enum.FillDirection.Vertical
    layoutScript.HorizontalAlignment = Enum.HorizontalAlignment.Center
    layoutScript.Parent = scriptContainer

    -- Atualiza√ß√£o Din√¢mica de Tamanho e CanvasSize (corrigido e otimizado)
    layoutScript:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        local contentHeight = layoutScript.AbsoluteContentSize.Y + 10  -- Padding extra para evitar corte
        scriptContainer.Size = UDim2.new(1, -20, 0, contentHeight)
        scriptFrame.CanvasSize = UDim2.new(0, 0, 0, contentHeight)
    end)

    -- Rodap√© para Aba de Atualiza√ß√µes (vis√≠vel apenas quando necess√°rio)
    local scriptFooter = Instance.new("TextLabel")
    scriptFooter.Name = "ScriptFooter"
    scriptFooter.Size = UDim2.new(1, 0, 0, 18)
    scriptFooter.BackgroundTransparency = 1
    scriptFooter.TextColor3 = Color3.fromRGB(150, 150, 150)
    scriptFooter.Font = Enum.Font.Gotham
    scriptFooter.TextSize = 9
    scriptFooter.Text = "Algum Script parou de funcionar? NOS COMUNIQUE!"
    scriptFooter.TextWrapped = true
    scriptFooter.TextXAlignment = Enum.TextXAlignment.Center
    scriptFooter.TextYAlignment = Enum.TextYAlignment.Bottom
    scriptFooter.LayoutOrder = 999
    scriptFooter.Parent = scriptContainer
    scriptFooter.Visible = false

    -- Footer Background (otimizado)
    local footerBackground = Instance.new("Frame")
    footerBackground.Name = "FooterBackground"
    footerBackground.Size = UDim2.new(1, -10, 0, 40)
    footerBackground.Position = UDim2.new(0, 5, 1, -45)
    footerBackground.BackgroundColor3 = COLOR_TITLEBAR
    footerBackground.BorderSizePixel = 0
    footerBackground.Parent = frame
    applyRoundedCorners(footerBackground, 10)

    local footerBorder = Instance.new("UIStroke")
    footerBorder.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    footerBorder.Thickness = 1.5
    footerBorder.LineJoinMode = Enum.LineJoinMode.Round
    footerBorder.Parent = footerBackground
    local footerGradient = Instance.new("UIGradient")
    footerGradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 140, 0)),
        ColorSequenceKeypoint.new(1, Color3.fromRGB(220, 100, 0))
    })
    footerGradient.Rotation = 90
    footerGradient.Parent = footerBorder

    local footerText = Instance.new("TextLabel")
    footerText.Name = "FooterText"
    footerText.Text = "By Khalexis"
    footerText.Font = Enum.Font.GothamBold
    footerText.TextSize = 10
    footerText.TextColor3 = COLOR_FOOTER_TEXT
    footerText.BackgroundTransparency = 1
    footerText.Size = UDim2.new(0.5, 0, 1, 0)  -- OTIMIZADO: Ajustado para caber no lado esquerdo
    footerText.Position = UDim2.new(0, 0, 0, 5)
    footerText.TextYAlignment = Enum.TextYAlignment.Top
    footerText.Parent = footerBackground

    local footerRightContainer = Instance.new("Frame")
    footerRightContainer.Name = "FooterRightContainer"
    footerRightContainer.Size = UDim2.new(0.5, 0, 1, 0)
    footerRightContainer.Position = UDim2.new(0.5, 0, 0, 0)
    footerRightContainer.BackgroundTransparency = 1
    footerRightContainer.Parent = footerBackground

    local footerContainerPadding = Instance.new("UIPadding")
    footerContainerPadding.PaddingRight = UDim.new(0, 8)
    footerContainerPadding.Parent = footerRightContainer

    local footerTextLayout = Instance.new("UIListLayout")
    footerTextLayout.FillDirection = Enum.FillDirection.Vertical
    footerTextLayout.VerticalAlignment = Enum.VerticalAlignment.Center
    footerTextLayout.HorizontalAlignment = Enum.HorizontalAlignment.Right
    footerTextLayout.SortOrder = Enum.SortOrder.LayoutOrder
    footerTextLayout.Padding = UDim.new(0, 1)
    footerTextLayout.Parent = footerRightContainer

    local ytLabel = Instance.new("TextLabel")
    ytLabel.Name = "YouTubeLabel"
    ytLabel.Text = "Youtube: Khalexis"
    ytLabel.Font = Enum.Font.Gotham
    ytLabel.TextSize = 9
    ytLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    ytLabel.BackgroundTransparency = 1
    ytLabel.Size = UDim2.new(1, 0, 0, 10)
    ytLabel.TextXAlignment = Enum.TextXAlignment.Right
    ytLabel.LayoutOrder = 1
    ytLabel.Parent = footerRightContainer

    local discordLabel = Instance.new("TextLabel")
    discordLabel.Name = "DiscordLabel"
    discordLabel.Text = "Discord: discord.gg/aNaFpb2Qsb"
    discordLabel.Font = Enum.Font.Gotham
    discordLabel.TextSize = 9
    discordLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    discordLabel.BackgroundTransparency = 1
    discordLabel.Size = UDim2.new(1, 0, 0, 10)
    discordLabel.TextXAlignment = Enum.TextXAlignment.Right
    discordLabel.LayoutOrder = 2
    discordLabel.Parent = footerRightContainer

    local hintLabel = Instance.new("TextLabel")
    hintLabel.Name = "DudaLabel"
    hintLabel.Text = "Se tiver alguma d√∫vida entre no Discord!"
    hintLabel.Font = Enum.Font.Gotham
    hintLabel.TextSize = 7
    hintLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
    hintLabel.BackgroundTransparency = 1
    hintLabel.Size = UDim2.new(1, 0, 0, 9)
    hintLabel.TextXAlignment = Enum.TextXAlignment.Right
    hintLabel.LayoutOrder = 3
    hintLabel.Parent = footerRightContainer

    -- Info do Jogador (otimizado para footer)
    local playerInfo = Instance.new("Frame")
    playerInfo.Name = "PlayerInfoFrame"
    playerInfo.Size = UDim2.new(0, 90, 0, 25)
    playerInfo.Position = UDim2.new(0, 8, 0.5, -12)
    playerInfo.BackgroundTransparency = 1
    playerInfo.Parent = footerBackground

    local avatar = Instance.new("ImageLabel")
    avatar.Name = "AvatarImage"
    avatar.Size = UDim2.new(0, 24, 0, 24)
    avatar.Position = UDim2.new(0, 0, 0, 0)
    avatar.BackgroundColor3 = COLOR_SCRIPT_BTN
    avatar.BorderSizePixel = 0
    avatar.Parent = playerInfo
    avatar.ScaleType = Enum.ScaleType.Fit
    applyRoundedCorners(avatar, 12)

    local thumbType, thumbSize = Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size48x48
    local thumbContent = Players:GetUserThumbnailAsync(userId, thumbType, thumbSize, true)
    avatar.Image = thumbContent

    local playerNameLabel = Instance.new("TextLabel")
    playerNameLabel.Name = "PlayerNameLabel"
    playerNameLabel.Size = UDim2.new(1, -28, 1, 0)
    playerNameLabel.Position = UDim2.new(0, 28, 0, 0)
    playerNameLabel.BackgroundTransparency = 1
    playerNameLabel.Text = userName
    playerNameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    playerNameLabel.Font = Enum.Font.Gotham
    playerNameLabel.TextSize = 10
    playerNameLabel.TextXAlignment = Enum.TextXAlignment.Left
    playerNameLabel.Parent = playerInfo

    -- Sistema de Arrasto do Hub (otimizado com conex√µes limpas)
    local dragging = false
    local currentInputObject = nil

    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            local dragStart = input.Position
            local startPos = animationContainer.Position
            currentInputObject = input

            local connection
            connection = input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                    currentInputObject = nil
                    connection:Disconnect()
                end
            end)

            UserInputService.InputChanged:Connect(function(inputChanged)
                if dragging and currentInputObject == inputChanged and (inputChanged.UserInputType == Enum.UserInputType.MouseMovement or inputChanged.UserInputType == Enum.UserInputType.Touch) then
                    local delta = inputChanged.Position - dragStart
                    animationContainer.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
                end
            end)
        end
    end)

    -- Fun√ß√µes de Cria√ß√£o de Bot√µes (otimizadas para reutiliza√ß√£o)
    local function clearScripts()
        for _, child in pairs(scriptContainer:GetChildren()) do
            if child:IsA("GuiObject") and child.Name ~= "ScriptFooter" then
                child:Destroy()
            end
        end
        layoutScript:SetAttribute("Refresh", true)
    end

    local function createScriptButton(name, func)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1, 0, 0, 28)
        btn.BackgroundColor3 = COLOR_SCRIPT_BTN
        btn.BorderSizePixel = 0
        btn.TextColor3 = COLOR_TEXT
        btn.Font = Enum.Font.Gotham
        btn.TextSize = 12
        btn.Text = name
        btn.TextXAlignment = Enum.TextXAlignment.Center
        btn.Parent = scriptContainer
        applyRoundedCorners(btn, 10)

        local border = Instance.new("UIStroke")
        border.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        border.Thickness = 1.5
        border.LineJoinMode = Enum.LineJoinMode.Round
        border.Parent = btn
        local gradient = Instance.new("UIGradient")
        gradient.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 140, 0)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(220, 100, 0))
        })
        gradient.Rotation = 90
        gradient.Parent = border

        btn.MouseButton1Click:Connect(function()
            btn.Text = "Executando..."
            btn.Active = false
            btn.AutoButtonColor = false
            spawn(function()
                pcall(func)
                wait(3)
                closeHubWithAnimation(MainFrameContainer)
            end)
        end)
        return btn
    end

    local function createUpdateLabel(text, textColor, font)
        local lbl = Instance.new("TextLabel")
        lbl.Size = UDim2.new(1, 0, 0, 18)
        lbl.BackgroundTransparency = 1
        lbl.TextColor3 = textColor or COLOR_TEXT
        lbl.Font = font or Enum.Font.Gotham
        lbl.TextSize = 12
        lbl.Text = text
        lbl.TextWrapped = true
        lbl.TextXAlignment = Enum.TextXAlignment.Center
        lbl.TextYAlignment = Enum.TextYAlignment.Top
        lbl.Parent = scriptContainer
        return lbl
    end

    local function createCategoryButton(name, contents, layoutOrder)
        local btn = Instance.new("TextButton")
        btn.Name = name:gsub("%s+", "")
        btn.Size = UDim2.new(1, 0, 0, 22)
        btn.BackgroundColor3 = COLOR_CATEGORY_BTN
        btn.BorderSizePixel = 0
        btn.TextColor3 = Color3.fromRGB(230, 230, 230)
        btn.Font = Enum.Font.Gotham
        btn.TextSize = 9
        btn.Text = name
        btn.TextXAlignment = Enum.TextXAlignment.Center
        btn.Parent = categoryContainer
        applyRoundedCorners(btn, 8)

        local border = Instance.new("UIStroke")
        border.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        border.Thickness = 1.5
        border.LineJoinMode = Enum.LineJoinMode.Round
        border.Parent = btn
        local gradient = Instance.new("UIGradient")
        gradient.Color = ColorSequence.new({
            ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 140, 0)),
            ColorSequenceKeypoint.new(1, Color3.fromRGB(220, 100, 0))
        })
        gradient.Rotation = 90
        gradient.Parent = border

        if layoutOrder then
            btn.LayoutOrder = layoutOrder
        end

        btn.MouseButton1Click:Connect(function()
            clearScripts()
            scriptFooter.Visible = false

            if typeof(contents) == "table" then
                for _, script in ipairs(contents) do
                    createScriptButton(script.Name, script.Func)
                end
            elseif typeof(contents) == "string" then
                createUpdateLabel(contents)
            elseif typeof(contents) == "function" then
                contents()
                if contents == displayUpdates then
                    scriptFooter.Visible = true
                end
            end
            layoutScript:SetAttribute("Refresh", true)
        end)
        return btn
    end

    -- Aba de Atualiza√ß√µes (atualizada com nova nota sobre scroll)
    local updatesTextFormatted = {
        {Text = "Khalexis Hub V1.2", Color = Color3.fromRGB(255, 255, 255), Font = Enum.Font.GothamBold},
        {Text = "+1 Script Steal a Brainrot", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "+1 Script Forsaken", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "+1 Script Pegue o Peixe!", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "Nova Mensagem de Boas Vindas!", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "Corre√ß√µes de Bugs no Scroll", Color = Color3.fromRGB(220, 220, 220)},  -- NOVA NOTA
        {Text = "Tamanho do Hub Editado", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "DEIXE UMA SUGEST√ÉO NO DC!", Color = Color3.fromRGB(255, 140, 0), Font = Enum.Font.GothamBold},
    }

    local function displayUpdates()
        clearScripts()
        for _, lineData in ipairs(updatesTextFormatted) do
            createUpdateLabel(lineData.Text, lineData.Color, lineData.Font)
        end
        scriptFooter.Visible = true
        layoutScript:SetAttribute("Refresh", true)
    end

    -- Defini√ß√µes de Scripts (otimizadas com LayoutOrder onde aplic√°vel)
    local stealScripts = {
        {Name = "Dofug", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/OneClye1/dofug/refs/heads/main/dofug.txt"))() end, LayoutOrder = 1},
        {Name = "Miranda Tween", Func = function() loadstring(game:HttpGet("https://pastefy.app/TnWWJ4NS/raw"))() end, LayoutOrder = 2},
        {Name = "Chilli Hub", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/tienkhanh1/spicy/main/Chilli.lua"))() end, LayoutOrder = 3},
        {Name = "Delfi Script", Func = function() loadstring(game:HttpGet("https://pastefy.app/7MQOgJCO/raw"))() end, LayoutOrder = 4}
    }
    local noiteScripts = {
        {Name = "Iliankytb", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Iliankytb/Iliankytb/main/Best99NightsInTheForest"))() end},
        {Name = "Kenniel Scripts", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Kenniel123/99-Nights-in-the-Forest/refs/heads/main/99%20Nights%20in%20the%20Forest"))() end},
        {Name = "Hutao Hub", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/SLK-gaming/Hutao-Hub/refs/heads/main/99-Nights-In-The-Forest.txt"))() end},
        {Name = "Ringta Script", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/wefwef127382/99daysloader.github.io/refs/heads/main/ringta.lua"))() end},
        {Name = "Voidware", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/VapeVoidware/VWExtra/main/NightsInTheForest.lua", true))() end},
        {Name = "Vex Op", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/yoursvexyyy/VEX-OP/refs/heads/main/99%20nights%20in%20the%20forest"))() end}
    }
    local growScripts = {
        {Name = "No Lag Hub", Func = function() loadstring(game:HttpGet("https://pastebin.com/raw/XHMN2zpp"))() end},
        {Name = "MauScripts", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/nootmaus/GrowAAGarden/refs/heads/main/mauscripts"))() end},
        {Name = "ThanHub", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/thantzy/thanhub/refs/heads/main/thanv1"))() end}
    }
    local voxSeasScripts = {
        {Name = "Brutus Hub", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/codenixstudios/brutus-hub/BRUTUS_TEAM/Games/VoxSeas.lua"))() end},
        {Name = "Type Hub", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/meobeo8/type/main/VoxSeasAutoChest.lua"))() end},
        {Name = "Idk Hub", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/shakaUnlocked/IiI/refs/heads/main/vxs.lua"))() end}
    }
    local bloxFruitsScripts = {
        {Name = "Xero Hub", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Xero2409/XeroHub/refs/heads/main/main.lua"))() end, LayoutOrder = 1},
        {Name = "Volcano Hub", Func = function() loadstring(game:HttpGetAsync("https://raw.githubusercontent.com/indexeduu/BF-NewVer/refs/heads/main/V3New.lua"))() end, LayoutOrder = 2},
        {Name = "Blue X Hub", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Dev-BlueX/BlueX-Hub/refs/heads/main/Main.lua"))() end, LayoutOrder = 3}
    }
    local kingLegacyScripts = {
        {Name = "Zee Hub", Func = function() loadstring(game:HttpGet('https://zuwz.me/Ls-Zee-Hub-KL'))() end}
    }
    local rivalsScripts = {
        {Name = "Rise", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/ShadowBey01/SHWX-Team-Rise-Scripts/refs/heads/main/Games/Rise%20(Rivals).lua", true))() end}
    }
    local doorsScripts = {
        {Name = "Velocity X", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/DasVelocity/VelocityX/refs/heads/main/VelocityX.lua"))() end},
        {Name = "Saturn Hub", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/JScripter-Lua/Saturn_Hub_Products/refs/heads/main/Saturn_Hub_Doors.lua"))() end}
    }
    local brookhavenScripts = {
        {Name = "Sander XY", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/kigredns/testUIDK/refs/heads/main/panel.lua"))() end}
    }
    local buildAPlaneScripts = {
        {Name = "Arbix Hub", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Z1ntrax/bigmac/refs/heads/main/bap/bapobfuscated.lua"))() end}
    }
    local inkGameScripts = {
        {Name = "Revive Hub", Func = function() loadstring(game:HttpGet('https://raw.githubusercontent.com/Have3165/Reviv3-Hub/refs/heads/main/InkGame'))() end}
    }
    local naturalDisasterScripts = {
        {Name = "BaconJJScript", Func = function() loadstring(game:HttpGet("https://pastebin.com/raw/MAnXu0qv"))() end}
    }
    local forsakenScripts = {
        {Name = "SNT HUB", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Snowt69/SNT-HUB/refs/heads/main/Forsaken"))() end}
    }
    local pegueOPeixeScripts = {
        {Name = "VinzHub", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Vinzyy13/VinzHub/refs/heads/main/Fish-It"))() end}
    }

    -- Cria√ß√£o das Categorias (ordem otimizada)
    createCategoryButton("üì£ Atualiza√ß√µes üì£", displayUpdates, 1)
    createCategoryButton("Steal a Brainrot Scripts", stealScripts, 2)
    createCategoryButton("99 Noites na Floresta Scripts", noiteScripts, 3)
    createCategoryButton("Grow a Garden Scripts", growScripts, 4)
    createCategoryButton("Vox Seas Scripts", voxSeasScripts, 5)
    createCategoryButton("Blox Fruits Scripts", bloxFruitsScripts, 6)
    createCategoryButton("King Legacy Scripts", kingLegacyScripts, 7)
    createCategoryButton("Rivals Scripts", rivalsScripts, 8)
    createCategoryButton("Doors Scripts", doorsScripts, 9)
    createCategoryButton("Brookhaven Scripts", brookhavenScripts, 10)
    createCategoryButton("Build a Plane Scripts", buildAPlaneScripts, 11)
    createCategoryButton("Ink Game Scripts", inkGameScripts, 12)
    createCategoryButton("Natural Disaster Scripts", naturalDisasterScripts, 13)
    createCategoryButton("Forsaken Scripts", forsakenScripts, 14)
    createCategoryButton("Pegue o Peixe Scripts", pegueOPeixeScripts, 15)

    -- Clique Inicial na Primeira Categoria
    local firstCategoryButton = categoryContainer:FindFirstChildOfClass("TextButton")
    if firstCategoryButton then
        firstCategoryButton:MouseButton1Click()
    end

    return animationContainer
end

-- Carregamento e Abertura do Hub (com boas-vindas otimizada)
local function showLoadingAndOpenHub()
    LoadingScreen, StopLoadingAnim = showLoadingScreen()
    wait(2)
    if StopLoadingAnim then
        StopLoadingAnim()
    end
    if LoadingScreen and LoadingScreen.Parent then
        LoadingScreen:Destroy()
    end

    if not HasShownWelcome then
        local welcomeFrame = Instance.new("Frame")
        welcomeFrame.Size = UDim2.new(0, 0, 0, 0)
        welcomeFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
        welcomeFrame.AnchorPoint = Vector2.new(0.5, 0.5)
        welcomeFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        welcomeFrame.BorderSizePixel = 0
        welcomeFrame.Parent = ScreenGui
        applyRoundedCorners(welcomeFrame, 16)
        welcomeFrame.BackgroundTransparency = 1

        local border = Instance.new("UIStroke")
        border.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        border.Color = Color3.fromRGB(0, 0, 0)
        border.Thickness = 2
        border.Parent = welcomeFrame

        local welcomeMsg = Instance.new("TextLabel")
        welcomeMsg.Size = UDim2.new(1, 0, 1, 0)
        welcomeMsg.BackgroundTransparency = 1
        welcomeMsg.TextColor3 = Color3.fromRGB(255, 255, 255)
        welcomeMsg.Font = Enum.Font.GothamBold
        welcomeMsg.TextSize = 20
        welcomeMsg.Text = "Bem Vindo " .. userName .. " ao Khalexis Hub!"
        welcomeMsg.TextWrapped = true
        welcomeMsg.TextXAlignment = Enum.TextXAlignment.Center
        welcomeMsg.TextYAlignment = Enum.TextYAlignment.Center
        welcomeMsg.Parent = welcomeFrame

        local tweenInfoExpand = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local goalExpand = {Size = UDim2.new(0, 300, 0, 50), Position = UDim2.new(0.5, -150, 0.5, -25), BackgroundTransparency = 0}
        local tweenExpand = TweenService:Create(welcomeFrame, tweenInfoExpand, goalExpand)

        local tweenInfoFadeOut = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
        local goalFadeOut = {TextTransparency = 1}
        local tweenFadeOut = TweenService:Create(welcomeMsg, tweenInfoFadeOut, goalFadeOut)
        local tweenFadeOutFrame = TweenService:Create(welcomeFrame, tweenInfoFadeOut, {BackgroundTransparency = 1})

        tweenExpand:Play()
        tweenExpand.Completed:Wait()
        wait(1.5)
        tweenFadeOut:Play()
        tweenFadeOutFrame:Play()
        tweenFadeOutFrame.Completed:Wait()

        if welcomeFrame and welcomeFrame.Parent then
            welcomeFrame:Destroy()
        end
        HasShownWelcome = true
    end

    MainFrameContainer = createHub()
    HubOpen = true
    ToggleButton.Visible = false
end

-- Valida√ß√£o de Key (otimizada)
local function validateKeyAndOpen(key, isAuto)
    local lowerKey = key:lower():gsub("%s", "")
    if validKeys[lowerKey] then
        saveKeyLocally(lowerKey)
        if KeyFrame and KeyFrame.Parent then
            KeyFrame:Destroy()
            KeyFrame = nil
        end
        showLoadingAndOpenHub()
        ToggleButton.Visible = false
        if isAuto then
            showAutoMessage("Khalexis Hub carregado! Sua key foi verificada automaticamente.")
        end
        return true
    else
        removeLocalKey()
        if not isAuto then
            showError("Key incorreta")
        end
        return false
    end
end

local function tryAutoValidate()
    local savedKey = loadKeyLocally()
    if savedKey and validKeys[savedKey] then
        return validateKeyAndOpen(savedKey, true)
    else
        removeLocalKey()
        return false
    end
end

-- Frame de Input de Key (otimizado para mobile e anima√ß√µes)
local function createKeyInputFrame()
    local frame = Instance.new("Frame")
    frame.Name = "KeyFrame"
    frame.Size = UDim2.new(0, 300, 0, 240)
    frame.Position = UDim2.new(0.5, -150, 0.5, -120)
    frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    frame.BorderSizePixel = 0
    frame.Parent = ScreenGui
    applyRoundedCorners(frame, 12)

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "KeyTitle"
    titleLabel.Size = UDim2.new(1, 0, 0, 30)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "üîí COLE NO ESPA√áO ABAIXO A SUA KEY üîí"
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 14
    titleLabel.TextYAlignment = Enum.TextYAlignment.Center
    titleLabel.TextXAlignment = Enum.TextXAlignment.Center
    titleLabel.Parent = frame

    local byLabel = Instance.new("TextLabel")
    byLabel.Name = "ByLabel"
    byLabel.Size = UDim2.new(1, 0, 0, 18)
    byLabel.Position = UDim2.new(0, 0, 0, 32)
    byLabel.BackgroundTransparency = 1
    byLabel.TextColor3 = COLOR_FOOTER_TEXT
    byLabel.Font = Enum.Font.Gotham
    byLabel.TextSize = 10
    byLabel.Text = "by khalexis"
    byLabel.TextXAlignment = Enum.TextXAlignment.Center
    byLabel.TextYAlignment = Enum.TextYAlignment.Top
    byLabel.Parent = frame

    -- Anima√ß√£o de Cor no T√≠tulo
    spawn(function()
        local hue = 0
        while frame and frame.Parent do
            hue = (hue + 0.01) % 1
            titleLabel.TextColor3 = Color3.fromHSV(hue, 1, 1)
            wait(0.03)
        end
    end)

    local keyBox = Instance.new("TextBox")
    keyBox.Name = "KeyBox"
    keyBox.Size = UDim2.new(1, -30, 0, 35)
    keyBox.Position = UDim2.new(0, 15, 0, 55)
    keyBox.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    keyBox.TextColor3 = COLOR_TEXT
    keyBox.Font = Enum.Font.Gotham
    keyBox.TextSize = 16
    keyBox.ClearTextOnFocus = false
    keyBox.Text = ""
    keyBox.PlaceholderText = ""
    applyRoundedCorners(keyBox, 8)
    keyBox.Parent = frame

    local confirmBtn = Instance.new("TextButton")
    confirmBtn.Name = "EnterButton"
    confirmBtn.Size = UDim2.new(0, 90, 0, 30)
    confirmBtn.Position = UDim2.new(0.5, -45, 0, 95)
    confirmBtn.BackgroundColor3 = COLOR_SCRIPT_BTN
    confirmBtn.TextColor3 = COLOR_TEXT
    confirmBtn.Font = Enum.Font.GothamBold
    confirmBtn.TextSize = 16
    confirmBtn.Text = "Confirmar"
    applyRoundedCorners(confirmBtn, 8)
    confirmBtn.Parent = frame

    local copyKeyBtn = Instance.new("TextButton")
    copyKeyBtn.Name = "PegarKeyButton"
    copyKeyBtn.Size = UDim2.new(0, 70, 0, 25)
    copyKeyBtn.Position = UDim2.new(0.5, -35, 0, 130)
    copyKeyBtn.BackgroundColor3 = COLOR_SCRIPT_BTN
    copyKeyBtn.TextColor3 = Color3.new(1, 1, 1)
    copyKeyBtn.Font = Enum.Font.GothamBold
    copyKeyBtn.TextSize = 10
    copyKeyBtn.Text = "Pegar Key"
    applyRoundedCorners(copyKeyBtn, 8)
    copyKeyBtn.Parent = frame

    local infoLabel = Instance.new("TextLabel")
    infoLabel.Name = "InfoText"
    infoLabel.Size = UDim2.new(1, -20, 0, 25)
    infoLabel.Position = UDim2.new(0, 10, 0, 165)
    infoLabel.BackgroundTransparency = 1
    infoLabel.Font = Enum.Font.GothamBold
    infoLabel.TextSize = 10
    infoLabel.Text = "CLIQUE EM PEGAR KEY E COLE NO NAVEGADOR"
    infoLabel.TextWrapped = true
    infoLabel.TextXAlignment = Enum.TextXAlignment.Center
    infoLabel.TextYAlignment = Enum.TextYAlignment.Top
    infoLabel.Parent = frame

    local subInfoLabel = Instance.new("TextLabel")
    subInfoLabel.Name = "SubInfoText"
    subInfoLabel.Size = UDim2.new(1, -20, 0, 18)
    subInfoLabel.Position = UDim2.new(0, 10, 0, 190)
    subInfoLabel.BackgroundTransparency = 1
    subInfoLabel.Font = Enum.Font.Gotham
    subInfoLabel.TextSize = 12
    subInfoLabel.TextColor3 = COLOR_FOOTER_TEXT
    subInfoLabel.TextWrapped = false
    subInfoLabel.TextXAlignment = Enum.TextXAlignment.Center
    subInfoLabel.TextYAlignment = Enum.TextYAlignment.Top
    subInfoLabel.Text = "Sistema de Key - Khalexis Hub"
    subInfoLabel.Parent = frame

    -- Anima√ß√£o de Cor na Info
    spawn(function()
        local hue = 0
        while frame and frame.Parent do
            hue = (hue + 0.01) % 1
            infoLabel.TextColor3 = Color3.fromHSV(hue, 1, 1)
            wait(0.03)
        end
    end)

    ErrorLabel = Instance.new("TextLabel")
    ErrorLabel.Name = "ErrorLabel"
    ErrorLabel.Size = UDim2.new(1, 0, 0, 20)
    ErrorLabel.Position = UDim2.new(0, 0, 1, -70)
    ErrorLabel.BackgroundTransparency = 1
    ErrorLabel.TextColor3 = COLOR_ERROR
    ErrorLabel.Font = Enum.Font.GothamBold
    ErrorLabel.TextSize = 14
    ErrorLabel.Text = ""
    ErrorLabel.Parent = frame

    local function showLocalError(msg)
        ErrorLabel.Text = msg
        spawn(function()
            wait(2)
            if ErrorLabel and ErrorLabel.Parent == frame then
                ErrorLabel.Text = ""
            end
        end)
    end

    copyKeyBtn.MouseButton1Click:Connect(function()
        local success = copyToClipboard("discord.gg/aNaFpb2Qsb")
        if success then
            copyKeyBtn.Text = "Link copiado!"
            wait(2)
            copyKeyBtn.Text = "Pegar Key"
        else
            showLocalError("Falha ao copiar.")
        end
    end)

    confirmBtn.MouseButton1Click:Connect(function()
        validateKeyAndOpen(keyBox.Text, false)
    end)

    return frame, showLocalError
end

-- Toggle Button (otimizado com arrasto limpo)
ToggleButton = Instance.new("TextButton")
ToggleButton.Name = "ToggleButton"
ToggleButton.Size = UDim2.new(0, 35, 0, 35)
ToggleButton.Position = UDim2.new(0, 10, 0, 10)
ToggleButton.BackgroundColor3 = Color3.new(0, 0, 0)
ToggleButton.TextColor3 = Color3.new(1, 1, 1)
ToggleButton.Text = "K"
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.TextSize = 24
ToggleButton.Parent = ScreenGui
applyRoundedCorners(ToggleButton, 10)
ToggleButton.Visible = false

local draggingToggle = false
local currentInputObjectToggle = nil

ToggleButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        draggingToggle = true
        local dragStartToggle = input.Position
        local startPosToggle = ToggleButton.Position
        currentInputObjectToggle = input

        local connection
        connection = input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                draggingToggle = false
                currentInputObjectToggle = nil
                connection:Disconnect()
            end
        end)

        UserInputService.InputChanged:Connect(function(inputChanged)
            if draggingToggle and currentInputObjectToggle == inputChanged and (inputChanged.UserInputType == Enum.UserInputType.MouseMovement or inputChanged.UserInputType == Enum.UserInputType.Touch) then
                local delta = inputChanged.Position - dragStartToggle
                ToggleButton.Position = UDim2.new(startPosToggle.X.Scale, startPosToggle.X.Offset + delta.X, startPosToggle.Y.Scale, startPosToggle.Y.Offset + delta.Y)
            end
        end)
    end
end)

ToggleButton.MouseButton1Click:Connect(function()
    if HubOpen then
        if MainFrameContainer then
            closeHubWithAnimation(MainFrameContainer)
        end
    else
        if KeyFrame and KeyFrame.Parent then
            KeyFrame:Destroy()
            KeyFrame = nil
        end
        if LoadingScreen and LoadingScreen.Parent then
            if StopLoadingAnim then
                StopLoadingAnim()
            end
            LoadingScreen:Destroy()
            LoadingScreen = nil
        end

        if HasShownWelcome then
            MainFrameContainer = createHub()
            HubOpen = true
            ToggleButton.Visible = false
        else
            showLoadingAndOpenHub()
        end
    end
end)

-- Inicializa√ß√£o (valida√ß√£o autom√°tica de key)
if not tryAutoValidate() then
    KeyFrame, showError = createKeyInputFrame()
end
