--[[
    -- Khalexis Hub - Script Hub para Roblox com sistema de key, barra de pesquisa e configura√ß√µes de tema
    -- Chaves v√°lidas: "khalexispremium100", "khalexislindodms10"
    -- Mensagem de erro: "Key incorreta"
    -- Toggle "K" branco em quadrado preto arredondado
    -- Toggle aparece sempre vis√≠vel, clic√°vel e arrast√°vel (mouse/touch)
--]]

local function applyRoundedCorners(guiObject, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 8)
    corner.Parent = guiObject
end

local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "KhalexisHub"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game.CoreGui

-- Paletas de Cores para os Temas
local themes = {
    normal = {
        main_bg = Color3.fromRGB(30, 30, 30),
        category_bg = Color3.fromRGB(50, 50, 50),
        title_bar = Color3.fromRGB(45, 45, 45),
        script_frame_bg = Color3.fromRGB(30, 30, 30),
        transparency = 0
    },
    preto = {
        main_bg = Color3.fromRGB(10, 10, 10),
        category_bg = Color3.fromRGB(25, 25, 25),
        title_bar = Color3.fromRGB(20, 20, 20),
        script_frame_bg = Color3.fromRGB(10, 10, 10),
        transparency = 0
    },
    laranja = {
        main_bg = Color3.fromRGB(255, 140, 0),
        category_bg = Color3.fromRGB(40, 40, 40),
        title_bar = Color3.fromRGB(30, 30, 30),
        script_frame_bg = Color3.fromRGB(50, 50, 50),
        transparency = 0
    },
    roxo = {
        main_bg = Color3.fromRGB(138, 43, 226),
        category_bg = Color3.fromRGB(40, 40, 40),
        title_bar = Color3.fromRGB(30, 30, 30),
        script_frame_bg = Color3.fromRGB(50, 50, 50),
        transparency = 0
    },
    transparente = {
        main_bg = Color3.fromRGB(30, 30, 30),
        category_bg = Color3.fromRGB(50, 50, 50),
        title_bar = Color3.fromRGB(45, 45, 45),
        script_frame_bg = Color3.fromRGB(30, 30, 30),
        transparency = 0.4
    }
}

-- Cores Padr√£o
local COLOR_BLACK = themes.normal.main_bg
local COLOR_CATEGORY_BG = themes.normal.category_bg -- Cor cinza das categorias
local COLOR_CATEGORY_BTN = Color3.fromRGB(90, 90, 90)
local COLOR_SCRIPT_BTN = Color3.fromRGB(70, 70, 70)
local COLOR_TITLEBAR = themes.normal.title_bar
local COLOR_TEXT = Color3.fromRGB(220, 220, 220)
local COLOR_ERROR = Color3.fromRGB(255, 85, 85)
local COLOR_FOOTER_TEXT = Color3.fromRGB(170, 170, 170)

local userId = player.UserId
local userName = player.Name
local KeyFrame, MainFrameContainer
local LoadingScreen, StopLoadingAnim
local HubOpen = false
local ToggleButton
local ErrorLabel
local HasShownWelcome = false -- Nova vari√°vel para controlar se a mensagem de boas-vindas j√° foi exibida

local StorageKeyFileName = "KhalexisHubKey.txt"
local validKeys = {
    khalexispremium100 = true, -- Chave premium mantida
    khalexislindodms10 = true  -- Nova chave normal
}

local function saveKeyLocally(key) pcall(function() if writefile then writefile(StorageKeyFileName, key) elseif write_file then write_file(StorageKeyFileName, key) end end) end
local function loadKeyLocally() local s,c = pcall(function() if readfile then return readfile(StorageKeyFileName) elseif read_file then return read_file(StorageKeyFileName) end end); if s and c then return c:lower() end; return nil end
local function removeLocalKey() pcall(function() if delfile then delfile(StorageKeyFileName)elseif deletefile then deletefile(StorageKeyFileName) end end) end

local function showAutoMessage(msg) local m = Instance.new("Frame"); m.Name="AutoMessageFrame"; m.Size=UDim2.new(0,320,0,45); m.Position=UDim2.new(1,-330,1,-55); m.BackgroundColor3=COLOR_BLACK; m.BorderSizePixel=0; m.Parent=ScreenGui; applyRoundedCorners(m,10); local l=Instance.new("TextLabel"); l.Size=UDim2.new(1,-20,1,-10); l.Position=UDim2.new(0,10,0,5); l.BackgroundTransparency=1; l.TextColor3=COLOR_TEXT; l.Font=Enum.Font.GothamBold; l.TextSize=16; l.Text=msg; l.TextWrapped=true; l.TextXAlignment=Enum.TextXAlignment.Left; l.TextYAlignment=Enum.TextYAlignment.Center; l.Parent=m; spawn(function() wait(4); if m and m.Parent then m:Destroy() end end) end
local function showError(msg) if ErrorLabel then ErrorLabel.Text=msg; spawn(function() wait(2); if ErrorLabel and ErrorLabel.Parent then ErrorLabel.Text="" end end) end end
local function copyToClipboard(text) return pcall(function() if setclipboard then setclipboard(text)elseif toclipboard then toclipboard(text) else error("Clipboard function not supported.") end end) end

-- Fun√ß√£o reutiliz√°vel para a anima√ß√£o de fechamento
local function closeHubWithAnimation(container)
    if not (container and container.Parent) then return end

    local uiScaler = container:FindFirstChildOfClass("UIScale")
    if not uiScaler then
        container:Destroy()
        return
    end

    local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
    local goal = { Scale = 0 }
    local tween = TweenService:Create(uiScaler, tweenInfo, goal)
    tween:Play()
    tween.Completed:Wait()

    if container and container.Parent then
        container:Destroy()
    end
    MainFrameContainer = nil
    HubOpen = false
    ToggleButton.Visible = true
end

local function showLoadingScreen()
    local frame = Instance.new("Frame")
    frame.Name = "LoadingFrame"
    frame.Size = UDim2.new(0, 300, 0, 120)
    frame.Position = UDim2.new(0.5, -150, 0.5, -60)
    frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    frame.BorderSizePixel = 0
    frame.Parent = ScreenGui
    applyRoundedCorners(frame, 16)

    local border = Instance.new("UIStroke")
    border.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    border.Color = Color3.fromRGB(0, 0, 0)
    border.Thickness = 2
    border.Parent = frame

    local label = Instance.new("TextLabel")
    label.Name = "LoadingLabel"
    label.Size = UDim2.new(1, 0, 0, 30)
    label.Position = UDim2.new(0, 0, 0.3, -15)
    label.BackgroundTransparency = 1
    label.Text = "Carregando..."
    label.TextColor3 = COLOR_TEXT
    label.Font = Enum.Font.GothamBold
    label.TextSize = 20
    label.Parent = frame

    local spinner = Instance.new("Frame")
    spinner.Size = UDim2.new(0, 50, 0, 50)
    spinner.Position = UDim2.new(0.5, -25, 0, 60)
    spinner.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    spinner.BorderSizePixel = 0
    applyRoundedCorners(spinner, 25)
    spinner.Parent = frame

    local orangeBall = Instance.new("Frame")
    orangeBall.Size = UDim2.new(0, 50, 0, 50)
    orangeBall.Position = UDim2.new(0, 0, 0, 0)
    orangeBall.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
    applyRoundedCorners(orangeBall, 25)
    orangeBall.Parent = spinner

    local whiteBall = Instance.new("Frame")
    whiteBall.Size = UDim2.new(0, 20, 0, 20)
    whiteBall.Position = UDim2.new(0.5, -10, 0.5, -10)
    whiteBall.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    applyRoundedCorners(whiteBall, 10)
    whiteBall.Parent = orangeBall

    local angle = 0
    local connection
    connection = RunService.RenderStepped:Connect(function()
        angle = (angle + 6) % 360
        orangeBall.Rotation = angle
        whiteBall.Rotation = -angle * 2
    end)

    return frame, function()
        if connection then
            connection:Disconnect()
            connection = nil
        end
    end
end

local function applyTheme(themeName)
    local palette = themes[themeName]
    if not palette or not MainFrameContainer then return end
    local MainFrame = MainFrameContainer:FindFirstChild("MainFrame")
    if not MainFrame then return end

    local titleBar=MainFrame:FindFirstChild("TitleBar")
    local categoryFrame=MainFrame:FindFirstChild("CategoryFrame")
    local scriptFrame=MainFrame:FindFirstChild("ScriptFrame")
    local footerBackground=MainFrame:FindFirstChild("FooterBackground")

    MainFrame.BackgroundColor3 = palette.main_bg
    MainFrame.BackgroundTransparency = palette.transparency
    if titleBar then titleBar.BackgroundColor3=palette.title_bar end
    if categoryFrame then categoryFrame.BackgroundColor3=palette.category_bg end
    if scriptFrame then scriptFrame.BackgroundColor3=palette.script_frame_bg end
    if footerBackground and (themeName=="normal" or themeName=="preto" or themeName=="transparente") then footerBackground.BackgroundColor3=palette.title_bar end
end

local function createHub()
    local animationContainer = Instance.new("Frame")
    animationContainer.Name = "AnimationContainer"
    -- TAMANHO DO HUB MAIS AJUSTADO E CENTRALIZADO
    animationContainer.Size = UDim2.new(0, 350, 0, 280) -- Ajustado para ser um pouco menor
    animationContainer.AnchorPoint = Vector2.new(0.5, 0.5)
    animationContainer.Position = UDim2.new(0.5, 0, 0.5, 0) -- Centralizado
    animationContainer.BackgroundTransparency = 1
    animationContainer.Parent = ScreenGui

    local uiScaler = Instance.new("UIScale")
    uiScaler.Parent = animationContainer

    local frame = Instance.new("Frame")
    frame.Name="MainFrame"
    frame.Size=UDim2.new(1, 0, 1, 0)
    frame.Position=UDim2.new(0, 0, 0, 0)
    frame.BackgroundColor3=COLOR_BLACK
    frame.BorderSizePixel=0
    frame.Parent=animationContainer
    frame.Visible=true
    applyRoundedCorners(frame,12)

    local hubBorder=Instance.new("UIStroke")
    hubBorder.ApplyStrokeMode=Enum.ApplyStrokeMode.Border
    hubBorder.Thickness=2
    hubBorder.LineJoinMode=Enum.LineJoinMode.Round
    hubBorder.Parent=frame
    local hubGradient=Instance.new("UIGradient")
    hubGradient.Color=ColorSequence.new({ColorSequenceKeypoint.new(0,Color3.fromRGB(255,140,0)),ColorSequenceKeypoint.new(1,Color3.fromRGB(220,100,0))})
    hubGradient.Rotation=45
    hubGradient.Parent=hubBorder

    local titleBar=Instance.new("Frame")
    titleBar.Name="TitleBar"
    titleBar.Size=UDim2.new(1,-10,0,30) -- Altura do t√≠tulo ajustada
    titleBar.Position = UDim2.new(0, 5, 0, 5)
    titleBar.BackgroundColor3=COLOR_TITLEBAR
    titleBar.BorderSizePixel=0
    titleBar.Parent=frame
    applyRoundedCorners(titleBar,10)

    local titleBarBorder=Instance.new("UIStroke")
    titleBarBorder.ApplyStrokeMode=Enum.ApplyStrokeMode.Border
    titleBarBorder.Thickness=1.5
    titleBarBorder.LineJoinMode=Enum.LineJoinMode.Round
    titleBarBorder.Parent=titleBar
    local titleBarGradient=Instance.new("UIGradient")
    titleBarGradient.Color=ColorSequence.new({ColorSequenceKeypoint.new(0,Color3.fromRGB(255,140,0)),ColorSequenceKeypoint.new(1,Color3.fromRGB(220,100,0))})
    titleBarGradient.Rotation=90
    titleBarGradient.Parent=titleBarBorder

    local titleLabel=Instance.new("TextLabel")
    titleLabel.Name="Title"
    titleLabel.Size=UDim2.new(1,0,1,0)
    titleLabel.BackgroundTransparency=1
    titleLabel.Text="Khalexis Hub"
    titleLabel.TextColor3=COLOR_TEXT
    titleLabel.Font=Enum.Font.GothamBold
    titleLabel.TextSize=18 -- Tamanho da fonte do t√≠tulo ajustado
    titleLabel.TextXAlignment=Enum.TextXAlignment.Center
    titleLabel.TextYAlignment=Enum.TextYAlignment.Center
    titleLabel.Parent=titleBar

    -- Bot√£o de fechar com design moderno
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.Size = UDim2.new(0, 24, 0, 24) -- Tamanho do bot√£o ajustado
    closeButton.Position = UDim2.new(1, -28, 0.5, -12) -- Posi√ß√£o ajustada
    closeButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
    closeButton.BackgroundTransparency = 1
    closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeButton.Font = Enum.Font.GothamBold
    closeButton.TextSize = 18 -- Tamanho da fonte ajustado
    closeButton.Text = "X"
    closeButton.Parent = titleBar
    applyRoundedCorners(closeButton, 12) -- Raio ajustado

    local closeTweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad)
    closeButton.MouseEnter:Connect(function()
        TweenService:Create(closeButton, closeTweenInfo, {BackgroundTransparency = 0.5}):Play()
    end)
    closeButton.MouseLeave:Connect(function()
        TweenService:Create(closeButton, closeTweenInfo, {BackgroundTransparency = 1}):Play()
    end)

    closeButton.MouseButton1Click:Connect(function()
        closeHubWithAnimation(animationContainer)
    end)

    local searchBox=Instance.new("TextBox")
    searchBox.Name="CategorySearchBox"
    searchBox.Size=UDim2.new(0,120,0,22) -- Reduzido para celular
    searchBox.Position=UDim2.new(0,5,0,40) -- Posi√ß√£o ajustada
    searchBox.BackgroundColor3=Color3.fromRGB(40,40,40)
    searchBox.TextColor3=COLOR_TEXT
    searchBox.PlaceholderText="üîç Pesquisar..."
    searchBox.PlaceholderColor3=Color3.fromRGB(150,150,150)
    searchBox.Text=""
    searchBox.Font=Enum.Font.Gotham
    searchBox.TextSize=11 -- Reduzido para celular
    searchBox.ClearTextOnFocus=false
    searchBox.Parent=frame
    applyRoundedCorners(searchBox,8)

    local searchBoxBorder=Instance.new("UIStroke")
    searchBoxBorder.ApplyStrokeMode=Enum.ApplyStrokeMode.Border
    searchBoxBorder.Thickness=1.5
    searchBoxBorder.LineJoinMode=Enum.LineJoinMode.Round
    searchBoxBorder.Parent=searchBox
    local searchBoxGradient=Instance.new("UIGradient")
    searchBoxGradient.Color=ColorSequence.new({ColorSequenceKeypoint.new(0,Color3.fromRGB(255,140,0)),ColorSequenceKeypoint.new(1,Color3.fromRGB(220,100,0))})
    searchBoxGradient.Rotation=90
    searchBoxGradient.Parent=searchBoxBorder

    local categoryFrame=Instance.new("ScrollingFrame")
    categoryFrame.Name="CategoryFrame"
    categoryFrame.Size=UDim2.new(0,120,1,-70) -- ALTURA AJUSTADA PARA DAR MAIS ESPA√áO PARA AS CATEGORIAS
    categoryFrame.Position=UDim2.new(0,5,0,67) -- Posi√ß√£o ajustada
    categoryFrame.BackgroundColor3=COLOR_CATEGORY_BG
    categoryFrame.BorderSizePixel=0
    categoryFrame.ScrollBarThickness=6
    categoryFrame.Parent=frame
    applyRoundedCorners(categoryFrame,12)

    local categoryFrameBorder=Instance.new("UIStroke")
    categoryFrameBorder.ApplyStrokeMode=Enum.ApplyStrokeMode.Border
    categoryFrameBorder.Thickness=1.5
    categoryFrameBorder.LineJoinMode=Enum.LineJoinMode.Round
    categoryFrameBorder.Parent=categoryFrame
    local categoryFrameGradient=Instance.new("UIGradient")
    categoryFrameGradient.Color=ColorSequence.new({ColorSequenceKeypoint.new(0,Color3.fromRGB(255,140,0)),ColorSequenceKeypoint.new(1,Color3.fromRGB(220,100,0))})
    categoryFrameGradient.Rotation=90
    categoryFrameGradient.Parent=categoryFrameBorder

    local categoryContainer=Instance.new("Frame")
    categoryContainer.Name="CategoryContainer"
    categoryContainer.Size=UDim2.new(1,-10,0,0)
    categoryContainer.Position=UDim2.new(0,5,0,5)
    categoryContainer.BackgroundTransparency=1
    categoryContainer.Parent=categoryFrame
    categoryContainer.ClipsDescendants=true
    local layoutCategory=Instance.new("UIListLayout")
    -- AUMENTADO O PADDING PARA DAR MAIS ESPA√áO ENTRE AS CATEGORIAS E PERMITIR MAIS ROLAGEM
    layoutCategory.Padding=UDim.new(0,12)
    layoutCategory.SortOrder=Enum.SortOrder.LayoutOrder
    layoutCategory.FillDirection=Enum.FillDirection.Vertical
    layoutCategory.HorizontalAlignment=Enum.HorizontalAlignment.Center
    layoutCategory.Parent=categoryContainer
    -- Conecta para ajustar o tamanho do CategoryContainer
    layoutCategory:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        categoryContainer.Size=UDim2.new(1,-10,0,layoutCategory.AbsoluteContentSize.Y)
    end)
    searchBox:GetPropertyChangedSignal("Text"):Connect(function() local s=searchBox.Text:lower(); for _,b in ipairs(categoryContainer:GetChildren()) do if b:IsA("TextButton") then local n=b.Text:lower(); b.Visible=string.find(n,s,1,true) end end end)

    local scriptFrame=Instance.new("ScrollingFrame")
    scriptFrame.Name="ScriptFrame"
    scriptFrame.Size=UDim2.new(1,-135,1,-60) -- Largura e altura ajustadas
    scriptFrame.Position=UDim2.new(0,130,0,40) -- Posi√ß√£o ajustada
    scriptFrame.BackgroundColor3=COLOR_BLACK
    scriptFrame.BorderSizePixel=0
    scriptFrame.ScrollBarThickness=6
    scriptFrame.Parent=frame
    applyRoundedCorners(scriptFrame,16)

    local scriptFrameBorder=Instance.new("UIStroke")
    scriptFrameBorder.ApplyStrokeMode=Enum.ApplyStrokeMode.Border
    scriptFrameBorder.Thickness=1.5
    scriptFrameBorder.LineJoinMode=Enum.LineJoinMode.Round
    scriptFrameBorder.Parent=scriptFrame
    local scriptFrameGradient=Instance.new("UIGradient")
    scriptFrameGradient.Color=ColorSequence.new({ColorSequenceKeypoint.new(0,Color3.fromRGB(255,140,0)),ColorSequenceKeypoint.new(1,Color3.fromRGB(220,100,0))})
    scriptFrameGradient.Rotation=90
    scriptFrameGradient.Parent=scriptFrameBorder

    local scriptContainer=Instance.new("Frame")
    scriptContainer.Name="ScriptContainer"
    scriptContainer.Size=UDim2.new(1,-20,0,0)
    scriptContainer.Position=UDim2.new(0,10,0,10)
    scriptContainer.BackgroundTransparency=1
    scriptContainer.Parent=scriptFrame
    scriptContainer.ClipsDescendants=true
    local layoutScript=Instance.new("UIListLayout")
    layoutScript.Padding=UDim.new(0,6) -- Padding ajustado
    layoutScript.SortOrder=Enum.SortOrder.LayoutOrder
    layoutScript.FillDirection=Enum.FillDirection.Vertical
    layoutScript.HorizontalAlignment=Enum.HorizontalAlignment.Center
    layoutScript.Parent=scriptContainer
    -- Conecta para ajustar o tamanho do ScriptContainer
    layoutScript:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        scriptContainer.Size=UDim2.new(1,-20,0,layoutScript.AbsoluteContentSize.Y)
    end)

    -- Rodap√© do scriptContainer para a aba de Atualiza√ß√µes
    local scriptFooter = Instance.new("TextLabel")
    scriptFooter.Name = "ScriptFooter"
    scriptFooter.Size = UDim2.new(1, 0, 0, 18) -- Altura ajustada
    scriptFooter.BackgroundTransparency = 1
    scriptFooter.TextColor3 = Color3.fromRGB(150, 150, 150)
    scriptFooter.Font = Enum.Font.Gotham
    scriptFooter.TextSize = 12 -- Tamanho da fonte ajustado
    scriptFooter.Text = "Algum Script parou de funcionar? NOS COMUNIQUE!"
    scriptFooter.TextWrapped = true
    scriptFooter.TextXAlignment = Enum.TextXAlignment.Center
    scriptFooter.TextYAlignment = Enum.TextYAlignment.Bottom
    scriptFooter.LayoutOrder = 999 -- Garante que ele fique no final
    scriptFooter.Parent = scriptContainer
    scriptFooter.Visible = false -- Inicialmente invis√≠vel, s√≥ aparece na aba de atualiza√ß√µes

    local footerBackground=Instance.new("Frame")
    footerBackground.Name="FooterBackground"
    footerBackground.Size=UDim2.new(1,-10,0,40) -- Altura ajustada
    footerBackground.Position=UDim2.new(0,5,1,-45) -- Posi√ß√£o ajustada
    footerBackground.BackgroundColor3=COLOR_TITLEBAR
    footerBackground.BackgroundTransparency=0
    footerBackground.BorderSizePixel=0
    footerBackground.Parent=frame
    applyRoundedCorners(footerBackground,10)

    local footerBorder=Instance.new("UIStroke")
    footerBorder.ApplyStrokeMode=Enum.ApplyStrokeMode.Border
    footerBorder.Thickness=1.5
    footerBorder.LineJoinMode=Enum.LineJoinMode.Round
    footerBorder.Parent=footerBackground
    local footerGradient=Instance.new("UIGradient")
    footerGradient.Color=ColorSequence.new({ColorSequenceKeypoint.new(0,Color3.fromRGB(255,140,0)),ColorSequenceKeypoint.new(1,Color3.fromRGB(220,100,0))})
    footerGradient.Rotation=90
    footerGradient.Parent=footerBorder

    local footerText=Instance.new("TextLabel")
    footerText.Name="FooterText"
    footerText.Text="By Khalexis"
    footerText.Font=Enum.Font.GothamBold
    footerText.TextSize=10 -- Tamanho da fonte ajustado
    footerText.TextColor3=COLOR_FOOTER_TEXT
    footerText.BackgroundTransparency=1
    footerText.Size=UDim2.new(1, 0, 1, 0)
    footerText.Position=UDim2.new(0, 0, 0, 5)
    footerText.TextYAlignment = Enum.TextYAlignment.Top
    footerText.Parent=footerBackground

    local footerRightContainer = Instance.new("Frame")
    footerRightContainer.Name = "FooterRightContainer"
    footerRightContainer.Size = UDim2.new(0.5, 0, 1, 0)
    footerRightContainer.Position = UDim2.new(0.5, 0, 0, 0)
    footerRightContainer.BackgroundTransparency = 1
    footerRightContainer.Parent = footerBackground
    local footerContainerPadding = Instance.new("UIPadding")
    footerContainerPadding.PaddingRight = UDim.new(0, 8) -- Padding ajustado
    footerContainerPadding.Parent = footerRightContainer
    local footerTextLayout = Instance.new("UIListLayout")
    footerTextLayout.FillDirection = Enum.FillDirection.Vertical
    footerTextLayout.VerticalAlignment = Enum.VerticalAlignment.Center
    footerTextLayout.HorizontalAlignment = Enum.HorizontalAlignment.Right
    footerTextLayout.SortOrder = Enum.SortOrder.LayoutOrder
    footerTextLayout.Padding = UDim.new(0, 1) -- Padding ajustado
    footerTextLayout.Parent = footerRightContainer

    local ytLabel=Instance.new("TextLabel")
    ytLabel.Name="YouTubeLabel"
    ytLabel.Text="Youtube: Khalexis"
    ytLabel.Font=Enum.Font.Gotham
    ytLabel.TextSize=9 -- Tamanho da fonte ajustado
    ytLabel.TextColor3=Color3.fromRGB(180,180,180)
    ytLabel.BackgroundTransparency=1
    ytLabel.Size=UDim2.new(1, 0, 0, 10) -- Altura ajustada
    ytLabel.TextXAlignment=Enum.TextXAlignment.Right
    ytLabel.LayoutOrder = 1
    ytLabel.Parent=footerRightContainer
    local discordLabel=Instance.new("TextLabel")
    discordLabel.Name="DiscordLabel"
    discordLabel.Text="Discord: discord.gg/aNaFpb2Qsb"
    discordLabel.Font=Enum.Font.Gotham
    discordLabel.TextSize=9 -- Tamanho da fonte ajustado
    discordLabel.TextColor3=Color3.fromRGB(180,180,180)
    discordLabel.BackgroundTransparency=1
    discordLabel.Size=UDim2.new(1, 0, 0, 10) -- Altura ajustada
    discordLabel.TextXAlignment=Enum.TextXAlignment.Right
    discordLabel.LayoutOrder = 2
    discordLabel.Parent=footerRightContainer
    local hintLabel=Instance.new("TextLabel")
    hintLabel.Name="DudaLabel"
    hintLabel.Text="Se tiver alguma d√∫vida entre no Discord!"
    hintLabel.Font=Enum.Font.Gotham
    hintLabel.TextSize=7 -- Tamanho da fonte ajustado
    hintLabel.TextColor3=Color3.fromRGB(150,150,150)
    hintLabel.BackgroundTransparency=1
    hintLabel.Size=UDim2.new(1, 0, 0, 9) -- Altura ajustada
    hintLabel.TextXAlignment=Enum.TextXAlignment.Right
    hintLabel.LayoutOrder = 3
    hintLabel.Parent=footerRightContainer

    local playerInfo=Instance.new("Frame")
    playerInfo.Name="PlayerInfoFrame"
    playerInfo.Size=UDim2.new(0,90,0,25) -- Tamanho ajustado
    playerInfo.Position=UDim2.new(0,8,0.5,-12) -- Posi√ß√£o ajustada
    playerInfo.BackgroundTransparency=1 -- Deixando transparente como originalmente
    playerInfo.Parent=footerBackground
   
    -- Removendo playerInfoBg e seus componentes de borda
   
    local avatar=Instance.new("ImageLabel")
    avatar.Name="AvatarImage"
    avatar.Size=UDim2.new(0,24,0,24) -- Tamanho ajustado
    avatar.Position=UDim2.new(0,0,0,0) -- Posi√ß√£o ajustada para ficar diretamente no playerInfo
    avatar.BackgroundColor3=COLOR_SCRIPT_BTN
    avatar.BorderSizePixel=0
    avatar.Parent=playerInfo -- Parented diretamente para playerInfo
    avatar.ScaleType=Enum.ScaleType.Fit
    applyRoundedCorners(avatar,12) -- Raio ajustado
    local thumbType,thumbSize=Enum.ThumbnailType.HeadShot,Enum.ThumbnailSize.Size48x48
    local thumbContent,_=Players:GetUserThumbnailAsync(userId,thumbType,thumbSize)
    avatar.Image=thumbContent
   
    local playerNameLabel=Instance.new("TextLabel")
    playerNameLabel.Name="PlayerNameLabel"
    playerNameLabel.Size=UDim2.new(1,-28,1,0) -- Tamanho ajustado para o nome
    playerNameLabel.Position=UDim2.new(0,28,0,0) -- Posi√ß√£o ajustada para o nome
    playerNameLabel.BackgroundTransparency=1
    playerNameLabel.Text=userName
    playerNameLabel.TextColor3 = Color3.fromRGB(255, 255, 255) -- NOME BRANCO
    playerNameLabel.Font=Enum.Font.Gotham
    playerNameLabel.TextSize=10 -- Tamanho da fonte ajustado
    playerNameLabel.TextXAlignment=Enum.TextXAlignment.Left
    playerNameLabel.Parent=playerInfo -- Parented diretamente para playerInfo

    local dragging=false
    local dragInput,dragStart,startPos
    -- CORRE√á√ÉO DO BUG DE ARRASTAR: Usar um InputObject global para arrastar o hub
    local currentInputObject = nil
   
    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType==Enum.UserInputType.MouseButton1 or input.UserInputType==Enum.UserInputType.Touch then
            dragging=true
            dragStart=input.Position
            startPos=animationContainer.Position
            currentInputObject = input -- Armazena o objeto de input atual

            local connection
            connection = input.Changed:Connect(function()
                if input.UserInputState==Enum.UserInputState.Ended then
                    dragging=false
                    currentInputObject = nil
                    connection:Disconnect()
                end
            end)
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and currentInputObject == input and (input.UserInputType==Enum.UserInputType.MouseMovement or input.UserInputType==Enum.UserInputType.Touch) then
            local delta=input.Position-dragStart
            animationContainer.Position=UDim2.new(startPos.X.Scale,startPos.X.Offset+delta.X,startPos.Y.Scale,startPos.Y.Offset+delta.Y)
        end
    end)


    local function clearScripts()
        for _,c in pairs(scriptContainer:GetChildren()) do
            if c:IsA("GuiObject") and c.Name ~= "ScriptFooter" then -- Garante que o rodap√© n√£o seja destru√≠do
                c:Destroy()
            end
        end
        -- Garante que o layout seja atualizado depois de limpar
        if layoutScript then layoutScript:SetAttribute("Refresh", true) end
    end

    local function createScriptButton(name, func)
        local btn=Instance.new("TextButton")
        btn.Size=UDim2.new(1,0,0,28) -- Altura ajustada
        btn.BackgroundColor3=COLOR_SCRIPT_BTN
        btn.BorderSizePixel=0
        btn.TextColor3=COLOR_TEXT
        btn.Font=Enum.Font.Gotham
        btn.TextSize=12 -- Tamanho da fonte ajustado
        btn.Text=name
        btn.TextXAlignment=Enum.TextXAlignment.Center
        btn.Parent=scriptContainer
        applyRoundedCorners(btn,10) -- Raio ajustado
        local border=Instance.new("UIStroke")
        border.ApplyStrokeMode=Enum.ApplyStrokeMode.Border
        border.Thickness=1.5
        border.LineJoinMode=Enum.LineJoinMode.Round
        border.Parent=btn
        local gradient=Instance.new("UIGradient")
        gradient.Color=ColorSequence.new({ColorSequenceKeypoint.new(0,Color3.fromRGB(255,140,0)),ColorSequenceKeypoint.new(1,Color3.fromRGB(220,100,0))})
        gradient.Rotation=90
        gradient.Parent=border

        btn.MouseButton1Click:Connect(function()
            btn.Text = "Executando..."
            btn.Active = false
            btn.AutoButtonColor = false
            spawn(function()
                pcall(func)
                wait(3)
                closeHubWithAnimation(MainFrameContainer) -- Use MainFrameContainer para fechar o hub
            end)
        end)
        return btn
    end

    local function createUpdateLabel(text, textColor, font)
        local lbl=Instance.new("TextLabel")
        lbl.Size=UDim2.new(1,0,0,18) -- Altura ajustada
        lbl.BackgroundTransparency=1
        lbl.TextColor3=textColor or COLOR_TEXT -- Usar textColor se fornecido, sen√£o COLOR_TEXT
        lbl.Font=font or Enum.Font.Gotham -- Usa a fonte especificada ou Gotham padr√£o
        lbl.TextSize=12 -- Tamanho da fonte ajustado
        lbl.Text=text
        lbl.TextWrapped=true
        lbl.TextXAlignment=Enum.TextXAlignment.Center
        lbl.TextYAlignment=Enum.TextYAlignment.Top
        lbl.Parent=scriptContainer
        return lbl
    end

    local function createCategoryButton(name, contents, layoutOrder)
        local btn=Instance.new("TextButton")
        btn.Name = name:gsub("%s+", "") -- Nome √∫nico para o bot√£o
        btn.Size=UDim2.new(1,0,0,22) -- Altura ajustada
        btn.BackgroundColor3=COLOR_CATEGORY_BTN
        btn.BorderSizePixel=0
        btn.TextColor3=Color3.fromRGB(230,230,230)
        btn.Font=Enum.Font.Gotham
        btn.TextSize=9 -- Tamanho da fonte ajustado
        btn.Text=name
        btn.TextXAlignment=Enum.TextXAlignment.Center
        btn.Parent=categoryContainer
        applyRoundedCorners(btn,8)
        local border=Instance.new("UIStroke")
        border.ApplyStrokeMode=Enum.ApplyStrokeMode.Border
        border.Thickness=1.5
        border.LineJoinMode=Enum.LineJoinMode.Round
        border.Parent=btn
        local gradient=Instance.new("UIGradient")
        gradient.Color=ColorSequence.new({ColorSequenceKeypoint.new(0,Color3.fromRGB(255,140,0)),ColorSequenceKeypoint.new(1,Color3.fromRGB(220,100,0))})
        gradient.Rotation=90
        gradient.Parent=border
        if layoutOrder then btn.LayoutOrder = layoutOrder end

        btn.MouseButton1Click:Connect(function()
            clearScripts()
            -- Esconde o rodap√© do scriptContainer por padr√£o
            scriptFooter.Visible = false

            if typeof(contents)=="table" then
                for _,s in ipairs(contents) do -- Usar ipairs para iterar tabelas num√©ricas
                    createScriptButton(s.Name,s.Func)
                end
            elseif typeof(contents)=="string" then
                createUpdateLabel(contents)
            elseif typeof(contents)=="function" then
                contents()
                -- Se a fun√ß√£o for displayUpdates, mostra o rodap√©
                if contents == displayUpdates then
                    scriptFooter.Visible = true
                end
            end
            -- For√ßa a atualiza√ß√£o do layout ap√≥s adicionar os scripts
            if layoutScript then layoutScript:SetAttribute("Refresh", true) end
        end)
        return btn
    end

    -- NOVO TEXTO PARA A ABA DE ATUALIZA√á√ïES
    local updatesTextFormatted = {
        {Text = "Khalexis Hub V1.1", Color = Color3.fromRGB(255, 255, 255), Font = Enum.Font.GothamBold}, -- Texto em negrito
        {Text = "+1 Script Steal a Brainrot", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "+1 Script Forsaken", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "+1 Script Pegue o Peixe!", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "Nova Mensagem de Boas Vindas!", Color = Color3.fromRGB(220, 220, 220)}, -- Adicionado
        {Text = "Corre√ß√µes de Bugs", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "Tamanho do Hub Editado", Color = Color3.fromRGB(220, 220, 220)}, -- Texto atualizado
        {Text = "DEIXE UMA SUGEST√ÉO NO DC!", Color = Color3.fromRGB(255, 140, 0), Font = Enum.Font.GothamBold}, -- Texto atualizado e em mai√∫sculo
    }

    local function displayUpdates()
        clearScripts()
        for _, lineData in ipairs(updatesTextFormatted) do
            createUpdateLabel(lineData.Text, lineData.Color, lineData.Font)
        end
        scriptFooter.Visible = true -- Torna o rodap√© vis√≠vel apenas para a aba de atualiza√ß√µes
        if layoutScript then layoutScript:SetAttribute("Refresh", true) end -- For√ßa a atualiza√ß√£o do layout
    end

    -- Script definitions with new additions and modifications
    local stealScripts={
        {Name="Dofug",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/OneClye1/dofug/refs/heads/main/dofug.txt"))()end, LayoutOrder=1}, -- NOVO SCRIPT E EM PRIMEIRO
        {Name="Miranda Tween",Func=function()loadstring(game:HttpGet("https://pastefy.app/TnWWJ4NS/raw"))()end, LayoutOrder=2},
        {Name="Chilli Hub",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/tienkhanh1/spicy/main/Chilli.lua"))()end, LayoutOrder=3},
        {Name="Delfi Script",Func=function()loadstring(game:HttpGet("https://pastefy.app/7MQOgJCO/raw"))()end, LayoutOrder=4}
    }
    local noiteScripts={{Name="Iliankytb",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Iliankytb/Iliankytb/main/Best99NightsInTheForest"))()end},{Name="Kenniel Scripts",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Kenniel123/99-Nights-in-the-Forest/refs/heads/main/99%20Nights%20in%20the%20Forest"))()end},{Name="Hutao Hub",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/SLK-gaming/Hutao-Hub/refs/heads/main/99-Nights-In-The-Forest.txt"))()end},{Name="Ringta Script",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/wefwef127382/99daysloader.github.io/refs/heads/main/ringta.lua"))()end},{Name="Voidware",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/VapeVoidware/VWExtra/main/NightsInTheForest.lua",true))()end},{Name="Vex Op",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/yoursvexyyy/VEX-OP/refs/heads/main/99%20nights%20in%20the%20forest"))()end}}
    local growScripts={{Name="No Lag Hub",Func=function()loadstring(game:HttpGet("https://pastebin.com/raw/XHMN2zpp"))()end},{Name="MauScripts",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/nootmaus/GrowAAGarden/refs/heads/main/mauscripts"))()end},{Name="ThanHub",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/thantzy/thanhub/refs/heads/main/thanv1"))()end}}
    local voxSeasScripts={{Name="Brutus Hub",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/codenixstudios/brutus-hub/BRUTUS_TEAM/Games/VoxSeas.lua"))()end},{Name="Type Hub",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/meobeo8/type/main/VoxSeasAutoChest.lua"))()end},{Name="Idk Hub",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/shakaUnlocked/IiI/refs/heads/main/vxs.lua"))()end}}
    local bloxFruitsScripts={{Name="Xero Hub",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Xero2409/XeroHub/refs/heads/main/main.lua"))()end, LayoutOrder=1},{Name="Volcano Hub",Func=function()loadstring(game:HttpGetAsync("https://raw.githubusercontent.com/indexeduu/BF-NewVer/refs/heads/main/V3New.lua"))()end, LayoutOrder=2},{Name="Blue X Hub",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Dev-BlueX/BlueX-Hub/refs/heads/main/Main.lua"))()end, LayoutOrder=3},{Name="Quantum Onyx",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/flazhy/QuantumOnyx/refs/heads/main/QuantumOnyx.lua"))()end,LayoutOrder=4}}
    local kingLegacyScripts={{Name="Zee Hub",Func=function()loadstring(game:HttpGet('https://zuwz.me/Ls-Zee-Hub-KL'))()end}}
    local rivalsScripts={{Name="Rise",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/ShadowBey01/SHWX-Team-Rise-Scripts/refs/heads/main/Games/Rise%20(Rivals).lua",true))()end}}
    local doorsScripts={{Name="Velocity X",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/DasVelocity/VelocityX/refs/heads/main/VelocityX.lua"))()end},{Name="Saturn Hub",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/JScripter-Lua/Saturn_Hub_Products/refs/heads/main/Saturn_Hub_Doors.lua"))()end}}
    local brookhavenScripts={{Name="Sander XY",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/kigredns/testUIDK/refs/heads/main/panel.lua"))()end}}
    local buildAPlaneScripts={{Name="Arbix Hub",Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Z1ntrax/bigmac/refs/heads/main/bap/bapobfuscated.lua"))()end}}
    local inkGameScripts={{Name="Revive Hub",Func=function()loadstring(game:HttpGet('https://raw.githubusercontent.com/Have3165/Reviv3-Hub/refs/heads/main/InkGame'))()end}}
    local naturalDisasterScripts={{Name="BaconJJScript",Func=function()loadstring(game:HttpGet("https://pastebin.com/raw/MAnXu0qv"))()end}}
   
    -- NOVA CATEGORIA: Forsaken Scripts
    local forsakenScripts = {
        {Name="SNT HUB", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Snowt69/SNT-HUB/refs/heads/main/Forsaken"))()end}
    }

    -- NOVA CATEGORIA: Pegue o Peixe Scripts
    local pegueOPeixeScripts = {
        {Name="VinzHub", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Vinzyy13/VinzHub/refs/heads/main/Fish-It"))()end}
    }

    -- Novas categorias adicionadas e organizadas
    local murderMysteryScripts = {
        {Name="Thunder hub MM2", Func=function()loadstring(game:HttpGet('https://raw.githubusercontent.com/Roman34296589/SnapSanixHUB/refs/heads/main/SnapSanixHUB.lua'))()end}
    }
    local weakLegacy2Scripts = {
        {Name="L4BIB HUB", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/L4BIBKAZI/L4BIB-HUB/refs/heads/main/Weak%20Legacy%202"))()end}
    }
    local plantaVSBrainrotScripts = {
        {Name="Gumanba", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/gumanba/Scripts/main/PlantsVsBrainrots"))()end},
        {Name="Blessed-Hub-X", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/mynamewendel-ctrl/Blessed-Hub-X-/refs/heads/main/Plants-Vs-Brainrots.lua"))()end}
    }
    local deadRailsScripts = {
        {Name="Qiwik hub", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Qiwikox12/stubrawl/refs/heads/main/DeadRails.txt"))()end},
        {Name="Tora IsMe", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/gumanba/Scripts/refs/heads/main/DeadRails", true))()end}
    }
    local testeDeQiScripts = {
        {Name="Aqua-Hub", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/ExploiterGuy/Aqua-Hub/refs/heads/main/IQ%20TEST.txt"))()end}
    }
    local passOrDieScripts = {
        {Name="DAVITROLLZ", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Davidfhdgfyyfytyttry/DAVITROLLZ-BRASIL/refs/heads/main/Pass%20or%20die"))()end}
    }
    local mathMurderScripts = {
        -- Adicione scripts aqui se necess√°rio para esta categoria
    }

    -- ADICIONANDO NOVAS CATEGORIAS PARA EXPANDIR A LISTA E A ROlAGEM
    local fightingGamesScripts = {
        {Name="Hub Fighting (Exemplo 1)", Func=function()loadstring(game:HttpGet("URL_DO_SEU_SCRIPT_FIGHTING_GAMES_1"))()end},
        {Name="Hub Fighting (Exemplo 2)", Func=function()loadstring(game:HttpGet("URL_DO_SEU_SCRIPT_FIGHTING_GAMES_2"))()end}
    }
    local simulationScripts = {
        {Name="Hub Sim (Exemplo 1)", Func=function()loadstring(game:HttpGet("URL_DO_SEU_SCRIPT_SIMULATION_1"))()end},
        {Name="Hub Sim (Exemplo 2)", Func=function()loadstring(game:HttpGet("URL_DO_SEU_SCRIPT_SIMULATION_2"))()end}
    }
    local tycoonScripts = {
        {Name="Hub Tycoon (Exemplo 1)", Func=function()loadstring(game:HttpGet("URL_DO_SEU_SCRIPT_TYCOON_1"))()end}
    }
    -- Adicione mais categorias e scripts conforme necess√°rio. Quanto mais, mais rolagem voc√™ ter√°.

    -- Category buttons with updated order and new categories
    createCategoryButton("üì£ Atualiza√ß√µes üì£",displayUpdates, 1) -- Chama a fun√ß√£o para exibir as atualiza√ß√µes formatadas
    createCategoryButton("Steal a Brainrot Scripts",stealScripts, 2)
    createCategoryButton("99 Noites na Floresta Scripts",noiteScripts, 3)
    createCategoryButton("Grow a Garden Scripts",growScripts, 4)
    createCategoryButton("Vox Seas Scripts",voxSeasScripts, 5)
    createCategoryButton("Blox Fruits Scripts",bloxFruitsScripts, 6)
    createCategoryButton("King Legacy Scripts",kingLegacyScripts, 7)
    createCategoryButton("Rivals Scripts",rivalsScripts, 8)
    createCategoryButton("Doors Scripts",doorsScripts, 9)
    createCategoryButton("Brookhaven Scripts",brookhavenScripts, 10)
    createCategoryButton("Build a Plane Scripts",buildAPlaneScripts, 11)
    createCategoryButton("Ink Game Scripts",inkGameScripts, 12)
    createCategoryButton("Natural Disaster Scripts",naturalDisasterScripts, 13)
    createCategoryButton("Forsaken Scripts", forsakenScripts, 14) -- NOVA CATEGORIA: Forsaken Scripts
    createCategoryButton("Pegue o Peixe Scripts", pegueOPeixeScripts, 15) -- NOVA CATEGORIA: Pegue o Peixe Scripts
    -- Novas categorias adicionadas no final
    createCategoryButton("Murder mystery Scripts", murderMysteryScripts, 16)
    createCategoryButton("Weak legacy 2", weakLegacy2Scripts, 17)
    createCategoryButton("Planta VS brainrot Scripts", plantaVSBrainrotScripts, 18)
    createCategoryButton("Dead rails Scripts", deadRailsScripts, 19)
    createCategoryButton("Teste de Qi Scripts", testeDeQiScripts, 20)
    createCategoryButton("Pass or Die Scripts", passOrDieScripts, 21)
    createCategoryButton("Math Murder Scripts", mathMurderScripts, 22)
    -- Adicionando as novas categorias criadas
    createCategoryButton("Fighting Games", fightingGamesScripts, 23)
    createCategoryButton("Simulation Games", simulationScripts, 24)
    createCategoryButton("Tycoon Games", tycoonScripts, 25)
    -- Adicione mais bot√µes de categoria aqui para aumentar a rolagem


    -- Simula um clique na primeira categoria para que os scripts apare√ßam ao abrir
    local firstCategoryButton = categoryContainer:FindFirstChildOfClass("TextButton")
    if firstCategoryButton then
        firstCategoryButton:MouseButton1Click()
    end
    return animationContainer
end

local function showLoadingAndOpenHub()
    LoadingScreen,StopLoadingAnim=showLoadingScreen()
    wait(2)
    if StopLoadingAnim then StopLoadingAnim() end
    if LoadingScreen and LoadingScreen.Parent then LoadingScreen:Destroy() end

    -- MENSAGEM DE BOAS-VINDAS ANTES DE ABRIR O HUB (APENAS NA PRIMEIRA VEZ)
    if not HasShownWelcome then
        local welcomeFrame = Instance.new("Frame")
        welcomeFrame.Size = UDim2.new(0, 0, 0, 0) -- Come√ßa do tamanho 0 para anima√ß√£o
        welcomeFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
        welcomeFrame.AnchorPoint = Vector2.new(0.5, 0.5)
        welcomeFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30) -- MESMO TOM DE PRETO DA TELA DE CARREGAMENTO
        welcomeFrame.BorderSizePixel = 0
        welcomeFrame.Parent = ScreenGui
        applyRoundedCorners(welcomeFrame, 16) -- MESMA BORDA DA TELA DE CARREGAMENTO
        welcomeFrame.BackgroundTransparency = 1 -- Come√ßa transparente para a anima√ß√£o

        -- Adiciona a borda preta da tela de carregamento
        local border = Instance.new("UIStroke")
        border.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        border.Color = Color3.fromRGB(0, 0, 0)
        border.Thickness = 2
        border.Parent = welcomeFrame

        local welcomeMsg = Instance.new("TextLabel")
        welcomeMsg.Size = UDim2.new(1, 0, 1, 0)
        welcomeMsg.BackgroundTransparency = 1
        welcomeMsg.TextColor3 = Color3.fromRGB(255, 255, 255) -- Texto branco
        welcomeMsg.Font = Enum.Font.GothamBold
        welcomeMsg.TextSize = 20
        welcomeMsg.Text = "Bem Vindo " .. player.Name .. " ao Khalexis Hub!"
        welcomeMsg.TextWrapped = true
        welcomeMsg.TextXAlignment = Enum.TextXAlignment.Center
        welcomeMsg.TextYAlignment = Enum.TextYAlignment.Center
        welcomeMsg.Parent = welcomeFrame

        -- Anima√ß√£o da mensagem de boas-vindas
        local tweenInfoExpand = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local goalExpand = {Size = UDim2.new(0, 300, 0, 50), Position = UDim2.new(0.5, -150, 0.5, -25), BackgroundTransparency = 0}
        local tweenExpand = TweenService:Create(welcomeFrame, tweenInfoExpand, goalExpand)

        local tweenInfoFadeOut = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
        local goalFadeOut = {TextTransparency = 1}
        local tweenFadeOut = TweenService:Create(welcomeMsg, tweenInfoFadeOut, goalFadeOut)
        local tweenFadeOutFrame = TweenService:Create(welcomeFrame, tweenInfoFadeOut, {BackgroundTransparency = 1})

        tweenExpand:Play()
        tweenExpand.Completed:Wait()
        wait(1.5) -- Tempo para a mensagem ser lida antes de come√ßar a desvanecer
       
        tweenFadeOut:Play()
        tweenFadeOutFrame:Play()
        tweenFadeOutFrame.Completed:Wait()

        if welcomeFrame and welcomeFrame.Parent then welcomeFrame:Destroy() end
        HasShownWelcome = true
    end

    MainFrameContainer=createHub()
    HubOpen=true
    -- REMOVIDO: ToggleButton.Visible=false -- Garante que o toggle permane√ßa vis√≠vel
end

local function validateKeyAndOpen(key,isAuto)
    local lowerKey=key:lower()
    if validKeys[lowerKey] then
        saveKeyLocally(lowerKey)
        if KeyFrame and KeyFrame.Parent then KeyFrame:Destroy(); KeyFrame=nil end
        showLoadingAndOpenHub()
        ToggleButton.Visible=false -- Aqui tamb√©m o toggle fica invis√≠vel ao ABRIR o hub, mas ele volta a ser vis√≠vel quando o hub √© FECHADO. Se quiser que ele fique SEMPRE vis√≠vel, esta linha tamb√©m precisa ser comentada/removida.
        if isAuto then showAutoMessage("Khalexis Hub carregado! Sua key foi verificada automaticamente.") end
        return true
    else
        removeLocalKey()
        if not isAuto then showError("Key incorreta") end
        return false
    end
end

local function tryAutoValidate() local savedKey=loadKeyLocally(); if savedKey and validKeys[savedKey] then return validateKeyAndOpen(savedKey,true) else removeLocalKey(); return false end end

local function createKeyInputFrame()
    local frame=Instance.new("Frame")
    frame.Name="KeyFrame"
    frame.Size=UDim2.new(0,300,0,240) -- Tamanho ajustado para celular
    frame.Position=UDim2.new(0.5,-150,0.5,-120) -- Posi√ß√£o ajustada
    frame.BackgroundColor3=Color3.fromRGB(30,30,30)
    frame.BorderSizePixel=0
    frame.Parent=ScreenGui
    applyRoundedCorners(frame,12)

    local titleLabel=Instance.new("TextLabel")
    titleLabel.Name="KeyTitle"
    titleLabel.Size=UDim2.new(1,0,0,30) -- Altura ajustada
    titleLabel.BackgroundTransparency=1
    titleLabel.Text="üîí COLE NO ESPA√áO ABAIXO A SUA KEY üîí"
    titleLabel.Font=Enum.Font.GothamBold
    titleLabel.TextSize=14 -- Tamanho da fonte ajustado
    titleLabel.TextYAlignment=Enum.TextYAlignment.Center
    titleLabel.TextXAlignment=Enum.TextXAlignment.Center
    titleLabel.Parent=frame
    local byLabel=Instance.new("TextLabel")
    byLabel.Name="ByLabel"
    byLabel.Size=UDim2.new(1,0,0,18) -- Altura ajustada
    byLabel.Position=UDim2.new(0,0,0,32) -- Posi√ß√£o ajustada
    byLabel.BackgroundTransparency=1
    byLabel.TextColor3=COLOR_FOOTER_TEXT
    byLabel.Font=Enum.Font.Gotham
    byLabel.TextSize=10 -- Tamanho da fonte ajustado
    byLabel.Text="by khalexis"
    byLabel.TextXAlignment=Enum.TextXAlignment.Center
    byLabel.TextYAlignment=Enum.TextYAlignment.Top
    byLabel.Parent=frame
    spawn(function() local hue=0; while frame and frame.Parent do hue=(hue+0.01)%1; titleLabel.TextColor3=Color3.fromHSV(hue,1,1); wait(0.03) end end)

    local keyBox=Instance.new("TextBox")
    keyBox.Name="KeyBox"
    keyBox.Size=UDim2.new(1,-30,0,35) -- Tamanho ajustado
    keyBox.Position=UDim2.new(0,15,0,55) -- Posi√ß√£o ajustada
    keyBox.BackgroundColor3=Color3.fromRGB(45,45,45)
    keyBox.TextColor3=COLOR_TEXT
    keyBox.Font=Enum.Font.Gotham
    keyBox.TextSize=16 -- Tamanho da fonte ajustado
    keyBox.ClearTextOnFocus=false
    keyBox.Text=""
    keyBox.PlaceholderText=""
    applyRoundedCorners(keyBox,8)
    keyBox.Parent=frame

    local confirmBtn=Instance.new("TextButton")
    confirmBtn.Name="EnterButton"
    confirmBtn.Size=UDim2.new(0,90,0,30) -- Tamanho ajustado
    confirmBtn.Position=UDim2.new(0.5,-45,0,95) -- Posi√ß√£o ajustada
    confirmBtn.BackgroundColor3=COLOR_SCRIPT_BTN
    confirmBtn.TextColor3=COLOR_TEXT
    confirmBtn.Font=Enum.Font.GothamBold
    confirmBtn.TextSize=16 -- Tamanho da fonte ajustado
    confirmBtn.Text="Confirmar"
    applyRoundedCorners(confirmBtn,8)
    confirmBtn.Parent=frame

    local copyKeyBtn=Instance.new("TextButton")
    copyKeyBtn.Name="PegarKeyButton"
    copyKeyBtn.Size=UDim2.new(0,70,0,25) -- Tamanho ajustado
    copyKeyBtn.Position=UDim2.new(0.5,-35,0,130) -- Posi√ß√£o ajustada
    copyKeyBtn.BackgroundColor3=COLOR_SCRIPT_BTN
    copyKeyBtn.TextColor3=Color3.new(1,1,1)
    copyKeyBtn.Font=Enum.Font.GothamBold
    copyKeyBtn.TextSize=10 -- Tamanho da fonte ajustado
    copyKeyBtn.Text="Pegar Key"
    applyRoundedCorners(copyKeyBtn,8)
    copyKeyBtn.Parent=frame

    local infoLabel=Instance.new("TextLabel")
    infoLabel.Name="InfoText"
    infoLabel.Size=UDim2.new(1,-20,0,25) -- Altura ajustada
    infoLabel.Position=UDim2.new(0,10,0,165) -- Posi√ß√£o ajustada
    infoLabel.BackgroundTransparency=1
    infoLabel.Font=Enum.Font.GothamBold
    infoLabel.TextSize=10 -- Tamanho da fonte ajustado
    infoLabel.Text="CLIQUE EM PEGAR KEY E COLE NO NAVEGADOR"
    infoLabel.TextWrapped=true
    infoLabel.TextXAlignment=Enum.TextXAlignment.Center
    infoLabel.TextYAlignment=Enum.TextYAlignment.Top
    infoLabel.Parent=frame
    local subInfoLabel=Instance.new("TextLabel")
    subInfoLabel.Name="SubInfoText"
    subInfoLabel.Size=UDim2.new(1,-20,0,18) -- Altura ajustada
    subInfoLabel.Position=UDim2.new(0,10,0,190) -- Posi√ß√£o ajustada
    subInfoLabel.BackgroundTransparency=1
    subInfoLabel.Font=Enum.Font.Gotham
    subInfoLabel.TextSize=12 -- Tamanho da fonte ajustado
    subInfoLabel.TextColor3=COLOR_FOOTER_TEXT
    subInfoLabel.TextWrapped=false
    subInfoLabel.TextXAlignment=Enum.TextXAlignment.Center
    subInfoLabel.TextYAlignment=Enum.TextYAlignment.Top
    subInfoLabel.Text="Sistema de Key - Khalexis Hub"
    subInfoLabel.Parent=frame
    spawn(function() local hue=0; while frame and frame.Parent do hue=(hue+0.01)%1; infoLabel.TextColor3=Color3.fromHSV(hue,1,1); wait(0.03) end end)

    ErrorLabel=Instance.new("TextLabel")
    ErrorLabel.Name="ErrorLabel"
    ErrorLabel.Size=UDim2.new(1,0,0,20) -- Altura ajustada
    ErrorLabel.Position=UDim2.new(0,0,1,-70) -- Posi√ß√£o ajustada
    ErrorLabel.BackgroundTransparency=1
    ErrorLabel.TextColor3=COLOR_ERROR
    ErrorLabel.Font=Enum.Font.GothamBold
    ErrorLabel.TextSize=14 -- Tamanho da fonte ajustado
    ErrorLabel.Text=""
    ErrorLabel.Parent=frame
    local function showLocalError(msg) ErrorLabel.Text=msg; spawn(function() wait(2); if ErrorLabel and ErrorLabel.Parent==frame then ErrorLabel.Text="" end end) end -- Reatribui√ß√£o para evitar warning (n√£o ideal, mas mant√©m a l√≥gica original)

    copyKeyBtn.MouseButton1Click:Connect(function() local s,_=copyToClipboard("discord.gg/aNaFpb2Qsb"); if s then copyKeyBtn.Text="Link copiado!"; wait(2); copyKeyBtn.Text="Pegar Key" else showLocalError("Falha ao copiar.") end end)
    confirmBtn.MouseButton1Click:Connect(function() validateKeyAndOpen(keyBox.Text:gsub("%s",""):lower(),false) end)
    return frame,showLocalError
end

ToggleButton=Instance.new("TextButton")
ToggleButton.Name="ToggleButton"
ToggleButton.Size=UDim2.new(0,35,0,35) -- Tamanho do toggle ajustado
ToggleButton.Position=UDim2.new(0,10,0,10)
ToggleButton.BackgroundColor3=Color3.new(0,0,0)
ToggleButton.TextColor3=Color3.new(1,1,1)
ToggleButton.Text="K"
ToggleButton.Font=Enum.Font.GothamBold
ToggleButton.TextSize=24 -- Tamanho da fonte do toggle ajustado
ToggleButton.Parent=ScreenGui
applyRoundedCorners(ToggleButton,10)
-- REMOVIDO: ToggleButton.Visible=false -- O toggle agora √© sempre vis√≠vel por padr√£o.

local draggingToggle=false
local dragStartToggle,startPosToggle
-- CORRE√á√ÉO DO BUG DE ARRASTAR: Usar um InputObject global para arrastar o toggle
local currentInputObjectToggle = nil

ToggleButton.InputBegan:Connect(function(input)
    if input.UserInputType==Enum.UserInputType.MouseButton1 or input.UserInputType==Enum.UserInputType.Touch then
        draggingToggle=true
        dragStartToggle=input.Position
        startPosToggle=ToggleButton.Position
        currentInputObjectToggle = input -- Armazena o objeto de input atual

        local connection
        connection=input.Changed:Connect(function()
            if input.UserInputState==Enum.UserInputState.Ended then
                draggingToggle=false
                currentInputObjectToggle = nil
                connection:Disconnect()
            end
        end)
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if draggingToggle and currentInputObjectToggle == input and (input.UserInputType==Enum.UserInputType.MouseMovement or input.UserInputType==Enum.UserInputType.Touch) then
        local delta=input.Position-dragStartToggle
        ToggleButton.Position=UDim2.new(startPosToggle.X.Scale,startPosToggle.X.Offset+delta.X,startPosToggle.Y.Scale,startPosToggle.Y.Offset+delta.Y)
    end
end)
ToggleButton.MouseButton1Click:Connect(function()
    if HubOpen then
        -- Se o hub estiver aberto, feche-o com a anima√ß√£o
        if MainFrameContainer then
            closeHubWithAnimation(MainFrameContainer)
        end
    else
        -- Se o hub estiver fechado, abra-o (pulando a mensagem de boas-vindas se j√° foi exibida)
        if KeyFrame and KeyFrame.Parent then KeyFrame:Destroy(); KeyFrame=nil end
        if LoadingScreen and LoadingScreen.Parent then if StopLoadingAnim then StopLoadingAnim() end; LoadingScreen:Destroy(); LoadingScreen=nil end
       
        -- Pula a mensagem de boas-vindas se j√° foi exibida
        if HasShownWelcome then
            MainFrameContainer=createHub()
            HubOpen=true
            -- REMOVIDO: ToggleButton.Visible=false -- Garantindo que o toggle n√£o fique invis√≠vel ao abrir
        else
            showLoadingAndOpenHub() -- Chama a fun√ß√£o que agora inclui a mensagem de boas-vindas
        end
    end
end)

if not tryAutoValidate() then KeyFrame,showError=createKeyInputFrame() end
