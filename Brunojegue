--[[
    -- Brunojegue Hub - Script Hub para Roblox com sistema de key, barra de pesquisa e configurações de tema
    -- Chaves válidas: "khalexispremium100", "brunojeguelindodms10"
    -- Mensagem de erro: "Key incorreta"
    -- Toggle "B" branco em quadrado preto arredondado
    -- Toggle aparece sempre visível, clicável e arrastável (mouse/touch)
--]]

local function applyRoundedCorners(guiObject, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 12)
    corner.Parent = guiObject
end

local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "BrunojegueHub"
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game.CoreGui

-- Paletas de Cores Aprimoradas
local themes = {
    normal = {main_bg = Color3.fromRGB(25, 25, 25), category_bg = Color3.fromRGB(40, 40, 40), title_bar = Color3.fromRGB(35, 35, 35), script_frame_bg = Color3.fromRGB(25, 25, 25), accent = Color3.fromRGB(255, 165, 0), transparency = 0},
    preto = {main_bg = Color3.fromRGB(15, 15, 15), category_bg = Color3.fromRGB(20, 20, 20), title_bar = Color3.fromRGB(25, 25, 25), script_frame_bg = Color3.fromRGB(15, 15, 15), accent = Color3.fromRGB(200, 200, 200), transparency = 0},
    laranja = {main_bg = Color3.fromRGB(255, 140, 0), category_bg = Color3.fromRGB(50, 50, 50), title_bar = Color3.fromRGB(40, 40, 40), script_frame_bg = Color3.fromRGB(60, 60, 60), accent = Color3.fromRGB(255, 215, 0), transparency = 0},
    roxo = {main_bg = Color3.fromRGB(75, 0, 130), category_bg = Color3.fromRGB(50, 25, 75), title_bar = Color3.fromRGB(60, 30, 90), script_frame_bg = Color3.fromRGB(50, 25, 75), accent = Color3.fromRGB(138, 43, 226), transparency = 0},
    transparente = {main_bg = Color3.fromRGB(25, 25, 25), category_bg = Color3.fromRGB(40, 40, 40), title_bar = Color3.fromRGB(35, 35, 35), script_frame_bg = Color3.fromRGB(25, 25, 25), accent = Color3.fromRGB(255, 165, 0), transparency = 0.5}
}

-- Cores Padrão
local COLOR_BLACK = themes.normal.main_bg
local COLOR_CATEGORY_BG = themes.normal.category_bg
local COLOR_CATEGORY_BTN = Color3.fromRGB(60, 60, 60)
local COLOR_SCRIPT_BTN = Color3.fromRGB(50, 50, 50)
local COLOR_TITLEBAR = themes.normal.title_bar
local COLOR_TEXT = Color3.fromRGB(240, 240, 240)
local COLOR_ERROR = Color3.fromRGB(255, 100, 100)
local COLOR_FOOTER_TEXT = Color3.fromRGB(180, 180, 180)
local ACCENT_COLOR = themes.normal.accent

local userId = player.UserId
local userName = player.Name
local KeyFrame, MainFrameContainer
local LoadingScreen, StopLoadingAnim
local HubOpen = false
local ToggleButton
local ErrorLabel
local HasShownWelcome = false

local StorageKeyFileName = "BrunojegueHubKey.txt"
local validKeys = {"khalexispremium100", "brunojeguelindodms10"}

local function saveKeyLocally(key) pcall(function() if writefile then writefile(StorageKeyFileName, key) elseif write_file then write_file(StorageKeyFileName, key) end end) end
local function loadKeyLocally() local s,c = pcall(function() if readfile then return readfile(StorageKeyFileName) elseif read_file then return read_file(StorageKeyFileName) end end); if s and c then return c:lower() end; return nil end
local function removeLocalKey() pcall(function() if delfile then delfile(StorageKeyFileName)elseif deletefile then deletefile(StorageKeyFileName) end end) end

local function showAutoMessage(msg) 
    local m = Instance.new("Frame"); m.Name="AutoMessageFrame"; m.Size=UDim2.new(0,340,0,50); m.Position=UDim2.new(1,-350,1,-60); m.BackgroundColor3=COLOR_BLACK; m.BorderSizePixel=0; m.Parent=ScreenGui; applyRoundedCorners(m,15); 
    local l=Instance.new("TextLabel"); l.Size=UDim2.new(1,-20,1,-10); l.Position=UDim2.new(0,10,0,5); l.BackgroundTransparency=1; l.TextColor3=COLOR_TEXT; l.Font=Enum.Font.GothamBold; l.TextSize=16; l.Text=msg; l.TextWrapped=true; l.TextXAlignment=Enum.TextXAlignment.Left; l.TextYAlignment=Enum.TextYAlignment.Center; l.Parent=m; 
    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, ACCENT_COLOR), ColorSequenceKeypoint.new(1, ACCENT_COLOR:Lerp(COLOR_BLACK, 0.7))})
    gradient.Rotation = 90
    gradient.Parent = m
    spawn(function() wait(4); if m and m.Parent then m:Destroy() end end) 
end

local function showError(msg) if ErrorLabel then ErrorLabel.Text=msg; spawn(function() wait(2); if ErrorLabel and ErrorLabel.Parent then ErrorLabel.Text="" end end) end end
local function copyToClipboard(text) return pcall(function() if setclipboard then setclipboard(text)elseif toclipboard then toclipboard(text) else error("Clipboard function not supported.") end end) end

local function closeHubWithAnimation(container)
    if not (container and container.Parent) then return end
    local uiScaler = container:FindFirstChildOfClass("UIScale")
    if not uiScaler then container:Destroy(); return end
    local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Back, Enum.EasingDirection.In)
    local goal = { Scale = 0 }
    local tween = TweenService:Create(uiScaler, tweenInfo, goal)
    tween:Play()
    tween.Completed:Wait()
    if container and container.Parent then container:Destroy() end
    MainFrameContainer = nil
    HubOpen = false
    ToggleButton.Visible = true
end

local function showLoadingScreen()
    local frame = Instance.new("Frame")
    frame.Name = "LoadingFrame"
    frame.Size = UDim2.new(0, 320, 0, 140)
    frame.Position = UDim2.new(0.5, -160, 0.5, -70)
    frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    frame.BorderSizePixel = 0
    frame.Parent = ScreenGui
    applyRoundedCorners(frame, 20)
    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, ACCENT_COLOR), ColorSequenceKeypoint.new(1, ACCENT_COLOR:Lerp(Color3.fromRGB(20, 20, 20), 0.8))})
    gradient.Rotation = 45
    gradient.Parent = frame
    local label = Instance.new("TextLabel")
    label.Name = "LoadingLabel"
    label.Size = UDim2.new(1, -20, 0, 30)
    label.Position = UDim2.new(0, 10, 0.3, -15)
    label.BackgroundTransparency = 1
    label.Text = "Carregando..."
    label.TextColor3 = COLOR_TEXT
    label.Font = Enum.Font.GothamBold
    label.TextSize = 22
    label.Parent = frame
    local spinner = Instance.new("ImageLabel")
    spinner.Size = UDim2.new(0, 60, 0, 60)
    spinner.Position = UDim2.new(0.5, -30, 0, 70)
    spinner.BackgroundTransparency = 1
    spinner.Image = "rbxassetid://6031090990" -- Spinner animado
    spinner.Parent = frame
    local angle = 0
    local connection = RunService.RenderStepped:Connect(function()
        angle = (angle + 5) % 360
        spinner.Rotation = angle
    end)
    return frame, function()
        if connection then connection:Disconnect(); connection = nil end
    end
end

local function applyTheme(themeName)
    local palette = themes[themeName]
    if not palette or not MainFrameContainer then return end
    local MainFrame = MainFrameContainer:FindFirstChild("MainFrame")
    if not MainFrame then return end
    local titleBar = MainFrame:FindFirstChild("TitleBar")
    local categoryFrame = MainFrame:FindFirstChild("CategoryFrame")
    local scriptFrame = MainFrame:FindFirstChild("ScriptFrame")
    local footerBackground = MainFrame:FindFirstChild("FooterBackground")
    MainFrame.BackgroundColor3 = palette.main_bg
    MainFrame.BackgroundTransparency = palette.transparency
    if titleBar then titleBar.BackgroundColor3 = palette.title_bar end
    if categoryFrame then categoryFrame.BackgroundColor3 = palette.category_bg end
    if scriptFrame then scriptFrame.BackgroundColor3 = palette.script_frame_bg end
    if footerBackground then footerBackground.BackgroundColor3 = palette.title_bar end
    ACCENT_COLOR = palette.accent
    updateGradients(palette.accent)
end

local function updateGradients(accentColor)
    if MainFrameContainer then
        local mainFrame = MainFrameContainer:FindFirstChild("MainFrame")
        if mainFrame then
            for _, obj in pairs(mainFrame:GetDescendants()) do
                if obj:IsA("UIGradient") then
                    obj.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, accentColor), ColorSequenceKeypoint.new(1, accentColor:Lerp(COLOR_BLACK, 0.7))})
                end
            end
        end
    end
end

local function createHub()
    local animationContainer = Instance.new("Frame")
    animationContainer.Name = "AnimationContainer"
    animationContainer.Size = UDim2.new(0, 400, 0, 320) -- Aumentado para mais espaço
    animationContainer.AnchorPoint = Vector2.new(0.5, 0.5)
    animationContainer.Position = UDim2.new(0.5, 0, 0.5, 0)
    animationContainer.BackgroundTransparency = 1
    animationContainer.Parent = ScreenGui
    local uiScaler = Instance.new("UIScale")
    uiScaler.Scale = 0
    uiScaler.Parent = animationContainer
    local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
    TweenService:Create(uiScaler, tweenInfo, {Scale = 1}):Play()

    local frame = Instance.new("Frame")
    frame.Name = "MainFrame"
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.Position = UDim2.new(0, 0, 0, 0)
    frame.BackgroundColor3 = COLOR_BLACK
    frame.BorderSizePixel = 0
    frame.Parent = animationContainer
    applyRoundedCorners(frame, 20)
    local border = Instance.new("UIStroke")
    border.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    border.Thickness = 2
    border.Color = ACCENT_COLOR
    border.Parent = frame
    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, ACCENT_COLOR), ColorSequenceKeypoint.new(1, ACCENT_COLOR:Lerp(COLOR_BLACK, 0.7))})
    gradient.Rotation = 45
    gradient.Parent = border

    local titleBar = Instance.new("Frame")
    titleBar.Name = "TitleBar"
    titleBar.Size = UDim2.new(1, -20, 0, 50)
    titleBar.Position = UDim2.new(0, 10, 0, 10)
    titleBar.BackgroundColor3 = COLOR_TITLEBAR
    titleBar.BorderSizePixel = 0
    titleBar.Parent = frame
    applyRoundedCorners(titleBar, 15)
    local titleBarGradient = Instance.new("UIGradient")
    titleBarGradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, ACCENT_COLOR), ColorSequenceKeypoint.new(1, ACCENT_COLOR:Lerp(COLOR_TITLEBAR, 0.8))})
    titleBarGradient.Rotation = 90
    titleBarGradient.Parent = titleBar

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "Title"
    titleLabel.Size = UDim2.new(0.8, 0, 1, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "Brunojegue Hub"
    titleLabel.TextColor3 = COLOR_TEXT
    titleLabel.Font = Enum.Font.GothamBlack
    titleLabel.TextSize = 20
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.TextYAlignment = Enum.TextYAlignment.Center
    titleLabel.Position = UDim2.new(0, 15, 0, 0)
    titleLabel.Parent = titleBar

    local closeButton = Instance.new("ImageButton")
    closeButton.Name = "CloseButton"
    closeButton.Size = UDim2.new(0, 30, 0, 30)
    closeButton.Position = UDim2.new(1, -40, 0.5, -15)
    closeButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
    closeButton.Image = "rbxassetid://7072706704" -- Ícone de X
    closeButton.ImageColor3 = COLOR_TEXT
    closeButton.BackgroundTransparency = 1
    closeButton.Parent = titleBar
    applyRoundedCorners(closeButton, 10)
    closeButton.MouseEnter:Connect(function()
        TweenService:Create(closeButton, TweenInfo.new(0.2), {ImageTransparency = 0.3}):Play()
    end)
    closeButton.MouseLeave:Connect(function()
        TweenService:Create(closeButton, TweenInfo.new(0.2), {ImageTransparency = 0}):Play()
    end)
    closeButton.MouseButton1Click:Connect(function()
        closeHubWithAnimation(animationContainer)
    end)

    local searchBox = Instance.new("TextBox")
    searchBox.Name = "CategorySearchBox"
    searchBox.Size = UDim2.new(0, 150, 0, 30)
    searchBox.Position = UDim2.new(0, 15, 0, 70)
    searchBox.BackgroundColor3 = Color3.fromRGB(35, 35, 35)
    searchBox.TextColor3 = COLOR_TEXT
    searchBox.PlaceholderText = "🔍 Pesquisar categorias..."
    searchBox.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
    searchBox.Text = ""
    searchBox.Font = Enum.Font.Gotham
    searchBox.TextSize = 14
    searchBox.ClearTextOnFocus = false
    searchBox.Parent = frame
    applyRoundedCorners(searchBox, 10)
    local searchBoxGradient = Instance.new("UIGradient")
    searchBoxGradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, ACCENT_COLOR), ColorSequenceKeypoint.new(1, ACCENT_COLOR:Lerp(Color3.fromRGB(35, 35, 35), 0.8))})
    searchBoxGradient.Rotation = 90
    searchBoxGradient.Parent = searchBox

    local categoryFrame = Instance.new("ScrollingFrame")
    categoryFrame.Name = "CategoryFrame"
    categoryFrame.Size = UDim2.new(0, 140, 0, 200)
    categoryFrame.Position = UDim2.new(0, 15, 0, 110)
    categoryFrame.BackgroundColor3 = COLOR_CATEGORY_BG
    categoryFrame.BorderSizePixel = 0
    categoryFrame.ScrollBarThickness = 6
    categoryFrame.ScrollBarImageColor3 = ACCENT_COLOR
    categoryFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    categoryFrame.Parent = frame
    applyRoundedCorners(categoryFrame, 15)
    local categoryFrameGradient = Instance.new("UIGradient")
    categoryFrameGradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, ACCENT_COLOR:Lerp(COLOR_CATEGORY_BG, 0.2)), ColorSequenceKeypoint.new(1, COLOR_CATEGORY_BG)})
    categoryFrameGradient.Rotation = 90
    categoryFrameGradient.Parent = categoryFrame

    local categoryContainer = Instance.new("Frame")
    categoryContainer.Name = "CategoryContainer"
    categoryContainer.Size = UDim2.new(1, -10, 0, 0)
    categoryContainer.Position = UDim2.new(0, 5, 0, 5)
    categoryContainer.BackgroundTransparency = 1
    categoryContainer.Parent = categoryFrame
    categoryContainer.ClipsDescendants = true
    local layoutCategory = Instance.new("UIListLayout")
    layoutCategory.Padding = UDim.new(0, 10)
    layoutCategory.SortOrder = Enum.SortOrder.LayoutOrder
    layoutCategory.FillDirection = Enum.FillDirection.Vertical
    layoutCategory.HorizontalAlignment = Enum.HorizontalAlignment.Center
    layoutCategory.Parent = categoryContainer
    layoutCategory:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        categoryContainer.Size = UDim2.new(1, -10, 0, layoutCategory.AbsoluteContentSize.Y)
        categoryFrame.CanvasSize = UDim2.new(0, 0, 0, math.max(layoutCategory.AbsoluteContentSize.Y + 10, 200))
    end)

    searchBox:GetPropertyChangedSignal("Text"):Connect(function()
        local s = searchBox.Text:lower()
        for _, b in ipairs(categoryContainer:GetChildren()) do
            if b:IsA("TextButton") then
                local n = b.Text:lower()
                b.Visible = string.find(n, s, 1, true)
            end
        end
    end)

    local scriptFrame = Instance.new("ScrollingFrame")
    scriptFrame.Name = "ScriptFrame"
    scriptFrame.Size = UDim2.new(0, 220, 0, 240)
    scriptFrame.Position = UDim2.new(0, 170, 0, 70)
    scriptFrame.BackgroundColor3 = COLOR_BLACK
    scriptFrame.BorderSizePixel = 0
    scriptFrame.ScrollBarThickness = 6
    scriptFrame.ScrollBarImageColor3 = ACCENT_COLOR
    scriptFrame.Parent = frame
    applyRoundedCorners(scriptFrame, 15)
    local scriptFrameGradient = Instance.new("UIGradient")
    scriptFrameGradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, ACCENT_COLOR:Lerp(COLOR_BLACK, 0.2)), ColorSequenceKeypoint.new(1, COLOR_BLACK)})
    scriptFrameGradient.Rotation = 90
    scriptFrameGradient.Parent = scriptFrame

    local scriptContainer = Instance.new("Frame")
    scriptContainer.Name = "ScriptContainer"
    scriptContainer.Size = UDim2.new(1, -20, 0, 0)
    scriptContainer.Position = UDim2.new(0, 10, 0, 10)
    scriptContainer.BackgroundTransparency = 1
    scriptContainer.Parent = scriptFrame
    scriptContainer.ClipsDescendants = true
    local layoutScript = Instance.new("UIListLayout")
    layoutScript.Padding = UDim.new(0, 8)
    layoutScript.SortOrder = Enum.SortOrder.LayoutOrder
    layoutScript.FillDirection = Enum.FillDirection.Vertical
    layoutScript.HorizontalAlignment = Enum.HorizontalAlignment.Center
    layoutScript.Parent = scriptContainer
    layoutScript:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        scriptContainer.Size = UDim2.new(1, -20, 0, layoutScript.AbsoluteContentSize.Y)
    end)

    local scriptFooter = Instance.new("TextLabel")
    scriptFooter.Name = "ScriptFooter"
    scriptFooter.Size = UDim2.new(1, 0, 0, 20)
    scriptFooter.BackgroundTransparency = 1
    scriptFooter.TextColor3 = Color3.fromRGB(150, 150, 150)
    scriptFooter.Font = Enum.Font.Gotham
    scriptFooter.TextSize = 12
    scriptFooter.Text = "Reporte bugs no Discord!"
    scriptFooter.TextWrapped = true
    scriptFooter.TextXAlignment = Enum.TextXAlignment.Center
    scriptFooter.TextYAlignment = Enum.TextYAlignment.Bottom
    scriptFooter.LayoutOrder = 999
    scriptFooter.Parent = scriptContainer
    scriptFooter.Visible = false

    local footerBackground = Instance.new("Frame")
    footerBackground.Name = "FooterBackground"
    footerBackground.Size = UDim2.new(1, -20, 0, 50)
    footerBackground.Position = UDim2.new(0, 10, 1, -60)
    footerBackground.BackgroundColor3 = COLOR_TITLEBAR
    footerBackground.BorderSizePixel = 0
    footerBackground.Parent = frame
    applyRoundedCorners(footerBackground, 15)
    local footerGradient = Instance.new("UIGradient")
    footerGradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, ACCENT_COLOR), ColorSequenceKeypoint.new(1, COLOR_TITLEBAR)})
    footerGradient.Rotation = 90
    footerGradient.Parent = footerBackground

    local footerText = Instance.new("TextLabel")
    footerText.Name = "FooterText"
    footerText.Text = "Desenvolvido por Brunojegue"
    footerText.Font = Enum.Font.GothamBold
    footerText.TextSize = 12
    footerText.TextColor3 = COLOR_FOOTER_TEXT
    footerText.BackgroundTransparency = 1
    footerText.Size = UDim2.new(0.5, 0, 1, 0)
    footerText.Position = UDim2.new(0, 10, 0, 5)
    footerText.TextYAlignment = Enum.TextYAlignment.Top
    footerText.Parent = footerBackground

    local footerRightContainer = Instance.new("Frame")
    footerRightContainer.Name = "FooterRightContainer"
    footerRightContainer.Size = UDim2.new(0.5, 0, 1, 0)
    footerRightContainer.Position = UDim2.new(0.5, 0, 0, 0)
    footerRightContainer.BackgroundTransparency = 1
    footerRightContainer.Parent = footerBackground
    local footerTextLayout = Instance.new("UIListLayout")
    footerTextLayout.FillDirection = Enum.FillDirection.Vertical
    footerTextLayout.VerticalAlignment = Enum.VerticalAlignment.Center
    footerTextLayout.HorizontalAlignment = Enum.HorizontalAlignment.Right
    footerTextLayout.SortOrder = Enum.SortOrder.LayoutOrder
    footerTextLayout.Padding = UDim.new(0, 2)
    footerTextLayout.Parent = footerRightContainer

    local ytLabel = Instance.new("TextLabel")
    ytLabel.Name = "YouTubeLabel"
    ytLabel.Text = "YouTube: Brunojegue"
    ytLabel.Font = Enum.Font.Gotham
    ytLabel.TextSize = 10
    ytLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    ytLabel.BackgroundTransparency = 1
    ytLabel.Size = UDim2.new(1, 0, 0, 12)
    ytLabel.TextXAlignment = Enum.TextXAlignment.Right
    ytLabel.LayoutOrder = 1
    ytLabel.Parent = footerRightContainer

    local discordLabel = Instance.new("TextLabel")
    discordLabel.Name = "DiscordLabel"
    discordLabel.Text = "Discord: discord.gg/aNaFpb2Qsb"
    discordLabel.Font = Enum.Font.Gotham
    discordLabel.TextSize = 10
    discordLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    discordLabel.BackgroundTransparency = 1
    discordLabel.Size = UDim2.new(1, 0, 0, 12)
    discordLabel.TextXAlignment = Enum.TextXAlignment.Right
    discordLabel.LayoutOrder = 2
    discordLabel.Parent = footerRightContainer

    local playerInfo = Instance.new("Frame")
    playerInfo.Name = "PlayerInfoFrame"
    playerInfo.Size = UDim2.new(0, 100, 0, 30)
    playerInfo.Position = UDim2.new(0, 15, 0.5, -15)
    playerInfo.BackgroundTransparency = 1
    playerInfo.Parent = footerBackground

    local avatar = Instance.new("ImageLabel")
    avatar.Name = "AvatarImage"
    avatar.Size = UDim2.new(0, 30, 0, 30)
    avatar.Position = UDim2.new(0, 0, 0, 0)
    avatar.BackgroundColor3 = COLOR_SCRIPT_BTN
    avatar.BorderSizePixel = 0
    avatar.Parent = playerInfo
    applyRoundedCorners(avatar, 15)
    local thumbType, thumbSize = Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size100x100
    local thumbContent, _ = Players:GetUserThumbnailAsync(userId, thumbType, thumbSize)
    avatar.Image = thumbContent

    local playerNameLabel = Instance.new("TextLabel")
    playerNameLabel.Name = "PlayerNameLabel"
    playerNameLabel.Size = UDim2.new(1, -40, 1, 0)
    playerNameLabel.Position = UDim2.new(0, 35, 0, 0)
    playerNameLabel.BackgroundTransparency = 1
    playerNameLabel.Text = userName
    playerNameLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    playerNameLabel.Font = Enum.Font.Gotham
    playerNameLabel.TextSize = 12
    playerNameLabel.TextXAlignment = Enum.TextXAlignment.Left
    playerNameLabel.Parent = playerInfo

    local dragging = false
    local dragInput, dragStart, startPos
    local currentInputObject = nil
    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = animationContainer.Position
            currentInputObject = input
            local connection
            connection = input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.Ended then
                    dragging = false
                    currentInputObject = nil
                    connection:Disconnect()
                end
            end)
        end
    end)
    UserInputService.InputChanged:Connect(function(input)
        if dragging and currentInputObject == input and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            animationContainer.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)

    local function clearScripts()
        for _, c in pairs(scriptContainer:GetChildren()) do
            if c:IsA("GuiObject") and c.Name ~= "ScriptFooter" then c:Destroy() end
        end
        if layoutScript then layoutScript:SetAttribute("Refresh", true) end
    end

    local function createScriptButton(name, func)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1, 0, 0, 35)
        btn.BackgroundColor3 = COLOR_SCRIPT_BTN
        btn.BorderSizePixel = 0
        btn.TextColor3 = COLOR_TEXT
        btn.Font = Enum.Font.Gotham
        btn.TextSize = 14
        btn.Text = name
        btn.TextXAlignment = Enum.TextXAlignment.Left
        btn.Parent = scriptContainer
        applyRoundedCorners(btn, 10)
        local padding = Instance.new("UIPadding")
        padding.PaddingLeft = UDim.new(0, 10)
        padding.Parent = btn
        local border = Instance.new("UIStroke")
        border.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        border.Thickness = 1
        border.Color = ACCENT_COLOR
        border.Parent = btn
        btn.MouseEnter:Connect(function()
            TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = ACCENT_COLOR:Lerp(COLOR_SCRIPT_BTN, 0.7)}):Play()
        end)
        btn.MouseLeave:Connect(function()
            TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = COLOR_SCRIPT_BTN}):Play()
        end)
        btn.MouseButton1Click:Connect(function()
            btn.Text = "Executando..."
            btn.Active = false
            btn.AutoButtonColor = false
            spawn(function()
                pcall(func)
                wait(3)
                closeHubWithAnimation(MainFrameContainer)
            end)
        end)
        return btn
    end

    local function createUpdateLabel(text, textColor, font)
        local lbl = Instance.new("TextLabel")
        lbl.Size = UDim2.new(1, -20, 0, 20)
        lbl.BackgroundTransparency = 1
        lbl.TextColor3 = textColor or COLOR_TEXT
        lbl.Font = font or Enum.Font.Gotham
        lbl.TextSize = 12
        lbl.Text = text
        lbl.TextWrapped = true
        lbl.TextXAlignment = Enum.TextXAlignment.Center
        lbl.TextYAlignment = Enum.TextYAlignment.Top
        lbl.Parent = scriptContainer
        return lbl
    end

    local function createCategoryButton(name, contents, layoutOrder)
        local btn = Instance.new("TextButton")
        btn.Name = name:gsub("%s+", "")
        btn.Size = UDim2.new(1, 0, 0, 30)
        btn.BackgroundColor3 = COLOR_CATEGORY_BTN
        btn.BorderSizePixel = 0
        btn.TextColor3 = Color3.fromRGB(230, 230, 230)
        btn.Font = Enum.Font.GothamBold
        btn.TextSize = 12
        btn.Text = "📌 " .. name
        btn.TextXAlignment = Enum.TextXAlignment.Left
        btn.Parent = categoryContainer
        applyRoundedCorners(btn, 10)
        local padding = Instance.new("UIPadding")
        padding.PaddingLeft = UDim.new(0, 10)
        padding.Parent = btn
        local border = Instance.new("UIStroke")
        border.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        border.Thickness = 1
        border.Color = ACCENT_COLOR
        border.Parent = btn
        btn.MouseEnter:Connect(function()
            TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = ACCENT_COLOR:Lerp(COLOR_CATEGORY_BTN, 0.7)}):Play()
        end)
        btn.MouseLeave:Connect(function()
            TweenService:Create(btn, TweenInfo.new(0.2), {BackgroundColor3 = COLOR_CATEGORY_BTN}):Play()
        end)
        if layoutOrder then btn.LayoutOrder = layoutOrder end
        btn.MouseButton1Click:Connect(function()
            clearScripts()
            scriptFooter.Visible = false
            if typeof(contents) == "table" then
                for _, s in ipairs(contents) do createScriptButton(s.Name, s.Func) end
            elseif typeof(contents) == "string" then
                createUpdateLabel(contents)
            elseif typeof(contents) == "function" then
                contents()
                if contents == displayUpdates then scriptFooter.Visible = true end
            end
            if layoutScript then layoutScript:SetAttribute("Refresh", true) end
        end)
        return btn
    end

    local updatesTextFormatted = {
        {Text = "🌟 Brunojegue Hub V1.1", Color = Color3.fromRGB(255, 255, 255), Font = Enum.Font.GothamBlack},
        {Text = "➕ Novo Script: Steal a Brainrot", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "➕ Novo Script: Forsaken", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "➕ Novo Script: Pegue o Peixe!", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "🎉 Nova Mensagem de Boas Vindas!", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "🐛 Correções de Bugs", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "📏 Tamanho do Hub Ajustado", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "💡 Deixe Sugestões no DC!", Color = Color3.fromRGB(255, 165, 0), Font = Enum.Font.GothamBold},
    }

    local function displayUpdates()
        clearScripts()
        for _, lineData in ipairs(updatesTextFormatted) do
            createUpdateLabel(lineData.Text, lineData.Color, lineData.Font)
        end
        scriptFooter.Visible = true
        if layoutScript then layoutScript:SetAttribute("Refresh", true) end
    end

    local stealScripts = {{Name = "🎮 Dofug", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/OneClye1/dofug/refs/heads/main/dofug.txt"))() end}}
    local noiteScripts = {{Name = "🌙 Iliankytb", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Iliankytb/Iliankytb/main/Best99NightsInTheForest"))() end}}
    local growScripts = {{Name = "🌱 No Lag Hub", Func = function() loadstring(game:HttpGet("https://pastebin.com/raw/XHMN2zpp"))() end}}
    local voxSeasScripts = {{Name = "⚓ Brutus Hub", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/codenixstudios/brutus-hub/BRUTUS_TEAM/Games/VoxSeas.lua"))() end}}
    local bloxFruitsScripts = {{Name = "🍇 Xero Hub", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Xero2409/XeroHub/refs/heads/main/main.lua"))() end}}
    local kingLegacyScripts = {{Name = "👑 Zee Hub", Func = function() loadstring(game:HttpGet('https://zuwz.me/Ls-Zee-Hub-KL'))() end}}
    local rivalsScripts = {{Name = "🏆 Rise", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/ShadowBey01/SHWX-Team-Rise-Scripts/refs/heads/main/Games/Rise%20(Rivals).lua", true))() end}}
    local doorsScripts = {{Name = "🚪 Velocity X", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/DasVelocity/VelocityX/refs/heads/main/VelocityX.lua"))() end}}
    local brookhavenScripts = {{Name = "🏡 Sander XY", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/kigredns/testUIDK/refs/heads/main/panel.lua"))() end}}
    local buildAPlaneScripts = {{Name = "✈️ Arbix Hub", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Z1ntrax/bigmac/refs/heads/main/bap/bapobfuscated.lua"))() end}}
    local inkGameScripts = {{Name = "🎨 Revive Hub", Func = function() loadstring(game:HttpGet('https://raw.githubusercontent.com/Have3165/Reviv3-Hub/refs/heads/main/InkGame'))() end}}
    local naturalDisasterScripts = {{Name = "🌪️ BaconJJScript", Func = function() loadstring(game:HttpGet("https://pastebin.com/raw/MAnXu0qv"))() end}}
    local forsakenScripts = {{Name = "💀 SNT HUB", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Snowt69/SNT-HUB/refs/heads/main/Forsaken"))() end}}
    local pegueOPeixeScripts = {{Name = "🎣 VinzHub", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Vinzyy13/VinzHub/refs/heads/main/Fish-It"))() end}}
    local murderMysteryScripts = {{Name = "🔪 Thunder hub MM2", Func = function() loadstring(game:HttpGet('https://raw.githubusercontent.com/Roman34296589/SnapSanixHUB/refs/heads/main/SnapSanixHUB.lua'))() end}}
    local weakLegacy2Scripts = {{Name = "⚔️ L4BIB HUB", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/L4BIBKAZI/L4BIB-HUB/refs/heads/main/Weak%20Legacy%202"))() end}}
    local plantaVSBrainrotScripts = {{Name = "🌿 Gumanba", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/gumanba/Scripts/main/PlantsVsBrainrots"))() end}}
    local deadRailsScripts = {{Name = "🚂 Qiwik hub", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Qiwikox12/stubrawl/refs/heads/main/DeadRails.txt"))() end}}
    local testeDeQiScripts = {{Name = "🧠 Aqua-Hub", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/ExploiterGuy/Aqua-Hub/refs/heads/main/IQ%20TEST.txt"))() end}}
    local passOrDieScripts = {{Name = "💥 DAVITROLLZ", Func = function() loadstring(game:HttpGet("https://raw.githubusercontent.com/Davidfhdgfyyfytyttry/DAVITROLLZ-BRASIL/refs/heads/main/Pass%20or%20die"))() end}}
    local mathMurderScripts = {}
    local fightingGamesScripts = {{Name = "🥊 Hub Fighting", Func = function() loadstring(game:HttpGet("URL_DO_SEU_SCRIPT_FIGHTING_GAMES_1"))() end}}
    local simulationScripts = {{Name = "🌍 Hub Sim", Func = function() loadstring(game:HttpGet("URL_DO_SEU_SCRIPT_SIMULATION_1"))() end}}
    local tycoonScripts = {{Name = "🏰 Hub Tycoon", Func = function() loadstring(game:HttpGet("URL_DO_SEU_SCRIPT_TYCOON_1"))() end}}

    createCategoryButton("📣 Atualizações", displayUpdates, 1)
    createCategoryButton("Steal a Brainrot", stealScripts, 2)
    createCategoryButton("99 Noites na Floresta", noiteScripts, 3)
    createCategoryButton("Grow a Garden", growScripts, 4)
    createCategoryButton("Vox Seas", voxSeasScripts, 5)
    createCategoryButton("Blox Fruits", bloxFruitsScripts, 6)
    createCategoryButton("King Legacy", kingLegacyScripts, 7)
    createCategoryButton("Rivals", rivalsScripts, 8)
    createCategoryButton("Doors", doorsScripts, 9)
    createCategoryButton("Brookhaven", brookhavenScripts, 10)
    createCategoryButton("Build a Plane", buildAPlaneScripts, 11)
    createCategoryButton("Ink Game", inkGameScripts, 12)
    createCategoryButton("Natural Disaster", naturalDisasterScripts, 13)
    createCategoryButton("Forsaken", forsakenScripts, 14)
    createCategoryButton("Pegue o Peixe", pegueOPeixeScripts, 15)
    createCategoryButton("Murder Mystery", murderMysteryScripts, 16)
    createCategoryButton("Weak Legacy 2", weakLegacy2Scripts, 17)
    createCategoryButton("Planta vs Brainrot", plantaVSBrainrotScripts, 18)
    createCategoryButton("Dead Rails", deadRailsScripts, 19)
    createCategoryButton("Teste de QI", testeDeQiScripts, 20)
    createCategoryButton("Pass or Die", passOrDieScripts, 21)
    createCategoryButton("Math Murder", mathMurderScripts, 22)
    createCategoryButton("Fighting Games", fightingGamesScripts, 23)
    createCategoryButton("Simulation Games", simulationScripts, 24)
    createCategoryButton("Tycoon Games", tycoonScripts, 25)

    local firstCategoryButton = categoryContainer:FindFirstChildOfClass("TextButton")
    if firstCategoryButton then firstCategoryButton:MouseButton1Click() end
    return animationContainer
end

local function showLoadingAndOpenHub()
    LoadingScreen, StopLoadingAnim = showLoadingScreen()
    wait(2)
    if StopLoadingAnim then StopLoadingAnim() end
    if LoadingScreen and LoadingScreen.Parent then LoadingScreen:Destroy() end
    if not HasShownWelcome then
        local welcomeFrame = Instance.new("Frame")
        welcomeFrame.Size = UDim2.new(0, 0, 0, 0)
        welcomeFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
        welcomeFrame.AnchorPoint = Vector2.new(0.5, 0.5)
        welcomeFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
        welcomeFrame.BorderSizePixel = 0
        welcomeFrame.Parent = ScreenGui
        applyRoundedCorners(welcomeFrame, 20)
        welcomeFrame.BackgroundTransparency = 1
        local gradient = Instance.new("UIGradient")
        gradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, ACCENT_COLOR), ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 20, 20))})
        gradient.Rotation = 45
        gradient.Parent = welcomeFrame
        local welcomeMsg = Instance.new("TextLabel")
        welcomeMsg.Size = UDim2.new(1, -20, 1, -10)
        welcomeMsg.BackgroundTransparency = 1
        welcomeMsg.TextColor3 = COLOR_TEXT
        welcomeMsg.Font = Enum.Font.GothamBlack
        welcomeMsg.TextSize = 22
        welcomeMsg.Text = "🎉 Bem-vindo, " .. player.Name .. " ao Brunojegue Hub!"
        welcomeMsg.TextWrapped = true
        welcomeMsg.TextXAlignment = Enum.TextXAlignment.Center
        welcomeMsg.TextYAlignment = Enum.TextYAlignment.Center
        welcomeMsg.Parent = welcomeFrame
        local tweenInfoExpand = TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out)
        local goalExpand = {Size = UDim2.new(0, 320, 0, 60), Position = UDim2.new(0.5, -160, 0.5, -30), BackgroundTransparency = 0}
        local tweenExpand = TweenService:Create(welcomeFrame, tweenInfoExpand, goalExpand)
        local tweenInfoFadeOut = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
        local goalFadeOut = {TextTransparency = 1}
        local tweenFadeOut = TweenService:Create(welcomeMsg, tweenInfoFadeOut, goalFadeOut)
        local tweenFadeOutFrame = TweenService:Create(welcomeFrame, tweenInfoFadeOut, {BackgroundTransparency = 1})
        tweenExpand:Play()
        tweenExpand.Completed:Wait()
        wait(2)
        tweenFadeOut:Play()
        tweenFadeOutFrame:Play()
        tweenFadeOutFrame.Completed:Wait()
        if welcomeFrame and welcomeFrame.Parent then welcomeFrame:Destroy() end
        HasShownWelcome = true
    end
    MainFrameContainer = createHub()
    HubOpen = true
end

local function validateKeyAndOpen(key, isAuto)
    local lowerKey = key:lower()
    if table.find(validKeys, lowerKey) then
        saveKeyLocally(lowerKey)
        if KeyFrame and KeyFrame.Parent then KeyFrame:Destroy(); KeyFrame = nil end
        showLoadingAndOpenHub()
        ToggleButton.Visible = false
        if isAuto then showAutoMessage("Brunojegue Hub carregado! Sua key foi verificada automaticamente.") end
        return true
    else
        removeLocalKey()
        if not isAuto then showError("Key incorreta") end
        return false
    end
end

local function tryAutoValidate() local savedKey = loadKeyLocally(); if savedKey and table.find(validKeys, savedKey) then return validateKeyAndOpen(savedKey, true) else removeLocalKey(); return false end end

local function createKeyInputFrame()
    local frame = Instance.new("Frame")
    frame.Name = "KeyFrame"
    frame.Size = UDim2.new(0, 320, 0, 260)
    frame.Position = UDim2.new(0.5, -160, 0.5, -130)
    frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    frame.BorderSizePixel = 0
    frame.Parent = ScreenGui
    applyRoundedCorners(frame, 20)
    local gradient = Instance.new("UIGradient")
    gradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, ACCENT_COLOR), ColorSequenceKeypoint.new(1, Color3.fromRGB(20, 20, 20))})
    gradient.Rotation = 45
    gradient.Parent = frame

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "KeyTitle"
    titleLabel.Size = UDim2.new(1, -20, 0, 40)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "🔑 Insira sua Key aqui!"
    titleLabel.Font = Enum.Font.GothamBlack
    titleLabel.TextSize = 18
    titleLabel.TextYAlignment = Enum.TextYAlignment.Center
    titleLabel.TextXAlignment = Enum.TextXAlignment.Center
    titleLabel.TextColor3 = ACCENT_COLOR
    titleLabel.Parent = frame

    local byLabel = Instance.new("TextLabel")
    byLabel.Name = "ByLabel"
    byLabel.Size = UDim2.new(1, 0, 0, 20)
    byLabel.Position = UDim2.new(0, 0, 0, 45)
    byLabel.BackgroundTransparency = 1
    byLabel.TextColor3 = COLOR_FOOTER_TEXT
    byLabel.Font = Enum.Font.Gotham
    byLabel.TextSize = 12
    byLabel.Text = "Criado por Brunojegue"
    byLabel.TextXAlignment = Enum.TextXAlignment.Center
    byLabel.TextYAlignment = Enum.TextYAlignment.Top
    byLabel.Parent = frame

    local keyBox = Instance.new("TextBox")
    keyBox.Name = "KeyBox"
    keyBox.Size = UDim2.new(1, -40, 0, 40)
    keyBox.Position = UDim2.new(0, 20, 0, 70)
    keyBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    keyBox.TextColor3 = COLOR_TEXT
    keyBox.Font = Enum.Font.Gotham
    keyBox.TextSize = 16
    keyBox.ClearTextOnFocus = false
    keyBox.Text = ""
    keyBox.PlaceholderText = "Digite sua Key..."
    keyBox.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
    applyRoundedCorners(keyBox, 10)
    keyBox.Parent = frame
    local keyBoxGradient = Instance.new("UIGradient")
    keyBoxGradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, ACCENT_COLOR), ColorSequenceKeypoint.new(1, Color3.fromRGB(30, 30, 30))})
    keyBoxGradient.Rotation = 90
    keyBoxGradient.Parent = keyBox

    local confirmBtn = Instance.new("TextButton")
    confirmBtn.Name = "EnterButton"
    confirmBtn.Size = UDim2.new(0, 100, 0, 35)
    confirmBtn.Position = UDim2.new(0.5, -50, 0, 120)
    confirmBtn.BackgroundColor3 = COLOR_SCRIPT_BTN
    confirmBtn.TextColor3 = COLOR_TEXT
    confirmBtn.Font = Enum.Font.GothamBold
    confirmBtn.TextSize = 16
    confirmBtn.Text = "Confirmar"
    applyRoundedCorners(confirmBtn, 10)
    confirmBtn.Parent = frame
    local confirmGradient = Instance.new("UIGradient")
    confirmGradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, ACCENT_COLOR), ColorSequenceKeypoint.new(1, COLOR_SCRIPT_BTN)})
    confirmGradient.Rotation = 90
    confirmGradient.Parent = confirmBtn
    confirmBtn.MouseEnter:Connect(function()
        TweenService:Create(confirmBtn, TweenInfo.new(0.2), {BackgroundColor3 = ACCENT_COLOR:Lerp(COLOR_SCRIPT_BTN, 0.7)}):Play()
    end)
    confirmBtn.MouseLeave:Connect(function()
        TweenService:Create(confirmBtn, TweenInfo.new(0.2), {BackgroundColor3 = COLOR_SCRIPT_BTN}):Play()
    end)

    local copyKeyBtn = Instance.new("TextButton")
    copyKeyBtn.Name = "PegarKeyButton"
    copyKeyBtn.Size = UDim2.new(0, 80, 0, 30)
    copyKeyBtn.Position = UDim2.new(0.5, -40, 0, 165)
    copyKeyBtn.BackgroundColor3 = COLOR_SCRIPT_BTN
    copyKeyBtn.TextColor3 = COLOR_TEXT
    copyKeyBtn.Font = Enum.Font.GothamBold
    copyKeyBtn.TextSize = 12
    copyKeyBtn.Text = "Pegar Key"
    applyRoundedCorners(copyKeyBtn, 10)
    copyKeyBtn.Parent = frame
    local copyGradient = Instance.new("UIGradient")
    copyGradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, ACCENT_COLOR), ColorSequenceKeypoint.new(1, COLOR_SCRIPT_BTN)})
    copyGradient.Rotation = 90
    copyGradient.Parent = copyKeyBtn
    copyKeyBtn.MouseEnter:Connect(function()
        TweenService:Create(copyKeyBtn, TweenInfo.new(0.2), {BackgroundColor3 = ACCENT_COLOR:Lerp(COLOR_SCRIPT_BTN, 0.7)}):Play()
    end)
    copyKeyBtn.MouseLeave:Connect(function()
        TweenService:Create(copyKeyBtn, TweenInfo.new(0.2), {BackgroundColor3 = COLOR_SCRIPT_BTN}):Play()
    end)

    local infoLabel = Instance.new("TextLabel")
    infoLabel.Name = "InfoText"
    infoLabel.Size = UDim2.new(1, -40, 0, 30)
    infoLabel.Position = UDim2.new(0, 20, 0, 200)
    infoLabel.BackgroundTransparency = 1
    infoLabel.Font = Enum.Font.GothamBold
    infoLabel.TextSize = 12
    infoLabel.Text = "Clique em 'Pegar Key' e cole no Discord!"
    infoLabel.TextWrapped = true
    infoLabel.TextXAlignment = Enum.TextXAlignment.Center
    infoLabel.TextYAlignment = Enum.TextYAlignment.Top
    infoLabel.TextColor3 = COLOR_FOOTER_TEXT
    infoLabel.Parent = frame

    ErrorLabel = Instance.new("TextLabel")
    ErrorLabel.Name = "ErrorLabel"
    ErrorLabel.Size = UDim2.new(1, -20, 0, 20)
    ErrorLabel.Position = UDim2.new(0, 10, 1, -30)
    ErrorLabel.BackgroundTransparency = 1
    ErrorLabel.TextColor3 = COLOR_ERROR
    ErrorLabel.Font = Enum.Font.GothamBold
    ErrorLabel.TextSize = 14
    ErrorLabel.Text = ""
    ErrorLabel.Parent = frame

    local function showLocalError(msg) ErrorLabel.Text = msg; spawn(function() wait(2); if ErrorLabel and ErrorLabel.Parent == frame then ErrorLabel.Text = "" end end) end
    copyKeyBtn.MouseButton1Click:Connect(function() local s, _ = copyToClipboard("discord.gg/aNaFpb2Qsb"); if s then copyKeyBtn.Text = "Copiado!"; wait(2); copyKeyBtn.Text = "Pegar Key" else showLocalError("Falha ao copiar.") end end)
    confirmBtn.MouseButton1Click:Connect(function() validateKeyAndOpen(keyBox.Text:gsub("%s", ""):lower(), false) end)
    return frame, showLocalError
end

ToggleButton = Instance.new("ImageButton")
ToggleButton.Name = "ToggleButton"
ToggleButton.Size = UDim2.new(0, 40, 0, 40)
ToggleButton.Position = UDim2.new(0, 15, 0, 15)
ToggleButton.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
ToggleButton.Image = "rbxassetid://7072724534" -- Ícone de menu
ToggleButton.ImageColor3 = ACCENT_COLOR
ToggleButton.BackgroundTransparency = 0.7
ToggleButton.Parent = ScreenGui
applyRoundedCorners(ToggleButton, 15)
local draggingToggle = false
local dragStartToggle, startPosToggle
local currentInputObjectToggle = nil
ToggleButton.MouseEnter:Connect(function()
    TweenService:Create(ToggleButton, TweenInfo.new(0.2), {BackgroundTransparency = 0.4}):Play()
end)
ToggleButton.MouseLeave:Connect(function()
    TweenService:Create(ToggleButton, TweenInfo.new(0.2), {BackgroundTransparency = 0.7}):Play()
end)
ToggleButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        draggingToggle = true
        dragStartToggle = input.Position
        startPosToggle = ToggleButton.Position
        currentInputObjectToggle = input
        local connection
        connection = input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.Ended then
                draggingToggle = false
                currentInputObjectToggle = nil
                connection:Disconnect()
            end
        end)
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if draggingToggle and currentInputObjectToggle == input and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStartToggle
        ToggleButton.Position = UDim2.new(startPosToggle.X.Scale, startPosToggle.X.Offset + delta.X, startPosToggle.Y.Scale, startPosToggle.Y.Offset + delta.Y)
    end
end)
ToggleButton.MouseButton1Click:Connect(function()
    if HubOpen then
        if MainFrameContainer then closeHubWithAnimation(MainFrameContainer) end
    else
        if KeyFrame and KeyFrame.Parent then KeyFrame:Destroy(); KeyFrame = nil end
        if LoadingScreen and LoadingScreen.Parent then if StopLoadingAnim then StopLoadingAnim() end; LoadingScreen:Destroy(); LoadingScreen = nil end
        if HasShownWelcome then
            MainFrameContainer = createHub()
            HubOpen = true
        else
            showLoadingAndOpenHub()
        end
    end
end)
if not tryAutoValidate() then KeyFrame, showError = createKeyInputFrame() end
