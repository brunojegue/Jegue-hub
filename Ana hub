--[[
    Khalexis Hub - Script Hub para Roblox com sistema de key, barra de pesquisa e configura√ß√µes de tema
    Vers√£o Final Refinada e Robusta com Corre√ß√µes de Rolagem
]]

-- SERVI√áOS ESSENCIAIS
local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local UserInputService = game:GetService("UserInputService")
local RunService = game:GetService("RunService")
local HttpService = game:GetService("HttpService")

-- CONFIGURA√á√ïES GLOBAIS
local MODULE_NAME = "KhalexisHub"
local LOCAL_STORAGE_KEY_FILENAME = MODULE_NAME .. "_Key.txt"
-- IMPORTANTE: Substitua estas URLs por suas URLs reais de backend/configura√ß√£o.
-- Se n√£o for usar um backend, pode deixar como URLs fict√≠cias ou remover a chamada remota na autentica√ß√£o.
local AUTH_SERVER_URL = "https://raw.githubusercontent.com/SEU-USUARIO/SEU-REPOSITORIO/main/auth.txt" -- URL para verificar chaves (requer backend)
local SCRIPT_LIST_URL = "https://raw.githubusercontent.com/SEU-USUARIO/SEU-REPOSITORIO/main/scripts.json" -- URL para a lista de scripts e metadados (opcional)

-- VARI√ÅVEIS LOCAIS GLOBAIS
local ScreenGui
local MainFrameContainer = nil
local ToggleButton
local ErrorLabel
local HasShownWelcome = false
local IsHubOpen = false
local CurrentTheme = "normal" -- Tema padr√£o

-- PALETAS DE CORES
local themes = {
    normal = { main_bg = Color3.fromRGB(30, 30, 30), category_bg = Color3.fromRGB(50, 50, 50), title_bar = Color3.fromRGB(45, 45, 45), script_frame_bg = Color3.fromRGB(30, 30, 30), transparency = 0 },
    preto = { main_bg = Color3.fromRGB(10, 10, 10), category_bg = Color3.fromRGB(25, 25, 25), title_bar = Color3.fromRGB(20, 20, 20), script_frame_bg = Color3.fromRGB(10, 10, 10), transparency = 0 },
    laranja = { main_bg = Color3.fromRGB(255, 140, 0), category_bg = Color3.fromRGB(40, 40, 40), title_bar = Color3.fromRGB(30, 30, 30), script_frame_bg = Color3.fromRGB(50, 50, 50), transparency = 0 },
    roxo = { main_bg = Color3.fromRGB(138, 43, 226), category_bg = Color3.fromRGB(40, 40, 40), title_bar = Color3.fromRGB(30, 30, 30), script_frame_bg = Color3.fromRGB(50, 50, 50), transparency = 0 },
    transparente = { main_bg = Color3.fromRGB(30, 30, 30), category_bg = Color3.fromRGB(50, 50, 50), title_bar = Color3.fromRGB(45, 45, 45), script_frame_bg = Color3.fromRGB(30, 30, 30), transparency = 0.4 }
}

local COLOR_TEXT = Color3.fromRGB(220, 220, 220)
local COLOR_ERROR = Color3.fromRGB(255, 85, 85)
local COLOR_FOOTER_TEXT = Color3.fromRGB(170, 170, 170)

-- DADOS DE SCRIPTS (Para uso local. Remova ou comente se for carregar de SCRIPT_LIST_URL)
local gameScriptsData = {
    ["Steal a Brainrot"] = { {Name="Dofug", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/OneClye1/dofug/refs/heads/main/dofug.txt"))()end, LayoutOrder=1}, {Name="Miranda Tween", Func=function()loadstring(game:HttpGet("https://pastefy.app/TnWWJ4NS/raw"))()end, LayoutOrder=2}, {Name="Chilli Hub", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/tienkhanh1/spicy/main/Chilli.lua"))()end, LayoutOrder=3}, {Name="Delfi Script", Func=function()loadstring(game:HttpGet("https://pastefy.app/7MQOgJCO/raw"))()end, LayoutOrder=4} },
    ["99 Noites na Floresta"] = { {Name="Iliankytb", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Iliankytb/Iliankytb/main/Best99NightsInTheForest"))()end}, {Name="Kenniel Scripts", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Kenniel123/99-Nights-in-the-Forest/refs/heads/main/99%20Nights%20in%20the%20Forest"))()end}, {Name="Hutao Hub", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/SLK-gaming/Hutao-Hub/refs/heads/main/99-Nights-In-The-Forest.txt"))()end}, {Name="Ringta Script", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/wefwef127382/99daysloader.github.io/refs/heads/main/ringta.lua"))()end}, {Name="Voidware", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/VapeVoidware/VWExtra/main/NightsInTheForest.lua",true))()end}, {Name="Vex Op", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/yoursvexyyy/VEX-OP/refs/heads/main/99%20nights%20in%20the%20forest"))()end} },
    ["Grow a Garden"] = { {Name="No Lag Hub", Func=function()loadstring(game:HttpGet("https://pastebin.com/raw/XHMN2zpp"))()end}, {Name="MauScripts", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/nootmaus/GrowAAGarden/refs/heads/main/mauscripts"))()end}, {Name="ThanHub", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/thantzy/thanhub/refs/heads/main/thanv1"))()end} },
    ["Vox Seas"] = { {Name="Brutus Hub", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/codenixstudios/brutus-hub/BRUTUS_TEAM/Games/VoxSeas.lua"))()end}, {Name="Type Hub", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/meobeo8/type/main/VoxSeasAutoChest.lua"))()end}, {Name="Idk Hub", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/shakaUnlocked/IiI/refs/heads/main/vxs.lua"))()end} },
    ["Blox Fruits"] = { {Name="Xero Hub", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Xero2409/XeroHub/refs/heads/main/main.lua"))()end, LayoutOrder=1}, {Name="Volcano Hub", Func=function()loadstring(game:HttpGetAsync("https://raw.githubusercontent.com/indexeduu/BF-NewVer/refs/heads/main/V3New.lua"))()end, LayoutOrder=2}, {Name="Blue X Hub", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Dev-BlueX/BlueX-Hub/refs/heads/main/Main.lua"))()end, LayoutOrder=3}, {Name="Quantum Onyx", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/flazhy/QuantumOnyx/refs/heads/main/QuantumOnyx.lua"))()end,LayoutOrder=4} },
    ["King Legacy"] = { {Name="Zee Hub", Func=function()loadstring(game:HttpGet('https://zuwz.me/Ls-Zee-Hub-KL'))()end} },
    ["Rivals"] = { {Name="Rise", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/ShadowBey01/SHWX-Team-Rise-Scripts/refs/heads/main/Games/Rise%20(Rivals).lua",true))()end} },
    ["Doors"] = { {Name="Velocity X", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/DasVelocity/VelocityX/refs/heads/main/VelocityX.lua"))()end}, {Name="Saturn Hub", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/JScripter-Lua/Saturn_Hub_Products/refs/heads/main/Saturn_Hub_Doors.lua"))()end} },
    ["Brookhaven"] = { {Name="Sander XY", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/kigredns/testUIDK/refs/heads/main/panel.lua"))()end} },
    ["Build a Plane"] = { {Name="Arbix Hub", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Z1ntrax/bigmac/refs/heads/main/bap/bapobfuscated.lua"))()end} },
    ["Ink Game"] = { {Name="Revive Hub", Func=function()loadstring(game:HttpGet('https://raw.githubusercontent.com/Have3165/Reviv3-Hub/refs/heads/main/InkGame'))()end} },
    ["Natural Disaster"] = { {Name="BaconJJScript", Func=function()loadstring(game:HttpGet("https://pastebin.com/raw/MAnXu0qv"))()end} },
    ["Forsaken"] = { {Name="SNT HUB", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Snowt69/SNT-HUB/refs/heads/main/Forsaken"))()end} },
    ["Pegue o Peixe"] = { {Name="VinzHub", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Vinzyy13/VinzHub/refs/heads/main/Fish-It"))()end} },
    ["Murder Mystery"] = { {Name="Thunder hub MM2", Func=function()loadstring(game:HttpGet('https://raw.githubusercontent.com/Roman34296589/SnapSanixHUB/refs/heads/main/SnapSanixHUB.lua'))()end} },
    ["Weak Legacy 2"] = { {Name="L4BIB HUB", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/L4BIBKAZI/L4BIB-HUB/refs/heads/main/Weak%20Legacy%202"))()end} },
    ["Planta VS Brainrot"] = { {Name="Gumanba", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/gumanba/Scripts/main/PlantsVsBrainrots"))()end}, {Name="Blessed-Hub-X", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/mynamewendel-ctrl/Blessed-Hub-X-/refs/heads/main/Plants-Vs-Brainrots.lua"))()end} },
    ["Dead Rails"] = { {Name="Qiwik hub", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Qiwikox12/stubrawl/refs/heads/main/DeadRails.txt"))()end}, {Name="Tora IsMe", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/gumanba/Scripts/refs/heads/main/DeadRails", true))()end} },
    ["Teste de Qi"] = { {Name="Aqua-Hub", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/ExploiterGuy/Aqua-Hub/refs/heads/main/IQ%20TEST.txt"))()end} },
    ["Pass or Die"] = { {Name="DAVITROLLZ", Func=function()loadstring(game:HttpGet("https://raw.githubusercontent.com/Davidfhdgfyyfytyttry/DAVITROLLZ-BRASIL/refs/heads/main/Pass%20or%20die"))()end} },
    ["Fighting Games"] = { {Name="Hub Fighting (Exemplo)", Func=function() loadstring(game:HttpGet("URL_DO_SEU_SCRIPT_FIGHTING_GAMES_1"))() end} },
}

-- Mapeamento das categorias para a UI
local categoriesConfig = {
    {Name="üì£ Atualiza√ß√µes üì£", Type="function", Content=nil, LayoutOrder=1}, -- Ser√° preenchido com displayUpdates
    {Key="Steal a Brainrot", Name="Steal a Brainrot Scripts", Type="scripts", LayoutOrder=2},
    {Key="99 Noites na Floresta", Name="99 Noites na Floresta Scripts", Type="scripts", LayoutOrder=3},
    {Key="Grow a Garden", Name="Grow a Garden Scripts", Type="scripts", LayoutOrder=4},
    {Key="Vox Seas", Name="Vox Seas Scripts", Type="scripts", LayoutOrder=5},
    {Key="Blox Fruits", Name="Blox Fruits Scripts", Type="scripts", LayoutOrder=6},
    {Key="King Legacy", Name="King Legacy Scripts", Type="scripts", LayoutOrder=7},
    {Key="Rivals", Name="Rivals Scripts", Type="scripts", LayoutOrder=8},
    {Key="Doors", Name="Doors Scripts", Type="scripts", LayoutOrder=9},
    {Key="Brookhaven", Name="Brookhaven Scripts", Type="scripts", LayoutOrder=10},
    {Key="Build a Plane", Name="Build a Plane Scripts", Type="scripts", LayoutOrder=11},
    {Key="Ink Game", Name="Ink Game Scripts", Type="scripts", LayoutOrder=12},
    {Key="Natural Disaster", Name="Natural Disaster Scripts", Type="scripts", LayoutOrder=13},
    {Key="Forsaken", Name="Forsaken Scripts", Type="scripts", LayoutOrder=14},
    {Key="Pegue o Peixe", Name="Pegue o Peixe Scripts", Type="scripts", LayoutOrder=15},
    {Key="Murder Mystery", Name="Murder Mystery Scripts", Type="scripts", LayoutOrder=16},
    {Key="Weak Legacy 2", Name="Weak Legacy 2", Type="scripts", LayoutOrder=17},
    {Key="Planta VS Brainrot", Name="Planta VS Brainrot Scripts", Type="scripts", LayoutOrder=18},
    {Key="Dead Rails", Name="Dead Rails Scripts", Type="scripts", LayoutOrder=19},
    {Key="Teste de Qi", Name="Teste de Qi Scripts", Type="scripts", LayoutOrder=20},
    {Key="Pass or Die", Name="Pass or Die Scripts", Type="scripts", LayoutOrder=21},
    {Key="Fighting Games", Name="Fighting Games", Type="scripts", LayoutOrder=22},
}

-- FUN√á√ïES DE UTILIDADE
local function applyRoundedCorners(guiObject, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, radius or 8)
    corner.Parent = guiObject
end

local function saveKeyLocally(key)
    pcall(function()
        if writefile then writefile(LOCAL_STORAGE_KEY_FILENAME, key)
        elseif write_file then write_file(LOCAL_STORAGE_KEY_FILENAME, key) end
    end)
end

local function loadKeyLocally()
    local s, c = pcall(function()
        if readfile then return readfile(LOCAL_STORAGE_KEY_FILENAME)
        elseif read_file then return read_file(LOCAL_STORAGE_KEY_FILENAME) end
    end)
    if s and c then return c:lower() end
    return nil
end

local function removeLocalKey()
    pcall(function()
        if delfile then delfile(LOCAL_STORAGE_KEY_FILENAME)
        elseif deletefile then deletefile(LOCAL_STORAGE_KEY_FILENAME) end
    end)
end

local function showError(msg)
    if ErrorLabel then ErrorLabel.Text = msg end
    spawn(function()
        wait(2.5)
        if ErrorLabel and ErrorLabel.Parent and ErrorLabel.Text == msg then ErrorLabel.Text = "" end
    end)
end

local function showAutoMessage(msg)
    local m = Instance.new("Frame")
    m.Name = "AutoMessageFrame"
    m.Size = UDim2.new(0, 320, 0, 45)
    m.Position = UDim2.new(1, -330, 1, -55)
    m.BackgroundColor3 = themes[CurrentTheme].main_bg
    m.BorderSizePixel = 0
    m.Parent = ScreenGui
    applyRoundedCorners(m, 10)

    local l = Instance.new("TextLabel")
    l.Size = UDim2.new(1, -20, 1, -10)
    l.Position = UDim2.new(0, 10, 0, 5)
    l.BackgroundTransparency = 1
    l.TextColor3 = COLOR_TEXT
    l.Font = Enum.Font.GothamBold
    l.TextSize = 16
    l.Text = msg
    l.TextWrapped = true
    l.TextXAlignment = Enum.TextXAlignment.Left
    l.TextYAlignment = Enum.TextYAlignment.Center
    l.Parent = m

    spawn(function()
        wait(4)
        if m and m.Parent then m:Destroy() end
    end)
end

local function copyToClipboard(text)
    return pcall(function()
        if setclipboard then setclipboard(text)
        elseif toclipboard then toclipboard(text)
        else error("Clipboard function not supported.") end
    end)
end

local function applyTheme(themeName)
    CurrentTheme = themeName
    local palette = themes[themeName]
    if not palette or not MainFrameContainer then return end

    local MainFrame = MainFrameContainer:FindFirstChild("MainFrame")
    if not MainFrame then return end

    local titleBar = MainFrame:FindFirstChild("TitleBar")
    local categoryFrame = MainFrame:FindFirstChild("CategoryFrame")
    local scriptFrame = MainFrame:FindFirstChild("ScriptFrame")
    local footerBackground = MainFrame:FindFirstChild("FooterBackground")
    local searchBox = MainFrame:FindFirstChild("CategorySearchBox")

    MainFrame.BackgroundColor3 = palette.main_bg
    MainFrame.BackgroundTransparency = palette.transparency
    if titleBar then titleBar.BackgroundColor3 = palette.title_bar end
    if categoryFrame then categoryFrame.BackgroundColor3 = palette.category_bg end
    if scriptFrame then scriptFrame.BackgroundColor3 = palette.script_frame_bg end
    if footerBackground then footerBackground.BackgroundColor3 = palette.title_bar end
    if searchBox then searchBox.BackgroundColor3 = palette.category_bg end
end

-- FUN√á√ïES DE AUTENTICA√á√ÉO E CARREGAMENTO DE DADOS
local function authenticateKey(key)
    -- SIMULA√á√ÉO DE AUTENTICA√á√ÉO: Substitua por uma chamada HTTP real para seu backend.
    -- As chaves de exemplo abaixo s√£o apenas para teste local.
    local validKeys = {
        ["khalexispremium100"] = true,
        ["khalexislindodms10"] = true,
    }

    if validKeys[key:lower()] then
        return true, "Key v√°lida." -- Simula sucesso
    else
        -- Para simular uma requisi√ß√£o HTTP de falha:
        -- local success, result = pcall(function() HttpService:RequestAsync({ Url = AUTH_SERVER_URL, Method = "POST", ... }) end)
        -- if not success then return false, "Falha na comunica√ß√£o com o servidor." end
        -- local response = HttpService:JSONDecode(result.Body)
        -- return response.isValid, response.message
        return false, "Key incorreta ou inv√°lida." -- Simula falha
    end
end

local function loadRemoteData(url)
    local success, result = pcall(function()
        local response = HttpService:RequestAsync({ Url = url, Method = "GET", Headers = { ["Content-Type"] = "application/json" } })
        if response.Success then return response.Body else error("Request failed: " .. response.StatusCode) end
    end)

    if success then
        local data = pcall(function() return HttpService:JSONDecode(result) end)
        if data.success then return data.success
        else showError("Erro ao decodificar dados de " .. url .. ": " .. data.error); return nil end
    else
        showError("Falha ao carregar dados de " .. url .. ": " .. result); return nil end
end

-- FUN√á√ïES DE UI E GERENCIAMENTO DO HUB
local function showLoadingScreen()
    local frame = Instance.new("Frame")
    frame.Name = "LoadingFrame"
    frame.Size = UDim2.new(0, 300, 0, 120)
    frame.Position = UDim2.new(0.5, -150, 0.5, -60)
    frame.BackgroundColor3 = themes[CurrentTheme].main_bg
    frame.BorderSizePixel = 0
    frame.Parent = ScreenGui
    applyRoundedCorners(frame, 16)

    local border = Instance.new("UIStroke")
    border.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    border.Color = Color3.fromRGB(0, 0, 0)
    border.Thickness = 2
    border.Parent = frame

    local label = Instance.new("TextLabel")
    label.Name = "LoadingLabel"
    label.Size = UDim2.new(1, 0, 0, 30)
    label.Position = UDim2.new(0, 0, 0.3, -15)
    label.BackgroundTransparency = 1
    label.Text = "Carregando..."
    label.TextColor3 = COLOR_TEXT
    label.Font = Enum.Font.GothamBold
    label.TextSize = 20
    label.Parent = frame

    local spinner = Instance.new("Frame")
    spinner.Size = UDim2.new(0, 50, 0, 50)
    spinner.Position = UDim2.new(0.5, -25, 0, 60)
    spinner.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    spinner.BorderSizePixel = 0
    applyRoundedCorners(spinner, 25)
    spinner.Parent = frame

    local orangeBall = Instance.new("Frame")
    orangeBall.Size = UDim2.new(0, 50, 0, 50)
    orangeBall.Position = UDim2.new(0, 0, 0, 0)
    orangeBall.BackgroundColor3 = Color3.fromRGB(255, 140, 0)
    applyRoundedCorners(orangeBall, 25)
    orangeBall.Parent = spinner

    local whiteBall = Instance.new("Frame")
    whiteBall.Size = UDim2.new(0, 20, 0, 20)
    whiteBall.Position = UDim2.new(0.5, -10, 0.5, -10)
    whiteBall.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
    applyRoundedCorners(whiteBall, 10)
    whiteBall.Parent = orangeBall

    local angle = 0
    local connection
    connection = RunService.RenderStepped:Connect(function()
        angle = (angle + 6) % 360
        orangeBall.Rotation = angle
        whiteBall.Rotation = -angle * 2
    end)

    return frame, function()
        if connection then
            connection:Disconnect()
            connection = nil
        end
    end
end

local function closeHubWithAnimation(container)
    if not (container and container.Parent) then return end

    local uiScaler = container:FindFirstChildOfClass("UIScale")
    if not uiScaler then container:Destroy(); return end

    local tweenInfo = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
    local goal = { Scale = 0 }
    local tween = TweenService:Create(uiScaler, tweenInfo, goal)
    tween:Play()
    tween.Completed:Wait()

    if container and container.Parent then container:Destroy() end
    MainFrameContainer = nil
    IsHubOpen = false
    if ToggleButton then ToggleButton.Visible = true end
end

local function createHub()
    local animationContainer = Instance.new("Frame")
    animationContainer.Name = "AnimationContainer"
    animationContainer.Size = UDim2.new(0, 350, 0, 280)
    animationContainer.AnchorPoint = Vector2.new(0.5, 0.5)
    animationContainer.Position = UDim2.new(0.5, 0, 0.5, 0)
    animationContainer.BackgroundTransparency = 1
    animationContainer.Parent = ScreenGui

    local uiScaler = Instance.new("UIScale")
    uiScaler.Parent = animationContainer

    local frame = Instance.new("Frame")
    frame.Name = "MainFrame"
    frame.Size = UDim2.new(1, 0, 1, 0)
    frame.Position = UDim2.new(0, 0, 0, 0)
    frame.BackgroundColor3 = themes[CurrentTheme].main_bg
    frame.BorderSizePixel = 0
    frame.Parent = animationContainer
    applyRoundedCorners(frame, 12)

    local hubBorder = Instance.new("UIStroke")
    hubBorder.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    hubBorder.Thickness = 2
    hubBorder.LineJoinMode = Enum.LineJoinMode.Round
    hubBorder.Parent = frame
    local hubGradient = Instance.new("UIGradient")
    hubGradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 140, 0)), ColorSequenceKeypoint.new(1, Color3.fromRGB(220, 100, 0))})
    hubGradient.Rotation = 45
    hubGradient.Parent = hubBorder

    -- Barra de T√≠tulo
    local titleBar = Instance.new("Frame")
    titleBar.Name = "TitleBar"
    titleBar.Size = UDim2.new(1, -10, 0, 30)
    titleBar.Position = UDim2.new(0, 5, 0, 5)
    titleBar.BackgroundColor3 = themes[CurrentTheme].title_bar
    titleBar.BorderSizePixel = 0
    titleBar.Parent = frame
    applyRoundedCorners(titleBar, 10)

    local titleBarBorder = Instance.new("UIStroke")
    titleBarBorder.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    titleBarBorder.Thickness = 1.5
    titleBarBorder.LineJoinMode = Enum.LineJoinMode.Round
    titleBarBorder.Parent = titleBar
    local titleBarGradient = Instance.new("UIGradient")
    titleBarGradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 140, 0)), ColorSequenceKeypoint.new(1, Color3.fromRGB(220, 100, 0))})
    titleBarGradient.Rotation = 90
    titleBarGradient.Parent = titleBarBorder

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "Title"
    titleLabel.Size = UDim2.new(1, 0, 1, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "Khalexis Hub"
    titleLabel.TextColor3 = COLOR_TEXT
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 18
    titleLabel.TextXAlignment = Enum.TextXAlignment.Center
    titleLabel.TextYAlignment = Enum.TextYAlignment.Center
    titleLabel.Parent = titleBar

    -- Bot√£o de Fechar
    local closeButton = Instance.new("TextButton")
    closeButton.Name = "CloseButton"
    closeButton.Size = UDim2.new(0, 24, 0, 24)
    closeButton.Position = UDim2.new(1, -28, 0.5, -12)
    closeButton.BackgroundColor3 = Color3.fromRGB(255, 70, 70)
    closeButton.BackgroundTransparency = 1
    closeButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeButton.Font = Enum.Font.GothamBold
    closeButton.TextSize = 18
    closeButton.Text = "X"
    closeButton.Parent = titleBar
    applyRoundedCorners(closeButton, 12)

    local closeTweenInfo = TweenInfo.new(0.2, Enum.EasingStyle.Quad)
    closeButton.MouseEnter:Connect(function() TweenService:Create(closeButton, closeTweenInfo, {BackgroundTransparency = 0.5}):Play() end)
    closeButton.MouseLeave:Connect(function() TweenService:Create(closeButton, closeTweenInfo, {BackgroundTransparency = 1}):Play() end)
    closeButton.MouseButton1Click:Connect(function() closeHubWithAnimation(animationContainer) end)

    -- Barra de Busca e Frame de Categorias
    local searchBox = Instance.new("TextBox")
    searchBox.Name = "CategorySearchBox"
    searchBox.Size = UDim2.new(0, 120, 0, 22)
    searchBox.Position = UDim2.new(0, 5, 0, 40)
    searchBox.BackgroundColor3 = themes[CurrentTheme].category_bg
    searchBox.TextColor3 = COLOR_TEXT
    searchBox.PlaceholderText = "üîç Pesquisar..."
    searchBox.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
    searchBox.Text = ""
    searchBox.Font = Enum.Font.Gotham
    searchBox.TextSize = 11
    searchBox.ClearTextOnFocus = false
    searchBox.Parent = frame
    applyRoundedCorners(searchBox, 8)

    local categoryFrame = Instance.new("ScrollingFrame")
    categoryFrame.Name = "CategoryFrame"
    categoryFrame.Size = UDim2.new(0, 120, 1, -70)
    categoryFrame.Position = UDim2.new(0, 5, 0, 67)
    categoryFrame.BackgroundColor3 = themes[CurrentTheme].category_bg
    categoryFrame.BorderSizePixel = 0
    categoryFrame.ScrollBarThickness = 6
    categoryFrame.Parent = frame
    applyRoundedCorners(categoryFrame, 12)

    local categoryFrameBorder = Instance.new("UIStroke")
    categoryFrameBorder.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    categoryFrameBorder.Thickness = 1.5
    categoryFrameBorder.LineJoinMode = Enum.LineJoinMode.Round
    categoryFrameBorder.Parent = categoryFrame
    local categoryFrameGradient = Instance.new("UIGradient")
    categoryFrameGradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 140, 0)), ColorSequenceKeypoint.new(1, Color3.fromRGB(220, 100, 0))})
    categoryFrameGradient.Rotation = 90
    categoryFrameGradient.Parent = categoryFrameBorder

    local categoryContainer = Instance.new("Frame")
    categoryContainer.Name = "CategoryContainer"
    categoryContainer.Size = UDim2.new(1, -10, 0, 0) -- Inicialmente com altura 0, ser√° ajustado pelo layout
    categoryContainer.Position = UDim2.new(0, 5, 0, 5)
    categoryContainer.BackgroundTransparency = 1
    categoryContainer.Parent = categoryFrame
    categoryContainer.ClipsDescendants = true

    local layoutCategory = Instance.new("UIListLayout")
    layoutCategory.Padding = UDim.new(0, 10) -- Padding reduzido
    layoutCategory.SortOrder = Enum.SortOrder.LayoutOrder
    layoutCategory.FillDirection = Enum.FillDirection.Vertical
    layoutCategory.HorizontalAlignment = Enum.HorizontalAlignment.Center
    layoutCategory.Parent = categoryContainer

    -- Conex√£o para ajustar o tamanho do CategoryContainer dinamicamente com base no conte√∫do
    layoutCategory:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        categoryContainer.Size = UDim2.new(1, -10, 0, layoutCategory.AbsoluteContentSize.Y)
    end)

    searchBox:GetPropertyChangedSignal("Text"):Connect(function()
        local s = searchBox.Text:lower()
        for _, b in ipairs(categoryContainer:GetChildren()) do
            if b:IsA("TextButton") then
                local n = b.Text:lower()
                b.Visible = string.find(n, s, 1, true) or s == "" -- Mostra se o texto da categoria contiver o termo de busca
            end
        end
    end)

    -- Frame de Scripts
    local scriptFrame = Instance.new("ScrollingFrame")
    scriptFrame.Name = "ScriptFrame"
    scriptFrame.Size = UDim2.new(1, -135, 1, -60)
    scriptFrame.Position = UDim2.new(0, 130, 0, 40)
    scriptFrame.BackgroundColor3 = themes[CurrentTheme].script_frame_bg
    scriptFrame.BorderSizePixel = 0
    scriptFrame.ScrollBarThickness = 6
    scriptFrame.Parent = frame
    applyRoundedCorners(scriptFrame, 16)

    local scriptFrameBorder = Instance.new("UIStroke")
    scriptFrameBorder.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    scriptFrameBorder.Thickness = 1.5
    scriptFrameBorder.LineJoinMode = Enum.LineJoinMode.Round
    scriptFrameBorder.Parent = scriptFrame
    local scriptFrameGradient = Instance.new("UIGradient")
    scriptFrameGradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 140, 0)), ColorSequenceKeypoint.new(1, Color3.fromRGB(220, 100, 0))})
    scriptFrameGradient.Rotation = 90
    scriptFrameGradient.Parent = scriptFrameBorder

    local scriptContainer = Instance.new("Frame")
    scriptContainer.Name = "ScriptContainer"
    scriptContainer.Size = UDim2.new(1, -20, 0, 0) -- Inicialmente com altura 0
    scriptContainer.Position = UDim2.new(0, 10, 0, 10)
    scriptContainer.BackgroundTransparency = 1
    scriptContainer.Parent = scriptFrame
    scriptContainer.ClipsDescendants = true

    local layoutScript = Instance.new("UIListLayout")
    layoutScript.Padding = UDim.new(0, 6)
    layoutScript.SortOrder = Enum.SortOrder.LayoutOrder
    layoutScript.FillDirection = Enum.FillDirection.Vertical
    layoutScript.HorizontalAlignment = Enum.HorizontalAlignment.Center
    layoutScript.Parent = scriptContainer

    -- Conex√£o para ajustar o tamanho do ScriptContainer dinamicamente
    layoutScript:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
        scriptContainer.Size = UDim2.new(1, -20, 0, layoutScript.AbsoluteContentSize.Y)
    end)

    -- Rodap√© (Aba de Atualiza√ß√µes)
    local scriptFooter = Instance.new("TextLabel")
    scriptFooter.Name = "ScriptFooter"
    scriptFooter.Size = UDim2.new(1, 0, 0, 18)
    scriptFooter.BackgroundTransparency = 1
    scriptFooter.TextColor3 = Color3.fromRGB(150, 150, 150)
    scriptFooter.Font = Enum.Font.Gotham
    scriptFooter.TextSize = 12
    scriptFooter.Text = "Algum Script parou de funcionar? NOS COMUNIQUE!"
    scriptFooter.TextWrapped = true
    scriptFooter.TextXAlignment = Enum.TextXAlignment.Center
    scriptFooter.TextYAlignment = Enum.TextYAlignment.Bottom
    scriptFooter.LayoutOrder = 999
    scriptFooter.Parent = scriptContainer
    scriptFooter.Visible = false -- Vis√≠vel apenas na aba de atualiza√ß√µes

    local footerBackground = Instance.new("Frame")
    footerBackground.Name = "FooterBackground"
    footerBackground.Size = UDim2.new(1, -10, 0, 40)
    footerBackground.Position = UDim2.new(0, 5, 1, -45)
    footerBackground.BackgroundColor3 = themes[CurrentTheme].title_bar
    footerBackground.BackgroundTransparency = 0
    footerBackground.BorderSizePixel = 0
    footerBackground.Parent = frame
    applyRoundedCorners(footerBackground, 10)

    local footerBorder = Instance.new("UIStroke")
    footerBorder.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
    footerBorder.Thickness = 1.5
    footerBorder.LineJoinMode = Enum.LineJoinMode.Round
    footerBorder.Parent = footerBackground
    local footerGradient = Instance.new("UIGradient")
    footerGradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 140, 0)), ColorSequenceKeypoint.new(1, Color3.fromRGB(220, 100, 0))})
    footerGradient.Rotation = 90
    footerGradient.Parent = footerBorder

    local footerText = Instance.new("TextLabel")
    footerText.Name = "FooterText"
    footerText.Text = "By Khalexis"
    footerText.Font = Enum.Font.GothamBold
    footerText.TextSize = 10
    footerText.TextColor3 = COLOR_FOOTER_TEXT
    footerText.BackgroundTransparency = 1
    footerText.Size = UDim2.new(1, 0, 1, 0)
    footerText.Position = UDim2.new(0, 0, 0, 5)
    footerText.TextYAlignment = Enum.TextYAlignment.Top
    footerText.Parent = footerBackground

    local footerRightContainer = Instance.new("Frame")
    footerRightContainer.Name = "FooterRightContainer"
    footerRightContainer.Size = UDim2.new(0.5, 0, 1, 0)
    footerRightContainer.Position = UDim2.new(0.5, 0, 0, 0)
    footerRightContainer.BackgroundTransparency = 1
    footerRightContainer.Parent = footerBackground
    local footerContainerPadding = Instance.new("UIPadding")
    footerContainerPadding.PaddingRight = UDim.new(0, 8)
    footerContainerPadding.Parent = footerRightContainer
    local footerTextLayout = Instance.new("UIListLayout")
    footerTextLayout.FillDirection = Enum.FillDirection.Vertical
    footerTextLayout.VerticalAlignment = Enum.VerticalAlignment.Center
    footerTextLayout.HorizontalAlignment = Enum.HorizontalAlignment.Right
    footerTextLayout.SortOrder = Enum.SortOrder.LayoutOrder
    footerTextLayout.Padding = UDim.new(0, 1)
    footerTextLayout.Parent = footerRightContainer

    local ytLabel = Instance.new("TextLabel")
    ytLabel.Name = "YouTubeLabel"
    ytLabel.Text = "Youtube: Khalexis"
    ytLabel.Font = Enum.Font.Gotham
    ytLabel.TextSize = 9
    ytLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    ytLabel.BackgroundTransparency = 1
    ytLabel.Size = UDim2.new(1, 0, 0, 10)
    ytLabel.TextXAlignment = Enum.TextXAlignment.Right
    ytLabel.LayoutOrder = 1
    ytLabel.Parent = footerRightContainer
    local discordLabel = Instance.new("TextLabel")
    discordLabel.Name = "DiscordLabel"
    discordLabel.Text = "Discord: discord.gg/aNaFpb2Qsb"
    discordLabel.Font = Enum.Font.Gotham
    discordLabel.TextSize = 9
    discordLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    discordLabel.BackgroundTransparency = 1
    discordLabel.Size = UDim2.new(1, 0, 0, 10)
    discordLabel.TextXAlignment = Enum.TextXAlignment.Right
    discordLabel.LayoutOrder = 2
    discordLabel.Parent = footerRightContainer
    local hintLabel = Instance.new("TextLabel")
    hintLabel.Name = "DudaLabel"
    hintLabel.Text = "Se tiver alguma d√∫vida entre no Discord!"
    hintLabel.Font = Enum.Font.Gotham
    hintLabel.TextSize = 7
    hintLabel.TextColor3 = Color3.fromRGB(150, 150, 150)
    hintLabel.BackgroundTransparency = 1
    hintLabel.Size = UDim2.new(1, 0, 0, 9)
    hintLabel.TextXAlignment = Enum.TextXAlignment.Right
    hintLabel.LayoutOrder = 3
    hintLabel.Parent = footerRightContainer

    local playerInfo = Instance.new("Frame")
    playerInfo.Name = "PlayerInfoFrame"
    playerInfo.Size = UDim2.new(0, 90, 0, 25)
    playerInfo.Position = UDim2.new(0, 8, 0.5, -12)
    playerInfo.BackgroundTransparency = 1
    playerInfo.Parent = footerBackground

    local avatar = Instance.new("ImageLabel")
    avatar.Name = "AvatarImage"
    avatar.Size = UDim2.new(0, 24, 0, 24)
    avatar.Position = UDim2.new(0, 0, 0, 0)
    avatar.BackgroundColor3 = themes[CurrentTheme].script_frame_bg
    avatar.BorderSizePixel = 0
    avatar.Parent = playerInfo
    avatar.ScaleType = Enum.ScaleType.Fit
    applyRoundedCorners(avatar, 12)
    local thumbType, thumbSize = Enum.ThumbnailType.HeadShot, Enum.ThumbnailSize.Size48x48
    local thumbContent, thumbError = pcall(Players.GetUserThumbnailAsync, Players, player.UserId, thumbType, thumbSize)
    if thumbError then print("Erro ao carregar thumbnail:", thumbError) end
    if thumbContent then avatar.Image = thumbContent end

    local playerNameLabel = Instance.new("TextLabel")
    playerNameLabel.Name = "PlayerNameLabel"
    playerNameLabel.Size = UDim2.new(1, -28, 1, 0)
    playerNameLabel.Position = UDim2.new(0, 28, 0, 0)
    playerNameLabel.BackgroundTransparency = 1
    playerNameLabel.Text = player.Name
    playerNameLabel.TextColor3 = COLOR_TEXT
    playerNameLabel.Font = Enum.Font.Gotham
    playerNameLabel.TextSize = 10
    playerNameLabel.TextXAlignment = Enum.TextXAlignment.Left
    playerNameLabel.Parent = playerInfo

    -- Dragging do Hub
    local dragging = false
    local dragStart, startPos
    local currentInputObject = nil

    titleBar.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            dragging = true
            dragStart = input.Position
            startPos = animationContainer.Position
            currentInputObject = input
            input.Changed:Connect(function() -- Para detectar quando o input √© solto
                if input.UserInputState == Enum.UserInputState.Ended then
                    dragging = false
                    currentInputObject = nil
                end
            end)
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and currentInputObject == input and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
            local delta = input.Position - dragStart
            animationContainer.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end)

    -- Fun√ß√µes para manipula√ß√£o de scripts dentro do hub
    local function clearScripts()
        for _, c in pairs(scriptContainer:GetChildren()) do
            if c:IsA("GuiObject") and c.Name ~= "ScriptFooter" then
                c:Destroy()
            end
        end
        if layoutScript then layoutScript:SetAttribute("Refresh", true) end
    end

    local function createScriptButton(scriptData, parentContainer)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1, 0, 0, 28)
        btn.BackgroundColor3 = themes[CurrentTheme].category_bg
        btn.BorderSizePixel = 0
        btn.TextColor3 = COLOR_TEXT
        btn.Font = Enum.Font.Gotham
        btn.TextSize = 12
        btn.Text = scriptData.Name
        btn.LayoutOrder = scriptData.LayoutOrder or 0
        btn.Parent = parentContainer
        applyRoundedCorners(btn, 10)

        local border = Instance.new("UIStroke")
        border.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        border.Thickness = 1.5
        border.LineJoinMode = Enum.LineJoinMode.Round
        border.Parent = btn
        local gradient = Instance.new("UIGradient")
        gradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 140, 0)), ColorSequenceKeypoint.new(1, Color3.fromRGB(220, 100, 0))})
        gradient.Rotation = 90
        gradient.Parent = border

        btn.MouseButton1Click:Connect(function()
            btn.Text = "Executando..."
            btn.Active = false
            btn.AutoButtonColor = false
            spawn(function()
                local success, result = pcall(scriptData.Func)
                if not success then
                    showError("Erro ao executar script: " .. scriptData.Name)
                    print("Erro de execu√ß√£o:", result)
                end
                wait(3)
                closeHubWithAnimation(animationContainer)
            end)
        end)
        return btn
    end

    local function createUpdateLabel(textData, parentContainer)
        local lbl = Instance.new("TextLabel")
        lbl.Size = UDim2.new(1, 0, 0, 18)
        lbl.BackgroundTransparency = 1
        lbl.TextColor3 = textData.Color or COLOR_TEXT
        lbl.Font = textData.Font or Enum.Font.Gotham
        lbl.TextSize = textData.TextSize or 12
        lbl.Text = textData.Text
        lbl.TextWrapped = true
        lbl.TextXAlignment = Enum.TextXAlignment.Center
        lbl.TextYAlignment = Enum.TextYAlignment.Top
        lbl.Parent = parentContainer
        return lbl
    end

    local updatesTextFormatted = {
        {Text = "Khalexis Hub V1.2", Color = Color3.fromRGB(255, 255, 255), Font = Enum.Font.GothamBold, TextSize = 18},
        {Text = "+1 Script Steal a Brainrot", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "+1 Script Forsaken", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "+1 Script Pegue o Peixe!", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "Nova Mensagem de Boas Vindas!", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "Corre√ß√µes de Bugs Gerais", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "Tamanho do Hub e Elementos Ajustados", Color = Color3.fromRGB(220, 220, 220)},
        {Text = "DEIXE UMA SUGEST√ÉO NO DISCORD!", Color = Color3.fromRGB(255, 140, 0), Font = Enum.Font.GothamBold},
    }

    local function displayUpdates()
        clearScripts()
        scriptFooter.Visible = true
        for _, lineData in ipairs(updatesTextFormatted) do
            createUpdateLabel(lineData, scriptContainer)
        end
        if layoutScript then layoutScript:SetAttribute("Refresh", true) end
    end
    -- Associa a fun√ß√£o displayUpdates √† configura√ß√£o da categoria 'Atualiza√ß√µes'
    for i, catConfig in ipairs(categoriesConfig) do
        if catConfig.Name == "üì£ Atualiza√ß√µes üì£" then
            catConfig.Content = displayUpdates
            break
        end
    end

    local function createCategoryButton(categoryData)
        local btn = Instance.new("TextButton")
        btn.Name = categoryData.Name:gsub("%s+", "")
        btn.Size = UDim2.new(1, 0, 0, 22)
        btn.BackgroundColor3 = themes[CurrentTheme].category_bg
        btn.BorderSizePixel = 0
        btn.TextColor3 = Color3.fromRGB(230, 230, 230)
        btn.Font = Enum.Font.Gotham
        btn.TextSize = 9
        btn.Text = categoryData.Name
        btn.Parent = categoryContainer
        applyRoundedCorners(btn, 8)

        local border = Instance.new("UIStroke")
        border.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        border.Thickness = 1.5
        border.LineJoinMode = Enum.LineJoinMode.Round
        border.Parent = btn
        local gradient = Instance.new("UIGradient")
        gradient.Color = ColorSequence.new({ColorSequenceKeypoint.new(0, Color3.fromRGB(255, 140, 0)), ColorSequenceKeypoint.new(1, Color3.fromRGB(220, 100, 0))})
        gradient.Rotation = 90
        gradient.Parent = border
        btn.LayoutOrder = categoryData.LayoutOrder

        btn.MouseButton1Click:Connect(function()
            clearScripts()
            scriptFooter.Visible = false

            if categoryData.Type == "function" then
                pcall(categoryData.Content)
                if categoryData.Content == displayUpdates then scriptFooter.Visible = true end
            elseif categoryData.Type == "scripts" and gameScriptsData[categoryData.Key] then
                local scriptsInCategory = gameScriptsData[categoryData.Key]
                for _, scriptData in ipairs(scriptsInCategory) do
                    createScriptButton(scriptData, scriptContainer)
                end
            end
            -- For√ßa a atualiza√ß√£o dos layouts ap√≥s alterar o conte√∫do
            if layoutScript then layoutScript:SetAttribute("Refresh", true) end
            if layoutCategory then layoutCategory:SetAttribute("Refresh", true) end
            -- Ajusta manualmente o tamanho do container para garantir a rolagem
            if layoutCategory then categoryContainer.Size = UDim2.new(1, -10, 0, layoutCategory.AbsoluteContentSize.Y) end
        end)
        return btn
    end

    -- Cria os bot√µes de categoria
    for _, catData in ipairs(categoriesConfig) do
        createCategoryButton(catData)
    end

    -- For√ßa a atualiza√ß√£o do layout da categoria uma vez ap√≥s todos os bot√µes serem criados
    if layoutCategory then
        wait(0.1) -- Pequeno atraso para processar o clique simulado
        layoutCategory:SetAttribute("Refresh", true)
        categoryContainer.Size = UDim2.new(1, -10, 0, layoutCategory.AbsoluteContentSize.Y)
    end

    -- Simula um clique na primeira categoria para exibir scripts ao abrir
    local firstCategoryButton = categoryContainer:FindFirstChildOfClass("TextButton")
    if firstCategoryButton then
        firstCategoryButton:MouseButton1Click()
    end

    return animationContainer
end

-- TELA DE LOGIN/AUTENTICA√á√ÉO
local function createAuthFrame()
    local frame = Instance.new("Frame")
    frame.Name = "AuthFrame"
    frame.Size = UDim2.new(0, 300, 0, 240)
    frame.Position = UDim2.new(0.5, -150, 0.5, -120)
    frame.BackgroundColor3 = themes[CurrentTheme].main_bg
    frame.BorderSizePixel = 0
    frame.Parent = ScreenGui
    applyRoundedCorners(frame, 12)

    local titleLabel = Instance.new("TextLabel")
    titleLabel.Name = "AuthTitle"
    titleLabel.Size = UDim2.new(1, 0, 0, 30)
    titleLabel.Position = UDim2.new(0, 0, 0, 10)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = "üîí Insira sua Key Khalexis üîí"
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextSize = 14
    titleLabel.TextYAlignment = Enum.TextYAlignment.Center
    titleLabel.TextXAlignment = Enum.TextXAlignment.Center
    titleLabel.Parent = frame
    spawn(function() -- Anima√ß√£o de cor para o t√≠tulo
        local hue = 0
        while frame and frame.Parent and titleLabel.Parent do
            hue = (hue + 0.01) % 1
            titleLabel.TextColor3 = Color3.fromHSV(hue, 1, 1)
            wait(0.03)
        end
    end)

    local keyBox = Instance.new("TextBox")
    keyBox.Name = "KeyBox"
    keyBox.Size = UDim2.new(1, -30, 0, 35)
    keyBox.Position = UDim2.new(0, 15, 0, 55)
    keyBox.BackgroundColor3 = themes[CurrentTheme].category_bg
    keyBox.TextColor3 = COLOR_TEXT
    keyBox.Font = Enum.Font.Gotham
    keyBox.TextSize = 16
    keyBox.ClearTextOnFocus = false
    keyBox.PlaceholderText = "Cole sua Key aqui..."
    keyBox.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
    keyBox.Parent = frame
    applyRoundedCorners(keyBox, 8)

    local confirmBtn = Instance.new("TextButton")
    confirmBtn.Name = "EnterButton"
    confirmBtn.Size = UDim2.new(0, 90, 0, 30)
    confirmBtn.Position = UDim2.new(0.5, -45, 0, 95)
    confirmBtn.BackgroundColor3 = themes[CurrentTheme].category_bg
    confirmBtn.TextColor3 = COLOR_TEXT
    confirmBtn.Font = Enum.Font.GothamBold
    confirmBtn.TextSize = 16
    confirmBtn.Text = "Confirmar"
    applyRoundedCorners(confirmBtn, 8)
    confirmBtn.Parent = frame

    local getHelpBtn = Instance.new("TextButton")
    getHelpBtn.Name = "GetHelpButton"
    getHelpBtn.Size = UDim2.new(0, 70, 0, 25)
    getHelpBtn.Position = UDim2.new(0.5, -35, 0, 130)
    getHelpBtn.BackgroundColor3 = themes[CurrentTheme].category_bg
    getHelpBtn.TextColor3 = Color3.new(1, 1, 1)
    getHelpBtn.Font = Enum.Font.GothamBold
    getHelpBtn.TextSize = 10
    getHelpBtn.Text = "Obter Ajuda/Key"
    applyRoundedCorners(getHelpBtn, 8)
    getHelpBtn.Parent = frame

    local infoLabel = Instance.new("TextLabel")
    infoLabel.Name = "InfoText"
    infoLabel.Size = UDim2.new(1, -20, 0, 25)
    infoLabel.Position = UDim2.new(0, 10, 0, 165)
    infoLabel.BackgroundTransparency = 1
    infoLabel.Font = Enum.Font.GothamBold
    infoLabel.TextSize = 10
    infoLabel.Text = "Clique em 'Obter Ajuda/Key' para mais informa√ß√µes."
    infoLabel.TextWrapped = true
    infoLabel.TextXAlignment = Enum.TextXAlignment.Center
    infoLabel.TextYAlignment = Enum.TextYAlignment.Top
    infoLabel.Parent = frame
    spawn(function() -- Anima√ß√£o de cor para infoLabel
        local hue = 0
        while frame and frame.Parent and infoLabel.Parent do
            hue = (hue + 0.01) % 1
            infoLabel.TextColor3 = Color3.fromHSV(hue, 1, 1)
            wait(0.03)
        end
    end)

    ErrorLabel = Instance.new("TextLabel") -- Criar o ErrorLabel associado a este frame
    ErrorLabel.Name = "ErrorLabel"
    ErrorLabel.Size = UDim2.new(1, 0, 0, 20)
    ErrorLabel.Position = UDim2.new(0, 0, 1, -70)
    ErrorLabel.BackgroundTransparency = 1
    ErrorLabel.TextColor3 = COLOR_ERROR
    ErrorLabel.Font = Enum.Font.GothamBold
    ErrorLabel.TextSize = 14
    ErrorLabel.Text = ""
    ErrorLabel.Parent = frame

    confirmBtn.MouseButton1Click:Connect(function()
        local key = keyBox.Text:gsub("%s", ""):lower()
        if key == "" then
            showError("Por favor, insira sua key.")
            return
        end
        local success, message = authenticateKey(key)
        if success then
            saveKeyLocally(key)
            frame:Destroy()
            showLoadingAndOpenHub()
        else
            removeLocalKey()
            showError(message or "Key incorreta ou inv√°lida.")
        end
    end)

    getHelpBtn.MouseButton1Click:Connect(function()
        local success, _ = copyToClipboard("discord.gg/aNaFpb2Qsb")
        if success then
            getHelpBtn.Text = "Link copiado!"
            wait(2)
            getHelpBtn.Text = "Obter Ajuda/Key"
        else
            showError("Falha ao copiar o link.")
        end
    end)

    return frame
end

local function showLoadingAndOpenHub()
    local LoadingScreen, StopLoadingAnim = showLoadingScreen()
    wait(2)
    if StopLoadingAnim then StopLoadingAnim() end
    if LoadingScreen and LoadingScreen.Parent then LoadingScreen:Destroy() end

    -- MENSAGEM DE BOAS-VINDAS
    if not HasShownWelcome then
        local welcomeFrame = Instance.new("Frame")
        welcomeFrame.Size = UDim2.new(0, 0, 0, 0)
        welcomeFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
        welcomeFrame.AnchorPoint = Vector2.new(0.5, 0.5)
        welcomeFrame.BackgroundColor3 = themes[CurrentTheme].main_bg
        welcomeFrame.BorderSizePixel = 0
        welcomeFrame.Parent = ScreenGui
        applyRoundedCorners(welcomeFrame, 16)

        local border = Instance.new("UIStroke")
        border.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
        border.Color = Color3.fromRGB(0, 0, 0)
        border.Thickness = 2
        border.Parent = welcomeFrame

        local welcomeMsg = Instance.new("TextLabel")
        welcomeMsg.Size = UDim2.new(1, 0, 1, 0)
        welcomeMsg.BackgroundTransparency = 1
        welcomeMsg.TextColor3 = COLOR_TEXT
        welcomeMsg.Font = Enum.Font.GothamBold
        welcomeMsg.TextSize = 20
        welcomeMsg.Text = "Bem Vindo(a) " .. player.Name .. " ao Khalexis Hub!"
        welcomeMsg.TextWrapped = true
        welcomeMsg.TextXAlignment = Enum.TextXAlignment.Center
        welcomeMsg.TextYAlignment = Enum.TextYAlignment.Center
        welcomeMsg.Parent = welcomeFrame

        local tweenInfoExpand = TweenInfo.new(0.3, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
        local goalExpand = {Size = UDim2.new(0, 300, 0, 50), Position = UDim2.new(0.5, -150, 0.5, -25), BackgroundTransparency = 0}
        local tweenExpand = TweenService:Create(welcomeFrame, tweenInfoExpand, goalExpand)

        local tweenInfoFadeOut = TweenInfo.new(0.5, Enum.EasingStyle.Quad, Enum.EasingDirection.In)
        local goalFadeOut = {TextTransparency = 1}
        local tweenFadeOut = TweenService:Create(welcomeMsg, tweenInfoFadeOut, goalFadeOut)
        local tweenFadeOutFrame = TweenService:Create(welcomeFrame, tweenInfoFadeOut, {BackgroundTransparency = 1})

        tweenExpand:Play()
        tweenExpand.Completed:Wait()
        wait(1.5)
        tweenFadeOut:Play()
        tweenFadeOutFrame:Play()
        tweenFadeOutFrame.Completed:Wait()

        if welcomeFrame and welcomeFrame.Parent then welcomeFrame:Destroy() end
        HasShownWelcome = true
    end

    MainFrameContainer = createHub()
    IsHubOpen = true
    if ToggleButton then ToggleButton.Visible = false end
end

local function tryAutoValidate()
    local savedKey = loadKeyLocally()
    if savedKey then
        local success, message = authenticateKey(savedKey)
        if success then
            return true, message -- Chave v√°lida
        else
            removeLocalKey() -- Limpa chave inv√°lida
            return false, message or "Chave local inv√°lida."
        end
    end
    return false, "Nenhuma chave encontrada."
end

-- INICIALIZA√á√ÉO
ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = MODULE_NAME
ScreenGui.ResetOnSpawn = false
ScreenGui.Parent = game.CoreGui

-- CRIA√á√ÉO DO TOGGLE BUTTON
ToggleButton = Instance.new("TextButton")
ToggleButton.Name = "ToggleButton"
ToggleButton.Size = UDim2.new(0, 35, 0, 35)
ToggleButton.Position = UDim2.new(0, 10, 0, 10)
ToggleButton.BackgroundColor3 = Color3.new(0, 0, 0)
ToggleButton.TextColor3 = Color3.new(1, 1, 1)
ToggleButton.Font = Enum.Font.GothamBold
ToggleButton.TextSize = 24
ToggleButton.Text = "K"
ToggleButton.Parent = ScreenGui
applyRoundedCorners(ToggleButton, 10)
ToggleButton.Visible = true

-- DRAGGING DO TOGGLE BUTTON
local draggingToggle = false
local dragStartToggle, startPosToggle
local currentInputObjectToggle = nil

ToggleButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        draggingToggle = true
        dragStartToggle = input.Position
        startPosToggle = ToggleButton.Position
        currentInputObjectToggle = input
        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.Ended then
                draggingToggle = false
                currentInputObjectToggle = nil
            end
        end)
    end
end)
UserInputService.InputChanged:Connect(function(input)
    if draggingToggle and currentInputObjectToggle == input and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
        local delta = input.Position - dragStartToggle
        ToggleButton.Position = UDim2.new(startPosToggle.X.Scale, startPosToggle.X.Offset + delta.X, startPosToggle.Y.Scale, startPosToggle.Y.Offset + delta.Y)
    end
end)

ToggleButton.MouseButton1Click:Connect(function()
    if IsHubOpen then
        if MainFrameContainer then
            closeHubWithAnimation(MainFrameContainer)
        end
    else
        local autoValidated, autoMessage = tryAutoValidate()
        if autoValidated then
            showLoadingAndOpenHub()
        else
            if not ErrorLabel or not ErrorLabel.Parent or ErrorLabel.Parent.Name ~= "AuthFrame" then
                local authFrame = createAuthFrame()
                ErrorLabel = authFrame:FindFirstChild("ErrorLabel")
            end
            if autoMessage and not autoValidated then
                showError(autoMessage)
            end
        end
    end
end)

-- VERIFICA√á√ÉO INICIAL AO CARREGAR O SCRIPT
local autoValidated, autoMessage = tryAutoValidate()
if autoValidated then
    showLoadingAndOpenHub()
else
    local authFrame = createAuthFrame()
    ErrorLabel = authFrame:FindFirstChild("ErrorLabel")
    if autoMessage and not autoValidated then
        showError(autoMessage)
    end
end
